{"file_contents":{"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/DeleteConfirmDialog.tsx":{"content":"import {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ninterface DeleteConfirmDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  title?: string;\n  description?: string;\n}\n\nexport default function DeleteConfirmDialog({\n  open,\n  onClose,\n  onConfirm,\n  title = \"Delete Document\",\n  description = \"Are you sure you want to delete this document? This action cannot be undone.\",\n}: DeleteConfirmDialogProps) {\n  return (\n    <AlertDialog open={open} onOpenChange={onClose}>\n      <AlertDialogContent data-testid=\"dialog-delete-confirm\">\n        <AlertDialogHeader>\n          <AlertDialogTitle>{title}</AlertDialogTitle>\n          <AlertDialogDescription>{description}</AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            data-testid=\"button-confirm-delete\"\n          >\n            Delete\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":1373,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        __dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2345,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/StatusBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\n\nexport type DocumentStatus = \"Pending\" | \"Approved\" | \"Declined\" | \"Issued\" | \"Revised\";\n\ninterface StatusBadgeProps {\n  status: DocumentStatus;\n  className?: string;\n}\n\nexport default function StatusBadge({ status, className }: StatusBadgeProps) {\n  const getStatusColor = () => {\n    switch (status) {\n      case \"Pending\":\n        return \"bg-amber-500/10 text-amber-700 dark:text-amber-400 border-amber-500/20\";\n      case \"Approved\":\n        return \"bg-green-500/10 text-green-700 dark:text-green-400 border-green-500/20\";\n      case \"Declined\":\n        return \"bg-red-500/10 text-red-700 dark:text-red-400 border-red-500/20\";\n      case \"Issued\":\n        return \"bg-blue-500/10 text-blue-700 dark:text-blue-400 border-blue-500/20\";\n      case \"Revised\":\n        return \"bg-purple-500/10 text-purple-700 dark:text-purple-400 border-purple-500/20\";\n      default:\n        return \"bg-muted text-muted-foreground\";\n    }\n  };\n\n  return (\n    <Badge\n      variant=\"outline\"\n      className={`${getStatusColor()} uppercase text-xs font-medium tracking-wide ${className}`}\n      data-testid={`badge-status-${status.toLowerCase()}`}\n    >\n      {status}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":1219,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 98%;\n\n  --foreground: 210 4% 12%;\n\n  --border: 210 6% 88%;\n\n  --card: 0 0% 96%;\n\n  --card-foreground: 210 4% 12%;\n\n  --card-border: 210 5% 90%;\n\n  --sidebar: 210 4% 94%;\n\n  --sidebar-foreground: 210 4% 12%;\n\n  --sidebar-border: 210 5% 86%;\n\n  --sidebar-primary: 210 78% 48%;\n\n  --sidebar-primary-foreground: 0 0% 98%;\n\n  --sidebar-accent: 210 8% 88%;\n\n  --sidebar-accent-foreground: 210 4% 12%;\n\n  --sidebar-ring: 210 78% 48%;\n\n  --popover: 0 0% 92%;\n\n  --popover-foreground: 210 4% 12%;\n\n  --popover-border: 210 5% 84%;\n\n  --primary: 210 78% 48%;\n\n  --primary-foreground: 0 0% 98%;\n\n  --secondary: 210 6% 86%;\n\n  --secondary-foreground: 210 4% 12%;\n\n  --muted: 210 10% 90%;\n\n  --muted-foreground: 210 4% 35%;\n\n  --accent: 210 12% 88%;\n\n  --accent-foreground: 210 4% 12%;\n\n  --destructive: 0 72% 42%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 210 12% 75%;\n  --ring: 210 78% 48%;\n  --chart-1: 210 78% 42%;\n  --chart-2: 195 68% 38%;\n  --chart-3: 160 62% 35%;\n  --chart-4: 40 85% 45%;\n  --chart-5: 280 65% 48%;\n\n  --font-sans: Inter, system-ui, -apple-system, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'Roboto Mono', Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(210 10% 10% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(210 10% 10% / 0.08);\n  --shadow-sm: 0px 2px 4px 0px hsl(210 10% 10% / 0.06), 0px 1px 2px -1px hsl(210 10% 10% / 0.04);\n  --shadow: 0px 4px 6px -1px hsl(210 10% 10% / 0.08), 0px 2px 4px -1px hsl(210 10% 10% / 0.05);\n  --shadow-md: 0px 6px 12px -2px hsl(210 10% 10% / 0.10), 0px 3px 6px -2px hsl(210 10% 10% / 0.06);\n  --shadow-lg: 0px 10px 20px -4px hsl(210 10% 10% / 0.12), 0px 4px 8px -2px hsl(210 10% 10% / 0.07);\n  --shadow-xl: 0px 20px 32px -8px hsl(210 10% 10% / 0.14), 0px 8px 16px -4px hsl(210 10% 10% / 0.08);\n  --shadow-2xl: 0px 32px 48px -12px hsl(210 10% 10% / 0.16);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 210 6% 8%;\n\n  --foreground: 0 0% 95%;\n\n  --border: 210 6% 18%;\n\n  --card: 210 5% 10%;\n\n  --card-foreground: 0 0% 95%;\n\n  --card-border: 210 5% 14%;\n\n  --sidebar: 210 4% 12%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 210 5% 16%;\n\n  --sidebar-primary: 210 75% 55%;\n\n  --sidebar-primary-foreground: 0 0% 98%;\n\n  --sidebar-accent: 210 10% 18%;\n\n  --sidebar-accent-foreground: 0 0% 95%;\n\n  --sidebar-ring: 210 75% 55%;\n\n  --popover: 210 5% 14%;\n\n  --popover-foreground: 0 0% 95%;\n\n  --popover-border: 210 5% 18%;\n\n  --primary: 210 75% 52%;\n\n  --primary-foreground: 0 0% 98%;\n\n  --secondary: 210 8% 20%;\n\n  --secondary-foreground: 0 0% 95%;\n\n  --muted: 210 10% 16%;\n\n  --muted-foreground: 0 0% 70%;\n\n  --accent: 210 12% 18%;\n\n  --accent-foreground: 0 0% 95%;\n\n  --destructive: 0 70% 48%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 210 12% 30%;\n  --ring: 210 75% 55%;\n  --chart-1: 210 75% 65%;\n  --chart-2: 195 70% 62%;\n  --chart-3: 160 65% 60%;\n  --chart-4: 40 90% 68%;\n  --chart-5: 280 68% 70%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.15);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.20);\n  --shadow-sm: 0px 2px 4px 0px hsl(0 0% 0% / 0.18), 0px 1px 2px -1px hsl(0 0% 0% / 0.12);\n  --shadow: 0px 4px 6px -1px hsl(0 0% 0% / 0.22), 0px 2px 4px -1px hsl(0 0% 0% / 0.15);\n  --shadow-md: 0px 6px 12px -2px hsl(0 0% 0% / 0.25), 0px 3px 6px -2px hsl(0 0% 0% / 0.18);\n  --shadow-lg: 0px 10px 20px -4px hsl(0 0% 0% / 0.28), 0px 4px 8px -2px hsl(0 0% 0% / 0.20);\n  --shadow-xl: 0px 20px 32px -8px hsl(0 0% 0% / 0.32), 0px 8px 16px -4px hsl(0 0% 0% / 0.24);\n  --shadow-2xl: 0px 32px 48px -12px hsl(0 0% 0% / 0.36);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","path":null,"size_bytes":11206,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"design_guidelines.md":{"content":"# Document Management System - Design Guidelines\n\n## Design Approach\n\n**Selected Framework**: Material Design-inspired system  \n**Rationale**: Enterprise document management requires clarity, efficiency, and familiar patterns. Material Design's emphasis on structured hierarchy, clear component states, and form-friendly layouts perfectly suits this workflow-intensive application.\n\n**Core Principles**:\n- Clarity over creativity: Every element serves a functional purpose\n- Consistent information architecture across all role-based dashboards\n- Clear status indicators and workflow progression visualization\n- Professional, trustworthy aesthetic appropriate for corporate environments\n\n---\n\n## Typography System\n\n**Primary Font**: Inter (via Google Fonts CDN)  \n**Secondary Font**: Roboto Mono (for document numbers, control copy numbers)\n\n**Type Scale**:\n- Page Headers: text-3xl font-semibold (30px)\n- Section Headers: text-xl font-semibold (20px)\n- Card Titles: text-lg font-medium (18px)\n- Body Text: text-base font-normal (16px)\n- Labels: text-sm font-medium (14px)\n- Helper Text: text-xs font-normal (12px)\n- Metadata/Timestamps: text-xs font-normal tracking-wide (12px)\n\n**Line Heights**:\n- Headers: leading-tight\n- Body: leading-relaxed\n- Forms: leading-normal\n\n---\n\n## Layout System\n\n**Spacing Primitives**: Tailwind units of 2, 4, 6, and 8  \n**Common Usage**:\n- Component padding: p-6\n- Section spacing: mb-8, mt-8\n- Card spacing: p-4\n- Form field gaps: space-y-4\n- Button padding: px-6 py-2\n- Grid gaps: gap-6\n\n**Container Strategy**:\n- Main content area: max-w-7xl mx-auto\n- Form containers: max-w-2xl\n- Dashboard cards: Full width within grid system\n- Modal dialogs: max-w-lg to max-w-3xl depending on content\n\n**Grid Layouts**:\n- Dashboard cards: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\n- Document lists: Single column with proper spacing\n- Form layouts: grid-cols-1 md:grid-cols-2 gap-4 for multi-field forms\n\n---\n\n## Component Library\n\n### Navigation & Layout\n\n**Top Navigation Bar**:\n- Full-width sticky header with shadow-sm\n- Contains: Logo/brand, role indicator, notification bell icon, user profile dropdown\n- Height: h-16\n- Layout: flex items-center justify-between px-6\n\n**Sidebar Navigation** (for role-specific dashboards):\n- Fixed left sidebar: w-64\n- Navigation items with icons (Heroicons) and labels\n- Active state: Clear visual differentiation with border-l-4 and slightly elevated background\n- Collapsible on mobile\n\n**Breadcrumbs**:\n- Always visible below header: text-sm with separator icons\n- Shows: Dashboard > Document Name > Current Action\n\n### Dashboard Components\n\n**Statistics Cards**:\n- Elevated card design with rounded-lg shadow-md\n- Contains: Icon, metric number (large text-3xl font-bold), label, trend indicator\n- Layout: grid display for multiple stats\n- Padding: p-6\n\n**Document List Cards**:\n- Table-like structure within cards\n- Columns: Document Name, Doc Number, Status, Date, Actions\n- Alternating row backgrounds for readability\n- Status badges with distinct visual states (Pending, Approved, Declined, Issued)\n\n**Recent Activity Feed**:\n- Chronological list with timeline visualization\n- Each entry: Icon, action description, timestamp, user name\n- Compact spacing: py-3 border-b\n\n### Forms & Inputs\n\n**Input Fields**:\n- Label above input: text-sm font-medium mb-2\n- Input styling: border rounded-md px-4 py-2 w-full focus:ring-2 focus:outline-none\n- Required field indicator: Asterisk after label\n- Helper text below input: text-xs mt-1\n\n**File Upload Area**:\n- Dashed border rounded-lg with hover state\n- Center-aligned content: Upload icon, \"Click to upload\" text, file type specifications\n- Drag-and-drop visual feedback\n- Uploaded file preview with name and remove button\n\n**Select Dropdowns**:\n- Consistent with text inputs in height and styling\n- Clear chevron icon indicator\n- Multi-select with checkbox options when applicable\n\n**Date Pickers**:\n- Calendar icon prefix\n- Input format clearly indicated (DD/MM/YYYY)\n\n### Buttons & Actions\n\n**Primary Action Button**:\n- Prominent, elevated appearance with shadow-sm\n- Padding: px-6 py-2.5\n- Rounded: rounded-md\n- Font: text-sm font-medium\n\n**Secondary Button**:\n- Outlined style with border-2\n- Same dimensions as primary\n- Less visual weight\n\n**Icon Buttons**:\n- Square or circular: h-10 w-10\n- Icons from Heroicons (outline style)\n- Used for: actions in tables, close buttons, menu toggles\n\n**Button Groups**:\n- Actions together with gap-4\n- Primary action on right (approve, submit, issue)\n- Secondary/cancel on left\n\n### Document Workflow Components\n\n**Status Badge**:\n- Inline badge with rounded-full px-3 py-1\n- Text: text-xs font-medium uppercase tracking-wide\n- States: Pending, Approved, Declined, Issued, Revised\n\n**Workflow Progress Indicator**:\n- Horizontal stepper showing: Creator → Approver → Issuer → Issued\n- Current step highlighted\n- Completed steps with checkmark icon\n- Minimal, clean design\n\n**Document Preview Card**:\n- Full-width card with shadow-md\n- Header section with document metadata (name, number, dates)\n- Body area for document content display\n- Footer with action buttons and remarks section\n\n**Remark/Comment Box**:\n- Textarea with border rounded-md min-h-24\n- Character counter if applicable\n- Submit button aligned to right below textarea\n\n### Modals & Overlays\n\n**Approval/Decline Modal**:\n- Centered overlay with backdrop blur\n- Max-width: max-w-lg\n- Header with close button (X icon)\n- Content area with form fields\n- Footer with action buttons (Cancel, Confirm)\n- Padding: p-6\n\n**Document Comparison View**:\n- Split-screen layout (50/50 or side-by-side tabs)\n- Headers indicating \"Previous Version\" and \"Current Version\"\n- Synchronized scrolling if possible\n- Differences highlighted\n\n**Notification Popup**:\n- Top-right fixed position\n- Slide-in animation from right\n- Compact design: p-4 rounded-md shadow-lg\n- Icon, message, dismiss button\n- Auto-dismiss after 5 seconds\n\n### Tables & Data Display\n\n**Document Log Table**:\n- Full-width responsive table\n- Header row with font-medium text-sm\n- Sortable columns with arrow indicators\n- Row hover state for interactivity\n- Pagination controls below table\n- Export to Excel button above table (right-aligned)\n\n**Print Log Table**:\n- Columns: User ID, Control Copy No., Document Name, Print Date, User Name\n- Filter options above table\n- Search functionality\n\n### Access Control & Permissions\n\n**Department Selection Grid**:\n- Checkbox list in grid format: grid-cols-2 md:grid-cols-3\n- Each item: Checkbox + Department name\n- Select All / Deselect All options\n\n**Control Copy Footer Template** (for PDF):\n- Fixed bottom section showing: User ID, Control Copy No., Date\n- Monospace font (Roboto Mono)\n- Small text: text-xs\n- Border-top separator\n\n---\n\n## Responsive Behavior\n\n**Breakpoints**:\n- Mobile: < 768px (single column, collapsible sidebar)\n- Tablet: 768px - 1024px (2-column grids)\n- Desktop: > 1024px (3-column grids, full sidebar)\n\n**Mobile Adaptations**:\n- Sidebar becomes drawer/hamburger menu\n- Tables become card-based lists\n- Multi-column grids collapse to single column\n- Form fields stack vertically\n\n---\n\n## Icons & Visual Elements\n\n**Icon Library**: Heroicons (outline style via CDN)\n\n**Common Icons**:\n- Document: DocumentTextIcon\n- Upload: ArrowUpTrayIcon\n- Approve: CheckCircleIcon\n- Decline: XCircleIcon\n- Notification: BellIcon\n- User: UserCircleIcon\n- Calendar: CalendarIcon\n- Download/Print: ArrowDownTrayIcon, PrinterIcon\n- Settings: CogIcon\n- Log: ClipboardDocumentListIcon\n\n**Icon Sizing**:\n- Navigation: h-6 w-6\n- Buttons: h-5 w-5\n- Status indicators: h-4 w-4\n- Large visual icons: h-12 w-12\n\n---\n\n## Images\n\n**Not Applicable**: This is a utility-focused enterprise application. No hero images or decorative imagery required. All visuals should be functional (icons, document previews, user avatars).\n\n---\n\n## Accessibility\n\n**Mandatory Standards**:\n- All form inputs have associated labels with proper `for` attributes\n- Focus states clearly visible with ring-2 or outline\n- Sufficient contrast ratios throughout\n- Keyboard navigation fully supported\n- ARIA labels for icon-only buttons\n- Screen reader-friendly status announcements\n- Error states clearly indicated with text, not just visual treatment\n\n**Form Validation**:\n- Inline error messages below invalid fields\n- Error summary at top of form if multiple errors\n- Success confirmation messages after actions\n\n---\n\n## Page-Specific Layouts\n\n**Login Page**:\n- Centered card layout: max-w-md mx-auto\n- Logo/brand at top\n- Form fields stacked vertically\n- Role selection if applicable\n- Minimal, focused design\n\n**Dashboard (All Roles)**:\n- Top stats row with 3-4 metric cards\n- Main content area with tabs or sections for: Pending Actions, Recent Documents, Activity Log\n- Quick action buttons prominently placed\n\n**Document Creation Page**:\n- Two-column form on desktop (metadata fields left, upload area right)\n- Single column on mobile\n- Clear step progression if multi-step\n- Save draft and submit buttons\n\n**Review/Approval Page**:\n- Document preview area (large, central)\n- Sidebar with metadata and action buttons\n- Remarks section below preview\n- Previous version comparison link if revision\n\n**Issued Documents View (Recipients)**:\n- Grid or list view toggle\n- Search and filter bar\n- Document cards with: Name, number, issue date, view/print buttons\n- PDF viewer in modal or new page\n\n**Admin Panel**:\n- Sidebar with: User Management, Role Management, Department Management, System Logs, Reports\n- Data tables with CRUD operations\n- Export functionality throughout\n\nThis design system ensures a professional, efficient, and user-friendly interface that supports the complex workflows of your DMS while maintaining consistency across all user roles.","path":null,"size_bytes":9759,"size_tokens":null},"client/src/components/examples/ActivityFeed.tsx":{"content":"import ActivityFeed from \"../ActivityFeed\";\n\nexport default function ActivityFeedExample() {\n  //todo: remove mock functionality\n  const mockActivities = [\n    {\n      id: \"1\",\n      type: \"created\" as const,\n      docName: \"Quality Control SOP\",\n      userName: \"John Smith\",\n      timestamp: \"2 hours ago\",\n    },\n    {\n      id: \"2\",\n      type: \"approved\" as const,\n      docName: \"Safety Guidelines\",\n      userName: \"Sarah Johnson\",\n      timestamp: \"4 hours ago\",\n      remarks: \"Looks good, approved for issuance\",\n    },\n    {\n      id: \"3\",\n      type: \"issued\" as const,\n      docName: \"Production Format\",\n      userName: \"Mike Davis\",\n      timestamp: \"Yesterday\",\n    },\n    {\n      id: \"4\",\n      type: \"declined\" as const,\n      docName: \"Equipment Checklist\",\n      userName: \"Emma Wilson\",\n      timestamp: \"2 days ago\",\n      remarks: \"Please revise section 3.2\",\n    },\n  ];\n\n  return (\n    <div className=\"p-6 max-w-2xl\">\n      <ActivityFeed activities={mockActivities} />\n    </div>\n  );\n}\n","path":null,"size_bytes":1012,"size_tokens":null},"client/src/pages/ApproverDashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/DashboardLayout\";\nimport StatCard from \"@/components/StatCard\";\nimport DocumentTable, { Document } from \"@/components/DocumentTable\";\nimport ApprovalDialog from \"@/components/ApprovalDialog\";\nimport DocumentViewDialog from \"@/components/DocumentViewDialog\";\nimport WorkflowProgress from \"@/components/WorkflowProgress\";\nimport { WordDocumentViewer } from \"@/components/WordDocumentViewer\";\nimport PDFViewer from \"@/components/PDFViewer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { FileText, Clock, CheckCircle, Send } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DocumentStatus } from \"@/components/StatusBadge\";\n\ninterface ApproverDashboardProps {\n  onLogout?: () => void;\n  userId?: string;\n  approverName?: string;\n}\n\ninterface ApiDocument {\n  id: string;\n  docName: string;\n  docNumber: string;\n  status: string;\n  dateOfIssue: string;\n  revisionNo: number;\n  preparedBy: string;\n  preparerName?: string;\n  approverName?: string;\n  issuerName?: string;\n  departments?: Array<{ id: string; name: string }>;\n  approvedAt?: string;\n  issuedAt?: string;\n  createdAt?: string;\n}\n\ninterface Notification {\n  id: string;\n  message: string;\n  type: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\nexport default function ApproverDashboard({ \n  onLogout, \n  userId = \"approver-1\",\n  approverName = \"Sarah Johnson\" \n}: ApproverDashboardProps) {\n  const [approveDialogOpen, setApproveDialogOpen] = useState(false);\n  const [declineDialogOpen, setDeclineDialogOpen] = useState(false);\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [wordViewerOpen, setWordViewerOpen] = useState(false);\n  const [wordViewDocId, setWordViewDocId] = useState<string>(\"\");\n  const [pdfViewerOpen, setPdfViewerOpen] = useState(false);\n  const [pdfDocId, setPdfDocId] = useState<string>(\"\");\n  const [pdfDocName, setPdfDocName] = useState<string>(\"\");\n  const [selectedDoc, setSelectedDoc] = useState<ApiDocument | null>(null);\n  const [viewDoc, setViewDoc] = useState<Document | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: pendingDocs = [], isLoading: isLoadingDocs } = useQuery<ApiDocument[]>({\n    queryKey: [\"/api/documents\", \"pending\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/documents?status=pending\");\n      if (!response.ok) throw new Error(\"Failed to fetch documents\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const { data: approvedDocs = [] } = useQuery<ApiDocument[]>({\n    queryKey: [\"/api/documents\", \"approved\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/documents?status=approved\");\n      if (!response.ok) throw new Error(\"Failed to fetch documents\");\n      return response.json();\n    },\n  });\n\n  const { data: issuedDocuments = [] } = useQuery<ApiDocument[]>({\n    queryKey: [\"/api/documents\", \"issued\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/documents?status=issued\");\n      if (!response.ok) throw new Error(\"Failed to fetch issued documents\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\", userId],\n    queryFn: async () => {\n      const response = await fetch(`/api/notifications/${userId}`);\n      if (!response.ok) throw new Error(\"Failed to fetch notifications\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const { data: departments = [] } = useQuery({\n    queryKey: [\"/api/departments\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/departments\");\n      if (!response.ok) throw new Error(\"Failed to fetch departments\");\n      return response.json();\n    },\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async (data: { \n      documentId: string; \n      approvalRemarks: string; \n      departments: string[]; \n      approverName: string \n    }) => {\n      const response = await fetch(`/api/documents/${data.documentId}/approve`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          approvalRemarks: data.approvalRemarks,\n          approvedBy: userId,\n          approverName: data.approverName,\n          departments: data.departments,\n        }),\n      });\n      if (!response.ok) throw new Error(\"Failed to approve document\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\"] });\n      toast({\n        title: \"Document Approved\",\n        description: \"The document has been successfully approved and sent to the issuer.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to approve document. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const declineMutation = useMutation({\n    mutationFn: async (data: { documentId: string; declineRemarks: string }) => {\n      const response = await fetch(`/api/documents/${data.documentId}/decline`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ declineRemarks: data.declineRemarks }),\n      });\n      if (!response.ok) throw new Error(\"Failed to decline document\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\"] });\n      toast({\n        title: \"Document Declined\",\n        description: \"The document has been sent back to the creator for revision.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to decline document. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleView = (doc: Document) => {\n    setViewDoc(doc);\n    setViewDialogOpen(true);\n  };\n\n  const handleViewWord = (doc: Document) => {\n    setWordViewDocId(doc.id);\n    setWordViewerOpen(true);\n  };\n\n  const handleDownload = async (doc: Document) => {\n    try {\n      const response = await fetch(`/api/documents/${doc.id}/download`);\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to download document');\n      }\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `${doc.docNumber}_${doc.docName}.docx`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      toast({\n        title: \"Download Started\",\n        description: `Downloading ${doc.docName} as Word document...`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Download Failed\",\n        description: error.message || \"Failed to download Word document\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleApprove = (doc: ApiDocument) => {\n    setSelectedDoc(doc);\n    setApproveDialogOpen(true);\n  };\n\n  const handleDecline = (doc: ApiDocument) => {\n    setSelectedDoc(doc);\n    setDeclineDialogOpen(true);\n  };\n\n  const handleViewPDF = (doc: Document) => {\n    setPdfDocId(doc.id);\n    setPdfDocName(doc.docName);\n    setPdfViewerOpen(true);\n  };\n\n  const todayApproved = approvedDocs.filter(doc => {\n    const approvedDate = doc.approvedAt ? new Date(doc.approvedAt) : null;\n    const today = new Date();\n    return approvedDate && \n      approvedDate.getDate() === today.getDate() &&\n      approvedDate.getMonth() === today.getMonth() &&\n      approvedDate.getFullYear() === today.getFullYear();\n  }).length;\n\n  const unreadNotifications = notifications.filter(n => !n.isRead).length;\n\n  const transformedDocs: Document[] = pendingDocs.map(doc => ({\n    id: doc.id,\n    docName: doc.docName,\n    docNumber: doc.docNumber,\n    status: (doc.status.charAt(0).toUpperCase() + doc.status.slice(1)) as DocumentStatus,\n    dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n    revisionNo: doc.revisionNo,\n    preparedBy: doc.preparerName || 'Unknown',\n  }));\n\n  const transformedIssuedDocs: Document[] = issuedDocuments.map(doc => ({\n    id: doc.id,\n    docName: doc.docName,\n    docNumber: doc.docNumber,\n    status: \"Issued\" as const,\n    dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n    revisionNo: doc.revisionNo,\n    preparedBy: doc.preparerName || 'Unknown',\n  }));\n\n  return (\n    <DashboardLayout\n      userRole=\"Document Approver\"\n      userName={approverName}\n      userId={userId}\n      notificationCount={unreadNotifications}\n      onLogout={onLogout}\n    >\n      <div className=\"space-y-6\">\n        <div>\n          <h2 className=\"text-3xl font-semibold text-foreground\">Pending Approvals</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Review and approve documents for issuance\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <StatCard\n            title=\"Pending Approval\"\n            value={pendingDocs.length}\n            icon={Clock}\n            trend=\"Requires your review\"\n          />\n          <StatCard \n            title=\"Approved Today\" \n            value={todayApproved} \n            icon={CheckCircle} \n            trend={`Total approved: ${approvedDocs.length}`} \n          />\n          <StatCard\n            title=\"Total Reviewed\"\n            value={approvedDocs.length + pendingDocs.length}\n            icon={FileText}\n            trend=\"All time documents\"\n          />\n        </div>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-lg font-semibold\">Documents Awaiting Review</h3>\n            <Button variant=\"outline\" size=\"sm\" data-testid=\"button-export\">\n              Export Log\n            </Button>\n          </div>\n\n          {isLoadingDocs ? (\n            <div className=\"text-center py-8 text-muted-foreground\">Loading documents...</div>\n          ) : transformedDocs.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">No pending documents</div>\n          ) : (\n            <DocumentTable\n              documents={transformedDocs}\n              onView={handleView}\n              onViewWord={handleViewWord}\n              onDownload={handleDownload}\n              onApprove={handleApprove}\n              onDecline={handleDecline}\n            />\n          )}\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Issued Documents (View as PDF)</h3>\n          {transformedIssuedDocs.length > 0 ? (\n            <DocumentTable\n              documents={transformedIssuedDocs.slice(0, 10)}\n              onView={handleViewPDF}\n              showActions={true}\n            />\n          ) : (\n            <div className=\"border rounded-lg p-12 text-center\">\n              <Send className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-sm text-muted-foreground\">No issued documents yet</p>\n            </div>\n          )}\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Document Workflow</h3>\n          <WorkflowProgress currentStep=\"Approver\" />\n          <div className=\"mt-6 p-4 bg-muted/30 rounded-lg\">\n            <p className=\"text-sm text-muted-foreground\">\n              <strong>Your Role:</strong> Review documents with auto-generated headers/footers,\n              approve or decline with remarks, and select departments for document sharing.\n            </p>\n          </div>\n        </Card>\n      </div>\n\n      <ApprovalDialog\n        open={approveDialogOpen}\n        onClose={() => setApproveDialogOpen(false)}\n        onApprove={(data) => {\n          if (selectedDoc) {\n            approveMutation.mutate({\n              documentId: selectedDoc.id,\n              approvalRemarks: data.remarks,\n              departments: data.departments,\n              approverName: data.approverName,\n            });\n          }\n          setApproveDialogOpen(false);\n        }}\n        type=\"approve\"\n        title={`Approve: ${selectedDoc?.docName}`}\n        approverName={approverName}\n      />\n\n      <ApprovalDialog\n        open={declineDialogOpen}\n        onClose={() => setDeclineDialogOpen(false)}\n        onDecline={(remarks) => {\n          if (selectedDoc) {\n            declineMutation.mutate({\n              documentId: selectedDoc.id,\n              declineRemarks: remarks,\n            });\n          }\n          setDeclineDialogOpen(false);\n        }}\n        type=\"decline\"\n        title={`Decline: ${selectedDoc?.docName}`}\n      />\n\n      <DocumentViewDialog\n        document={viewDoc}\n        open={viewDialogOpen}\n        onClose={() => setViewDialogOpen(false)}\n        onDownload={viewDoc ? () => handleViewWord(viewDoc) : () => {}}\n      />\n\n      <WordDocumentViewer\n        documentId={wordViewDocId}\n        open={wordViewerOpen}\n        onOpenChange={setWordViewerOpen}\n      />\n\n      <PDFViewer\n        documentId={pdfDocId}\n        userId={userId}\n        open={pdfViewerOpen}\n        onClose={() => setPdfViewerOpen(false)}\n        documentName={pdfDocName}\n      />\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":13602,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/DocumentViewDialog.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Document } from \"./DocumentTable\";\nimport { Download, FileText, Calendar, User, Hash, Clock, AlertCircle, GitCompare } from \"lucide-react\";\nimport StatusBadge from \"./StatusBadge\";\nimport WorkflowProgress, { WorkflowStep } from \"./WorkflowProgress\";\n\ninterface DocumentViewDialogProps {\n  document: Document | null;\n  open: boolean;\n  onClose: () => void;\n  onDownload?: (doc: Document) => void;\n}\n\ninterface DocumentDetails {\n  id: string;\n  docName: string;\n  docNumber: string;\n  status: string;\n  dateOfIssue: string;\n  revisionNo: number;\n  preparerName: string;\n  approverName?: string;\n  issuerName?: string;\n  content?: string;\n  headerInfo?: string;\n  footerInfo?: string;\n  approvalRemarks?: string;\n  declineRemarks?: string;\n  issueRemarks?: string;\n  departments?: Array<{ id: string; name: string }>;\n  previousVersion?: DocumentDetails;\n}\n\nexport default function DocumentViewDialog({\n  document,\n  open,\n  onClose,\n  onDownload,\n}: DocumentViewDialogProps) {\n  const { data: docDetails, isLoading } = useQuery<DocumentDetails>({\n    queryKey: [\"/api/documents\", document?.id],\n    queryFn: async () => {\n      if (!document?.id) throw new Error(\"No document ID\");\n      const response = await fetch(`/api/documents/${document.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch document details\");\n      return response.json();\n    },\n    enabled: open && !!document?.id,\n  });\n\n  if (!document) return null;\n\n  const getWorkflowStep = (): WorkflowStep => {\n    switch (document.status) {\n      case \"Pending\":\n        return \"Approver\";\n      case \"Approved\":\n        return \"Issuer\";\n      case \"Issued\":\n        return \"Issued\";\n      default:\n        return \"Creator\";\n    }\n  };\n\n  const parseJsonOrText = (data: string): { isJson: boolean; parsed?: any; text?: string } => {\n    try {\n      const parsed = JSON.parse(data);\n      return { isJson: true, parsed };\n    } catch {\n      return { isJson: false, text: data };\n    }\n  };\n\n  const renderHeaderFooter = () => {\n    if (!docDetails?.headerInfo && !docDetails?.footerInfo) return null;\n\n    return (\n      <Card className=\"p-6 border-blue-200 dark:border-blue-900 bg-blue-50/30 dark:bg-blue-950/20\">\n        <h3 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n          <FileText className=\"w-5 h-5 text-blue-600\" />\n          Document Header & Footer Information\n        </h3>\n        <div className=\"space-y-4\">\n          {docDetails.headerInfo && (\n            <div>\n              <h4 className=\"text-sm font-medium text-muted-foreground mb-2\">Header Information</h4>\n              <div className=\"bg-white dark:bg-gray-900 p-4 rounded-md border\">\n                {(() => {\n                  const { isJson, parsed, text } = parseJsonOrText(docDetails.headerInfo);\n                  if (isJson && parsed) {\n                    return (\n                      <div className=\"space-y-2 text-sm\">\n                        {Object.entries(parsed).map(([key, value]) => (\n                          <div key={key} className=\"flex gap-2\">\n                            <span className=\"font-medium text-muted-foreground\">{key}:</span>\n                            <span className=\"font-medium\">{String(value)}</span>\n                          </div>\n                        ))}\n                      </div>\n                    );\n                  }\n                  return <pre className=\"text-sm whitespace-pre-wrap\">{text}</pre>;\n                })()}\n              </div>\n            </div>\n          )}\n          {docDetails.footerInfo && (\n            <div>\n              <h4 className=\"text-sm font-medium text-muted-foreground mb-2\">Footer Information</h4>\n              <div className=\"bg-white dark:bg-gray-900 p-4 rounded-md border\">\n                {(() => {\n                  const { isJson, parsed, text } = parseJsonOrText(docDetails.footerInfo);\n                  if (isJson && parsed) {\n                    return (\n                      <div className=\"space-y-2 text-sm\">\n                        {Object.entries(parsed).map(([key, value]) => (\n                          <div key={key} className=\"flex gap-2\">\n                            <span className=\"font-medium text-muted-foreground\">{key}:</span>\n                            <span className=\"font-medium\">{String(value)}</span>\n                          </div>\n                        ))}\n                      </div>\n                    );\n                  }\n                  return <pre className=\"text-sm whitespace-pre-wrap\">{text}</pre>;\n                })()}\n              </div>\n            </div>\n          )}\n        </div>\n      </Card>\n    );\n  };\n\n  const renderRevisionComparison = () => {\n    if (!docDetails?.previousVersion) return null;\n\n    return (\n      <Card className=\"p-6 border-amber-200 dark:border-amber-900\">\n        <div className=\"flex items-start gap-3 mb-4\">\n          <GitCompare className=\"w-5 h-5 text-amber-600 mt-0.5\" />\n          <div>\n            <h3 className=\"text-lg font-semibold\">Revision Comparison</h3>\n            <p className=\"text-sm text-muted-foreground\">Compare with previous version (Rev {docDetails.previousVersion.revisionNo})</p>\n          </div>\n        </div>\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-semibold text-muted-foreground\">Previous Version (Rev {docDetails.previousVersion.revisionNo})</h4>\n            <div className=\"bg-muted/30 p-3 rounded-md space-y-1 text-sm\">\n              <p><strong>Status:</strong> {docDetails.previousVersion.status}</p>\n              <p><strong>Date:</strong> {new Date(docDetails.previousVersion.dateOfIssue).toLocaleDateString()}</p>\n              {docDetails.previousVersion.approverName && (\n                <p><strong>Approved By:</strong> {docDetails.previousVersion.approverName}</p>\n              )}\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-semibold text-muted-foreground\">Current Version (Rev {docDetails.revisionNo})</h4>\n            <div className=\"bg-primary/10 p-3 rounded-md space-y-1 text-sm\">\n              <p><strong>Status:</strong> {docDetails.status}</p>\n              <p><strong>Date:</strong> {new Date(docDetails.dateOfIssue).toLocaleDateString()}</p>\n              {docDetails.approverName && (\n                <p><strong>Approved By:</strong> {docDetails.approverName}</p>\n              )}\n            </div>\n          </div>\n        </div>\n      </Card>\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-view-document\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-3\">\n            <FileText className=\"w-6 h-6 text-primary\" />\n            {document.docName}\n          </DialogTitle>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"py-12 text-center text-muted-foreground\">Loading document details...</div>\n        ) : (\n          <div className=\"space-y-6 py-4\">\n            <div className=\"flex items-center justify-between\">\n              <StatusBadge status={document.status} />\n              {onDownload && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => onDownload(document)}\n                  data-testid=\"button-download-doc\"\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Download as Word\n                </Button>\n              )}\n            </div>\n\n            <Card className=\"p-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Document Information</h3>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Hash className=\"w-4 h-4\" />\n                    Document Number\n                  </div>\n                  <p className=\"font-mono text-sm font-medium\">{document.docNumber}</p>\n                </div>\n\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Calendar className=\"w-4 h-4\" />\n                    Date of Issue\n                  </div>\n                  <p className=\"text-sm font-medium\">{document.dateOfIssue}</p>\n                </div>\n\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Clock className=\"w-4 h-4\" />\n                    Revision Number\n                  </div>\n                  <p className=\"text-sm font-medium\">Rev {document.revisionNo}</p>\n                </div>\n\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <User className=\"w-4 h-4\" />\n                    Prepared By\n                  </div>\n                  <p className=\"text-sm font-medium\">{document.preparedBy}</p>\n                </div>\n\n                {docDetails?.approverName && (\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <User className=\"w-4 h-4\" />\n                      Approved By\n                    </div>\n                    <p className=\"text-sm font-medium\">{docDetails.approverName}</p>\n                  </div>\n                )}\n\n                {docDetails?.issuerName && (\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <User className=\"w-4 h-4\" />\n                      Issued By\n                    </div>\n                    <p className=\"text-sm font-medium\">{docDetails.issuerName}</p>\n                  </div>\n                )}\n              </div>\n\n              {docDetails?.departments && docDetails.departments.length > 0 && (\n                <div className=\"mt-4 pt-4 border-t\">\n                  <h4 className=\"text-sm font-medium text-muted-foreground mb-2\">Shared with Departments</h4>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {docDetails.departments.map(dept => (\n                      <span key={dept.id} className=\"px-2 py-1 bg-primary/10 text-primary rounded-md text-xs font-medium\">\n                        {dept.name}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {docDetails?.approvalRemarks && (\n                <div className=\"mt-4 pt-4 border-t\">\n                  <h4 className=\"text-sm font-medium text-muted-foreground mb-2\">Approval Remarks</h4>\n                  <p className=\"text-sm bg-green-50 dark:bg-green-950/20 p-3 rounded-md\">{docDetails.approvalRemarks}</p>\n                </div>\n              )}\n\n              {docDetails?.declineRemarks && (\n                <div className=\"mt-4 pt-4 border-t\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <AlertCircle className=\"w-4 h-4 text-destructive\" />\n                    <h4 className=\"text-sm font-medium text-destructive\">Decline Remarks</h4>\n                  </div>\n                  <p className=\"text-sm bg-red-50 dark:bg-red-950/20 p-3 rounded-md\">{docDetails.declineRemarks}</p>\n                </div>\n              )}\n\n              {docDetails?.issueRemarks && (\n                <div className=\"mt-4 pt-4 border-t\">\n                  <h4 className=\"text-sm font-medium text-muted-foreground mb-2\">Issuance Remarks</h4>\n                  <p className=\"text-sm bg-blue-50 dark:bg-blue-950/20 p-3 rounded-md\">{docDetails.issueRemarks}</p>\n                </div>\n              )}\n            </Card>\n\n            {renderRevisionComparison()}\n            {renderHeaderFooter()}\n\n            <Card className=\"p-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Document Workflow</h3>\n              <WorkflowProgress currentStep={getWorkflowStep()} />\n            </Card>\n          </div>\n        )}\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={onClose}>Close</Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":12760,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/pages/LoginPage.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card } from \"@/components/ui/card\";\nimport { FileText, Upload, CheckCircle, ShieldCheck, FolderKanban, Phone, Moon, Sun } from \"lucide-react\";\nimport { SiGoogle, SiFacebook } from \"react-icons/si\";\nimport { useState, useEffect } from \"react\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\nconst loginSchema = z.object({\n  username: z.string().min(1, \"Email is required\").email(\"Please enter a valid email\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\ntype LoginFormValues = z.infer<typeof loginSchema>;\n\ninterface LoginPageProps {\n  onLogin?: (data: LoginFormValues) => void;\n}\n\nexport default function LoginPage({ onLogin }: LoginPageProps) {\n  const [isDark, setIsDark] = useState(false);\n\n  useEffect(() => {\n    const savedTheme = localStorage.getItem('theme');\n    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n    const shouldBeDark = savedTheme === 'dark' || (!savedTheme && prefersDark);\n    setIsDark(shouldBeDark);\n    document.documentElement.classList.toggle('dark', shouldBeDark);\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = !isDark;\n    setIsDark(newTheme);\n    document.documentElement.classList.toggle('dark', newTheme);\n    localStorage.setItem('theme', newTheme ? 'dark' : 'light');\n  };\n\n  const form = useForm<LoginFormValues>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n  const handleSubmit = (data: LoginFormValues) => {\n    console.log(\"Login attempt:\", data);\n    onLogin?.(data);\n  };\n\n  const features = [\n    { icon: Upload, title: \"Document Creation\", desc: \"Upload documents with metadata\" },\n    { icon: CheckCircle, title: \"Approval Workflow\", desc: \"Multi-level approval process\" },\n    { icon: ShieldCheck, title: \"Access Control\", desc: \"Role-based permissions\" },\n    { icon: FolderKanban, title: \"Version Tracking\", desc: \"Complete version history\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background dark:bg-gray-900 flex flex-col\">\n      <header className=\"flex items-center justify-between px-6 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2 bg-blue-600 rounded-lg\">\n            <FileText className=\"w-6 h-6 text-white\" />\n          </div>\n          <span className=\"text-lg font-bold text-foreground\">Document Management System</span>\n        </div>\n        <Button \n          variant=\"ghost\" \n          size=\"icon\" \n          onClick={toggleTheme}\n          data-testid=\"button-theme-toggle\"\n        >\n          {isDark ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}\n        </Button>\n      </header>\n\n      <div className=\"flex-1 flex\">\n        <div className=\"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 p-12 flex-col justify-center\">\n          <div className=\"max-w-lg space-y-8\">\n            <div className=\"inline-block px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-sm font-medium rounded-full\">\n              Modern Document Control\n            </div>\n            \n            <div>\n              <h1 className=\"text-4xl font-bold mb-4 text-gray-900 dark:text-white\">\n                Streamline Your Document Workflows\n              </h1>\n              <p className=\"text-gray-600 dark:text-gray-300 text-lg\">\n                A secure, role-based system for managing SOPs, forms, and revisions with approval workflows and version control.\n              </p>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-6\">\n              {features.map((feature, idx) => (\n                <div key={idx} className=\"space-y-2\">\n                  <div className=\"p-3 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg w-fit\">\n                    <feature.icon className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <h3 className=\"font-semibold text-gray-900 dark:text-white\">{feature.title}</h3>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">{feature.desc}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex-1 flex items-center justify-center p-4 bg-white dark:bg-gray-900\">\n          <Card className=\"w-full max-w-md p-8 shadow-xl bg-white dark:bg-gray-800\">\n            <div className=\"mb-6\">\n              <h2 className=\"text-2xl font-bold text-foreground\">Sign In</h2>\n            </div>\n\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"username\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"email\"\n                          placeholder=\"Enter your email\" \n                          {...field} \n                          data-testid=\"input-username\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Password</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"password\"\n                          placeholder=\"Enter your password\"\n                          {...field}\n                          data-testid=\"input-password\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button type=\"submit\" className=\"w-full bg-blue-600 hover:bg-blue-700\" data-testid=\"button-login\">\n                  Sign In\n                </Button>\n              </form>\n            </Form>\n\n            <div className=\"mt-6\">\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <div className=\"w-full border-t border-muted\"></div>\n                </div>\n                <div className=\"relative flex justify-center text-xs uppercase\">\n                  <span className=\"bg-card px-2 text-muted-foreground\">OR CONTINUE WITH</span>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-3 mt-4\">\n                <Button variant=\"outline\" size=\"sm\" type=\"button\" data-testid=\"button-google-login\">\n                  <SiGoogle className=\"w-4 h-4\" />\n                </Button>\n                <Button variant=\"outline\" size=\"sm\" type=\"button\" data-testid=\"button-facebook-login\">\n                  <SiFacebook className=\"w-4 h-4\" />\n                </Button>\n                <Button variant=\"outline\" size=\"sm\" type=\"button\" data-testid=\"button-phone-login\">\n                  <Phone className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n              <p className=\"text-xs font-semibold text-foreground mb-2\">Demo Credentials:</p>\n              <div className=\"space-y-1 text-xs\">\n                <p className=\"text-muted-foreground\">\n                  <span className=\"font-medium text-blue-600 dark:text-blue-400\">Creator:</span> Priyanka.k@cybaemtech.com / 123\n                </p>\n                <p className=\"text-muted-foreground\">\n                  <span className=\"font-medium text-green-600 dark:text-green-400\">Approver:</span> approver@cybaem.com / 123\n                </p>\n                <p className=\"text-muted-foreground\">\n                  <span className=\"font-medium text-purple-600 dark:text-purple-400\">Issuer:</span> issuer@cybaem.com / 123\n                </p>\n                <p className=\"text-muted-foreground\">\n                  <span className=\"font-medium text-orange-600 dark:text-orange-400\">Admin:</span> admin@cybaem.com / 123\n                </p>\n              </div>\n            </div>\n          </Card>\n        </div>\n      </div>\n\n      <footer className=\"text-center py-4 text-sm text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700\">\n        © 2024 Document Management System. All rights reserved.\n        <br />\n        Designed and maintained by{\" \"}\n        <a \n          href=\"https://www.cybaemtech.com/\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"text-blue-600 dark:text-blue-400 hover:underline\"\n        >\n          Cybaem Tech\n        </a>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":9370,"size_tokens":null},"client/src/components/ApprovalDialog.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { ChevronDown, ChevronRight, Search, X } from \"lucide-react\";\nimport departmentData from \"../../../shared/departmentData.json\";\n\ninterface DepartmentItem {\n  id: string;\n  name: string;\n}\n\ninterface DepartmentCategory {\n  id: string;\n  name: string;\n  departments: DepartmentItem[];\n}\n\ninterface ApprovalDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onApprove?: (data: { remarks: string; departments: string[]; approverName: string }) => void;\n  onDecline?: (remarks: string) => void;\n  title?: string;\n  type?: \"approve\" | \"decline\";\n  approverName?: string;\n}\n\nexport default function ApprovalDialog({\n  open,\n  onClose,\n  onApprove,\n  onDecline,\n  title = \"Document Approval\",\n  type = \"approve\",\n  approverName: initialApproverName = \"\",\n}: ApprovalDialogProps) {\n  const [remarks, setRemarks] = useState(\"\");\n  const [selectedDepartments, setSelectedDepartments] = useState<string[]>([]);\n  const [approverName, setApproverName] = useState(initialApproverName);\n  const [dropdownOpen, setDropdownOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [expandedCategories, setExpandedCategories] = useState<string[]>(\n    departmentData.categories.map((cat) => cat.id)\n  );\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  const categories: DepartmentCategory[] = departmentData.categories;\n\n  useEffect(() => {\n    setApproverName(initialApproverName);\n  }, [initialApproverName]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setDropdownOpen(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  const toggleCategory = (categoryId: string) => {\n    setExpandedCategories((prev) =>\n      prev.includes(categoryId)\n        ? prev.filter((id) => id !== categoryId)\n        : [...prev, categoryId]\n    );\n  };\n\n  const handleDepartmentToggle = (deptId: string) => {\n    setSelectedDepartments((prev) =>\n      prev.includes(deptId) ? prev.filter((id) => id !== deptId) : [...prev, deptId]\n    );\n  };\n\n  const handleSelectAllCategory = (category: DepartmentCategory) => {\n    const categoryDeptIds = category.departments.map((d) => d.id);\n    const allSelected = categoryDeptIds.every((id) => selectedDepartments.includes(id));\n    \n    if (allSelected) {\n      setSelectedDepartments((prev) => prev.filter((id) => !categoryDeptIds.includes(id)));\n    } else {\n      setSelectedDepartments((prev) => Array.from(new Set([...prev, ...categoryDeptIds])));\n    }\n  };\n\n  const clearAllSelections = () => {\n    setSelectedDepartments([]);\n  };\n\n  const removeDepartment = (deptId: string) => {\n    setSelectedDepartments((prev) => prev.filter((id) => id !== deptId));\n  };\n\n  const getDepartmentName = (deptId: string): string => {\n    for (const category of categories) {\n      const dept = category.departments.find((d) => d.id === deptId);\n      if (dept) return dept.name;\n    }\n    return deptId;\n  };\n\n  const getFilteredCategories = (): DepartmentCategory[] => {\n    if (!searchQuery.trim()) return categories;\n\n    return categories\n      .map((category) => ({\n        ...category,\n        departments: category.departments.filter((dept) =>\n          dept.name.toLowerCase().includes(searchQuery.toLowerCase())\n        ),\n      }))\n      .filter((category) => category.departments.length > 0);\n  };\n\n  const getCategorySelectedCount = (category: DepartmentCategory): number => {\n    return category.departments.filter((d) => selectedDepartments.includes(d.id)).length;\n  };\n\n  const getSelectedDepartmentObjects = (): { id: string; name: string }[] => {\n    return selectedDepartments.map((deptId) => ({\n      id: deptId,\n      name: getDepartmentName(deptId),\n    }));\n  };\n\n  const handleSubmit = () => {\n    if (type === \"approve\") {\n      const departmentObjects = getSelectedDepartmentObjects();\n      onApprove?.({ remarks, departments: departmentObjects.map(d => d.id), approverName });\n    } else {\n      onDecline?.(remarks);\n    }\n    setRemarks(\"\");\n    setSelectedDepartments([]);\n    setApproverName(\"\");\n    setSearchQuery(\"\");\n    onClose();\n  };\n\n  const filteredCategories = getFilteredCategories();\n  const displayedDepartments = selectedDepartments.slice(0, 6);\n  const remainingCount = selectedDepartments.length - 6;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-approval\">\n        <DialogHeader>\n          <DialogTitle>{title}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          {type === \"approve\" && (\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"approverName\">Approved By *</Label>\n              <Input\n                id=\"approverName\"\n                placeholder=\"Enter your name\"\n                value={approverName}\n                onChange={(e) => setApproverName(e.target.value)}\n                className=\"bg-muted\"\n                data-testid=\"input-approver-name\"\n              />\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"remarks\">Remarks *</Label>\n            <Textarea\n              id=\"remarks\"\n              placeholder={\n                type === \"approve\"\n                  ? \"Add approval remarks...\"\n                  : \"Add reason for declining...\"\n              }\n              value={remarks}\n              onChange={(e) => setRemarks(e.target.value)}\n              rows={4}\n              className=\"bg-muted\"\n              data-testid=\"input-remarks\"\n            />\n          </div>\n\n          {type === \"approve\" && (\n            <div className=\"space-y-3\">\n              <Label>Share with Departments (Optional)</Label>\n              \n              <div className=\"relative\" ref={dropdownRef}>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setDropdownOpen(!dropdownOpen)}\n                  className=\"w-full justify-between bg-muted border-border\"\n                  data-testid=\"dropdown-departments\"\n                >\n                  <span className=\"text-muted-foreground\">\n                    {selectedDepartments.length > 0\n                      ? `${selectedDepartments.length} department(s) selected`\n                      : \"Select departments...\"}\n                  </span>\n                  <ChevronDown className={`h-4 w-4 transition-transform ${dropdownOpen ? \"rotate-180\" : \"\"}`} />\n                </Button>\n\n                {dropdownOpen && (\n                  <div className=\"absolute z-50 w-full mt-1 bg-card border border-border rounded-md shadow-lg\">\n                    <div className=\"p-2 border-b border-border\">\n                      <div className=\"relative\">\n                        <Search className=\"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          placeholder=\"Search departments...\"\n                          value={searchQuery}\n                          onChange={(e) => setSearchQuery(e.target.value)}\n                          className=\"pl-8 bg-muted\"\n                          data-testid=\"input-search-departments\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"max-h-[400px] overflow-y-auto\">\n                      {filteredCategories.map((category) => {\n                        const isExpanded = expandedCategories.includes(category.id);\n                        const selectedCount = getCategorySelectedCount(category);\n                        const allSelected = category.departments.every((d) =>\n                          selectedDepartments.includes(d.id)\n                        );\n\n                        return (\n                          <div key={category.id} className=\"border-b border-border last:border-b-0\">\n                            <div\n                              className=\"flex items-center justify-between p-2 hover-elevate cursor-pointer\"\n                              onClick={() => toggleCategory(category.id)}\n                              data-testid={`category-header-${category.id}`}\n                            >\n                              <div className=\"flex items-center gap-2\">\n                                {isExpanded ? (\n                                  <ChevronDown className=\"h-4 w-4\" />\n                                ) : (\n                                  <ChevronRight className=\"h-4 w-4\" />\n                                )}\n                                <span className=\"font-medium\">{category.name}</span>\n                                <span className=\"text-xs text-muted-foreground\">\n                                  ({selectedCount}/{category.departments.length})\n                                </span>\n                              </div>\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  handleSelectAllCategory(category);\n                                }}\n                                className=\"text-xs h-6\"\n                                data-testid={`button-select-all-${category.id}`}\n                              >\n                                {allSelected ? \"Deselect All\" : \"Select All\"}\n                              </Button>\n                            </div>\n\n                            {isExpanded && (\n                              <div className=\"pb-2 px-2\">\n                                {category.departments.map((dept) => (\n                                  <div\n                                    key={dept.id}\n                                    className=\"flex items-center gap-2 py-1.5 px-6 hover-elevate rounded cursor-pointer\"\n                                    onClick={() => handleDepartmentToggle(dept.id)}\n                                    data-testid={`dept-item-${dept.id}`}\n                                  >\n                                    <Checkbox\n                                      checked={selectedDepartments.includes(dept.id)}\n                                      onCheckedChange={() => handleDepartmentToggle(dept.id)}\n                                      data-testid={`checkbox-dept-${dept.id}`}\n                                    />\n                                    <span className=\"text-sm\">{dept.name}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            )}\n                          </div>\n                        );\n                      })}\n\n                      {filteredCategories.length === 0 && (\n                        <div className=\"p-4 text-center text-muted-foreground\">\n                          No departments found matching \"{searchQuery}\"\n                        </div>\n                      )}\n                    </div>\n\n                    <div className=\"flex items-center justify-between p-2 border-t border-border bg-muted/50\">\n                      <span className=\"text-sm text-muted-foreground\">\n                        {selectedDepartments.length} selected\n                      </span>\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={clearAllSelections}\n                        className=\"text-xs\"\n                        data-testid=\"button-clear-all\"\n                      >\n                        Clear All\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {selectedDepartments.length > 0 && (\n                <div className=\"flex flex-wrap gap-2 mt-2\">\n                  {displayedDepartments.map((deptId) => (\n                    <span\n                      key={deptId}\n                      className=\"inline-flex items-center gap-1 px-2 py-1 text-xs bg-primary/10 text-primary border border-primary/20 rounded-md\"\n                      data-testid={`tag-dept-${deptId}`}\n                    >\n                      {getDepartmentName(deptId)}\n                      <button\n                        type=\"button\"\n                        onClick={() => removeDepartment(deptId)}\n                        className=\"hover:bg-primary/20 rounded p-0.5\"\n                        data-testid={`remove-dept-${deptId}`}\n                      >\n                        <X className=\"h-3 w-3\" />\n                      </button>\n                    </span>\n                  ))}\n                  {remainingCount > 0 && (\n                    <span className=\"inline-flex items-center px-2 py-1 text-xs bg-muted text-muted-foreground rounded-md\">\n                      +{remainingCount} more\n                    </span>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={onClose} data-testid=\"button-cancel\">\n            Cancel\n          </Button>\n          <Button\n            onClick={handleSubmit}\n            disabled={!remarks.trim() || (type === \"approve\" && !approverName.trim())}\n            variant={type === \"approve\" ? \"default\" : \"destructive\"}\n            data-testid={`button-${type}`}\n          >\n            {type === \"approve\" ? \"Approve\" : \"Decline\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":14297,"size_tokens":null},"client/src/components/ActivityFeed.tsx":{"content":"import { FileText, CheckCircle, XCircle, Send, Clock } from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\n\ninterface Activity {\n  id: string;\n  type: \"created\" | \"approved\" | \"declined\" | \"issued\" | \"pending\";\n  docName: string;\n  userName: string;\n  timestamp: string;\n  remarks?: string;\n}\n\ninterface ActivityFeedProps {\n  activities: Activity[];\n  maxItems?: number;\n}\n\nexport default function ActivityFeed({ activities, maxItems = 10 }: ActivityFeedProps) {\n  const getIcon = (type: Activity[\"type\"]) => {\n    switch (type) {\n      case \"created\":\n        return <FileText className=\"w-4 h-4 text-blue-600\" />;\n      case \"approved\":\n        return <CheckCircle className=\"w-4 h-4 text-green-600\" />;\n      case \"declined\":\n        return <XCircle className=\"w-4 h-4 text-red-600\" />;\n      case \"issued\":\n        return <Send className=\"w-4 h-4 text-purple-600\" />;\n      case \"pending\":\n        return <Clock className=\"w-4 h-4 text-amber-600\" />;\n    }\n  };\n\n  const getActionText = (type: Activity[\"type\"]) => {\n    switch (type) {\n      case \"created\":\n        return \"created\";\n      case \"approved\":\n        return \"approved\";\n      case \"declined\":\n        return \"declined\";\n      case \"issued\":\n        return \"issued\";\n      case \"pending\":\n        return \"submitted for review\";\n    }\n  };\n\n  return (\n    <Card className=\"p-6\" data-testid=\"card-activity-feed\">\n      <h3 className=\"text-lg font-semibold mb-4\">Recent Activity</h3>\n      <div className=\"space-y-4\">\n        {activities.slice(0, maxItems).map((activity, index) => (\n          <div\n            key={activity.id}\n            className={`flex gap-3 py-3 ${index !== activities.length - 1 ? \"border-b\" : \"\"}`}\n            data-testid={`activity-${activity.id}`}\n          >\n            <div className=\"mt-0.5\">{getIcon(activity.type)}</div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm text-foreground\">\n                <span className=\"font-medium\">{activity.userName}</span>{\" \"}\n                {getActionText(activity.type)}{\" \"}\n                <span className=\"font-medium\">{activity.docName}</span>\n              </p>\n              {activity.remarks && (\n                <p className=\"text-xs text-muted-foreground mt-1 italic\">\"{activity.remarks}\"</p>\n              )}\n              <p className=\"text-xs text-muted-foreground mt-1\">{activity.timestamp}</p>\n            </div>\n          </div>\n        ))}\n      </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2475,"size_tokens":null},"client/src/components/examples/DocumentUploadForm.tsx":{"content":"import DocumentUploadForm from \"../DocumentUploadForm\";\n\nexport default function DocumentUploadFormExample() {\n  return (\n    <div className=\"p-6 max-w-4xl mx-auto\">\n      <DocumentUploadForm onSubmit={(data) => console.log(\"Document submitted:\", data)} />\n    </div>\n  );\n}\n","path":null,"size_bytes":275,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/DocumentEditDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Document } from \"./DocumentTable\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\nconst documentSchema = z.object({\n  docName: z.string().min(1, \"Document name is required\"),\n  docNumber: z.string().min(1, \"Document number is required\"),\n  dateOfIssue: z.string().min(1, \"Date of issue is required\"),\n  revisionNumber: z.string().min(1, \"Revision number is required\"),\n  duePeriodYears: z.string().optional(),\n  preparerName: z.string().min(1, \"Preparer name is required\"),\n  reasonForRevision: z.string().optional(),\n});\n\ntype DocumentFormValues = z.infer<typeof documentSchema>;\n\ninterface DocumentEditDialogProps {\n  document: Document | null;\n  open: boolean;\n  onClose: () => void;\n  onSave?: (docId: string, data: DocumentFormValues) => void;\n}\n\nexport default function DocumentEditDialog({\n  document,\n  open,\n  onClose,\n  onSave,\n}: DocumentEditDialogProps) {\n  const form = useForm<DocumentFormValues>({\n    resolver: zodResolver(documentSchema),\n    defaultValues: {\n      docName: \"\",\n      docNumber: \"\",\n      dateOfIssue: \"\",\n      revisionNumber: \"0\",\n      duePeriodYears: \"\",\n      preparerName: \"\",\n      reasonForRevision: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (document) {\n      form.reset({\n        docName: document.docName,\n        docNumber: document.docNumber,\n        dateOfIssue: document.dateOfIssue,\n        revisionNumber: document.revisionNo.toString(),\n        duePeriodYears: \"\",\n        preparerName: document.preparedBy,\n        reasonForRevision: \"\",\n      });\n    }\n  }, [document, form]);\n\n  const handleSubmit = (data: DocumentFormValues) => {\n    if (document) {\n      onSave?.(document.id, data);\n      onClose();\n    }\n  };\n\n  if (!document) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-edit-document\">\n        <DialogHeader>\n          <DialogTitle>Edit Document</DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-4 py-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"docName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Document Name *</FormLabel>\n                    <FormControl>\n                      <Input {...field} data-testid=\"input-edit-doc-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"docNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Document Number *</FormLabel>\n                    <FormControl>\n                      <Input {...field} data-testid=\"input-edit-doc-number\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"dateOfIssue\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Date of Issue *</FormLabel>\n                    <FormControl>\n                      <Input type=\"date\" {...field} data-testid=\"input-edit-date-issue\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"revisionNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Revision Number *</FormLabel>\n                    <FormControl>\n                      <Input type=\"number\" {...field} data-testid=\"input-edit-revision-number\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"duePeriodYears\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Due Period (Years)</FormLabel>\n                    <FormControl>\n                      <Input type=\"number\" {...field} data-testid=\"input-edit-due-period\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"preparerName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Preparer Name *</FormLabel>\n                    <FormControl>\n                      <Input {...field} data-testid=\"input-edit-preparer-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"reasonForRevision\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Reason for Revision</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      {...field}\n                      rows={3}\n                      data-testid=\"input-edit-revision-reason\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={onClose} data-testid=\"button-cancel-edit\">\n                Cancel\n              </Button>\n              <Button type=\"submit\" data-testid=\"button-save-edit\">\n                Save Changes\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6557,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/StatCard.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  trend?: string;\n  className?: string;\n}\n\nexport default function StatCard({ title, value, icon: Icon, trend, className }: StatCardProps) {\n  return (\n    <Card className={`p-6 ${className}`} data-testid={`card-stat-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n      <div className=\"flex items-start justify-between\">\n        <div className=\"space-y-2\">\n          <p className=\"text-sm font-medium text-muted-foreground\">{title}</p>\n          <p className=\"text-3xl font-bold text-foreground\" data-testid={`text-value-${title.toLowerCase().replace(/\\s+/g, '-')}`}>{value}</p>\n          {trend && <p className=\"text-xs text-muted-foreground\">{trend}</p>}\n        </div>\n        <div className=\"p-3 bg-primary/10 rounded-lg\">\n          <Icon className=\"w-6 h-6 text-primary\" />\n        </div>\n      </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1004,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { pdfService } from \"./services/pdf-service\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  try {\n    // Initialize PDF service directories\n    console.log('Initializing PDF service...');\n    await pdfService.initialize();\n    console.log('PDF service initialized successfully');\n    \n    // Test Puppeteer availability\n    console.log('Testing Puppeteer availability...');\n    try {\n      const puppeteer = await import('puppeteer');\n      const browser = await puppeteer.default.launch({ \n        headless: true, \n        args: ['--no-sandbox', '--disable-setuid-sandbox'] \n      });\n      await browser.close();\n      console.log('Puppeteer test successful');\n    } catch (puppeteerError) {\n      console.warn('Puppeteer test failed:', puppeteerError);\n    }\n    \n    const server = await registerRoutes(app);\n\n    app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n      const status = err.status || err.statusCode || 500;\n      const message = err.message || \"Internal Server Error\";\n\n      res.status(status).json({ message });\n      throw err;\n    });\n\n    // importantly only setup vite in development and after\n    // setting up all the other routes so the catch-all route\n    // doesn't interfere with the other routes\n    if (app.get(\"env\") === \"development\") {\n      await setupVite(app, server);\n    } else {\n      serveStatic(app);\n    }\n\n    // ALWAYS serve the app on the port specified in the environment variable PORT\n    // Other ports are firewalled. Default to 5000 if not specified.\n    // this serves both the API and the client.\n    // It is the only port that is not firewalled.\n    const port = parseInt(process.env.PORT || '5000', 10);\n    server.listen({\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    }, () => {\n      log(`serving on port ${port}`);\n    });\n  } catch (initError) {\n    console.error('Server initialization failed:', initError);\n    process.exit(1);\n  }\n})();\n","path":null,"size_bytes":3106,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/examples/WorkflowProgress.tsx":{"content":"import WorkflowProgress from \"../WorkflowProgress\";\n\nexport default function WorkflowProgressExample() {\n  return (\n    <div className=\"p-6 space-y-8\">\n      <WorkflowProgress currentStep=\"Creator\" />\n      <WorkflowProgress currentStep=\"Approver\" />\n      <WorkflowProgress currentStep=\"Issuer\" />\n      <WorkflowProgress currentStep=\"Issued\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":365,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/examples/DashboardLayout.tsx":{"content":"import DashboardLayout from \"../DashboardLayout\";\n\nexport default function DashboardLayoutExample() {\n  return (\n    <DashboardLayout\n      userRole=\"Document Creator\"\n      userName=\"John Smith\"\n      notificationCount={3}\n      onLogout={() => console.log(\"Logout clicked\")}\n    >\n      <div className=\"space-y-6\">\n        <h2 className=\"text-2xl font-bold\">Dashboard Content</h2>\n        <p className=\"text-muted-foreground\">\n          This is the main content area of the dashboard.\n        </p>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":543,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/examples/DocumentTable.tsx":{"content":"import DocumentTable, { Document } from \"../DocumentTable\";\n\nexport default function DocumentTableExample() {\n  const mockDocuments: Document[] = [\n    {\n      id: \"1\",\n      docName: \"Quality Control SOP\",\n      docNumber: \"QC-SOP-001\",\n      status: \"Pending\",\n      dateOfIssue: \"2024-11-01\",\n      revisionNo: 2,\n      preparedBy: \"John Smith\",\n    },\n    {\n      id: \"2\",\n      docName: \"Safety Guidelines\",\n      docNumber: \"SF-GL-045\",\n      status: \"Approved\",\n      dateOfIssue: \"2024-10-28\",\n      revisionNo: 1,\n      preparedBy: \"Sarah Johnson\",\n    },\n    {\n      id: \"3\",\n      docName: \"Production Format\",\n      docNumber: \"PR-FMT-023\",\n      status: \"Issued\",\n      dateOfIssue: \"2024-10-15\",\n      revisionNo: 3,\n      preparedBy: \"Mike Davis\",\n    },\n  ];\n\n  return (\n    <div className=\"p-6\">\n      <DocumentTable\n        documents={mockDocuments}\n        onView={(doc) => console.log(\"View document:\", doc)}\n        onDownload={(doc) => console.log(\"Download document:\", doc)}\n        onApprove={(doc) => console.log(\"Approve document:\", doc)}\n        onDecline={(doc) => console.log(\"Decline document:\", doc)}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":1159,"size_tokens":null},"client/src/components/WorkflowProgress.tsx":{"content":"import { CheckCircle, Circle, Clock } from \"lucide-react\";\n\nexport type WorkflowStep = \"Creator\" | \"Approver\" | \"Issuer\" | \"Issued\";\n\ninterface WorkflowProgressProps {\n  currentStep: WorkflowStep;\n  className?: string;\n}\n\nexport default function WorkflowProgress({ currentStep, className }: WorkflowProgressProps) {\n  const steps: WorkflowStep[] = [\"Creator\", \"Approver\", \"Issuer\", \"Issued\"];\n  const currentIndex = steps.indexOf(currentStep);\n\n  return (\n    <div className={`flex items-center justify-between ${className}`} data-testid=\"workflow-progress\">\n      {steps.map((step, index) => {\n        const isCompleted = index < currentIndex;\n        const isCurrent = index === currentIndex;\n        const isLast = index === steps.length - 1;\n\n        return (\n          <div key={step} className=\"flex items-center flex-1\">\n            <div className=\"flex flex-col items-center\">\n              <div\n                className={`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors ${\n                  isCompleted\n                    ? \"bg-primary border-primary text-primary-foreground\"\n                    : isCurrent\n                    ? \"bg-primary/10 border-primary text-primary\"\n                    : \"bg-background border-border text-muted-foreground\"\n                }`}\n                data-testid={`step-${step.toLowerCase()}`}\n              >\n                {isCompleted ? (\n                  <CheckCircle className=\"w-5 h-5\" />\n                ) : isCurrent ? (\n                  <Clock className=\"w-5 h-5\" />\n                ) : (\n                  <Circle className=\"w-5 h-5\" />\n                )}\n              </div>\n              <span\n                className={`mt-2 text-xs font-medium ${\n                  isCurrent ? \"text-foreground\" : \"text-muted-foreground\"\n                }`}\n              >\n                {step}\n              </span>\n            </div>\n            {!isLast && (\n              <div\n                className={`flex-1 h-0.5 mx-2 mb-8 transition-colors ${\n                  isCompleted ? \"bg-primary\" : \"bg-border\"\n                }`}\n              />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","path":null,"size_bytes":2203,"size_tokens":null},"client/src/components/NotificationPopup.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { X, Bell, CheckCircle, AlertCircle, Info } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport type NotificationType = \"success\" | \"error\" | \"info\" | \"warning\";\n\ninterface Notification {\n  id: string;\n  type: NotificationType;\n  title: string;\n  message: string;\n}\n\ninterface NotificationPopupProps {\n  notification: Notification;\n  onDismiss: (id: string) => void;\n  autoDismiss?: boolean;\n  duration?: number;\n}\n\nexport default function NotificationPopup({\n  notification,\n  onDismiss,\n  autoDismiss = true,\n  duration = 5000,\n}: NotificationPopupProps) {\n  const [isVisible, setIsVisible] = useState(true);\n\n  useEffect(() => {\n    if (autoDismiss) {\n      const timer = setTimeout(() => {\n        setIsVisible(false);\n        setTimeout(() => onDismiss(notification.id), 300);\n      }, duration);\n      return () => clearTimeout(timer);\n    }\n  }, [autoDismiss, duration, notification.id, onDismiss]);\n\n  const getIcon = () => {\n    switch (notification.type) {\n      case \"success\":\n        return <CheckCircle className=\"w-5 h-5 text-green-600\" />;\n      case \"error\":\n        return <AlertCircle className=\"w-5 h-5 text-red-600\" />;\n      case \"warning\":\n        return <AlertCircle className=\"w-5 h-5 text-amber-600\" />;\n      case \"info\":\n        return <Info className=\"w-5 h-5 text-blue-600\" />;\n    }\n  };\n\n  const getBgColor = () => {\n    switch (notification.type) {\n      case \"success\":\n        return \"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-900\";\n      case \"error\":\n        return \"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-900\";\n      case \"warning\":\n        return \"bg-amber-50 dark:bg-amber-950/20 border-amber-200 dark:border-amber-900\";\n      case \"info\":\n        return \"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-900\";\n    }\n  };\n\n  return (\n    <div\n      className={`fixed top-4 right-4 z-50 transition-all duration-300 ${\n        isVisible ? \"translate-x-0 opacity-100\" : \"translate-x-full opacity-0\"\n      }`}\n      data-testid={`notification-${notification.type}`}\n    >\n      <div\n        className={`p-4 rounded-lg border shadow-lg max-w-md ${getBgColor()}`}\n      >\n        <div className=\"flex items-start gap-3\">\n          {getIcon()}\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"text-sm font-semibold text-foreground\">{notification.title}</h4>\n            <p className=\"text-sm text-muted-foreground mt-1\">{notification.message}</p>\n          </div>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            className=\"h-6 w-6\"\n            onClick={() => {\n              setIsVisible(false);\n              setTimeout(() => onDismiss(notification.id), 300);\n            }}\n            data-testid=\"button-dismiss-notification\"\n          >\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2974,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/pages/CreateDocumentPage.tsx":{"content":"import DashboardLayout from \"@/components/DashboardLayout\";\nimport DocumentUploadForm from \"@/components/DocumentUploadForm\";\nimport WorkflowProgress from \"@/components/WorkflowProgress\";\nimport { Card } from \"@/components/ui/card\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface CreateDocumentPageProps {\n  onBack?: () => void;\n  onSubmit?: (data: any) => void;\n  onLogout?: () => void;\n  userName?: string;\n}\n\nexport default function CreateDocumentPage({ onBack, onSubmit, onLogout, userName = \"User\" }: CreateDocumentPageProps) {\n  return (\n    <DashboardLayout\n      userRole=\"Document Creator\"\n      userName={userName}\n      notificationCount={0}\n      onLogout={onLogout}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={onBack} data-testid=\"button-back\">\n            <ArrowLeft className=\"w-5 h-5\" />\n          </Button>\n          <div>\n            <h2 className=\"text-3xl font-semibold text-foreground\">Create New Document</h2>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Fill in document details and upload Word file\n            </p>\n          </div>\n        </div>\n\n        <Card className=\"p-6\">\n          <WorkflowProgress currentStep=\"Creator\" />\n        </Card>\n\n        <DocumentUploadForm onSubmit={onSubmit} />\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":1456,"size_tokens":null},"client/src/App.tsx":{"content":"import { useState } from \"react\";\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport LoginPage from \"@/pages/LoginPage\";\nimport CreatorDashboardWithAPI from \"@/pages/CreatorDashboardWithAPI\";\nimport ApproverDashboard from \"@/pages/ApproverDashboard\";\nimport IssuerDashboard from \"@/pages/IssuerDashboard\";\nimport RecipientDashboard from \"@/pages/RecipientDashboard\";\nimport CreateDocumentPage from \"@/pages/CreateDocumentPage\";\nimport AdminDashboard from \"@/pages/AdminDashboard\";\nimport NotificationPopup from \"@/components/NotificationPopup\";\nimport { Document } from \"@/components/DocumentTable\";\n\ntype UserRole = \"Creator\" | \"Approver\" | \"Issuer\" | \"Recipient\" | \"Admin\";\n\ninterface Activity {\n  id: string;\n  type: \"created\" | \"approved\" | \"declined\" | \"issued\" | \"pending\";\n  docName: string;\n  userName: string;\n  timestamp: string;\n  remarks?: string;\n}\n\nfunction Router() {\n  const [, setLocation] = useLocation();\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [userRole, setUserRole] = useState<UserRole | null>(null);\n  const [userName, setUserName] = useState<string>(\"\");\n  const [userId, setUserId] = useState<string>(\"\");\n  const [notifications, setNotifications] = useState<any[]>([]);\n  const [documents, setDocuments] = useState<Document[]>([]);\n  const [activities, setActivities] = useState<Activity[]>([]);\n\n  const handleLogin = async (data: { username: string; password: string }) => {\n    try {\n      const response = await fetch(\"/api/login\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        addNotification({\n          type: \"error\",\n          title: \"Login Failed\",\n          message: error.message || \"Invalid credentials. Please try again.\",\n        });\n        return;\n      }\n\n      const user = await response.json();\n      \n      const roleMap: Record<string, UserRole> = {\n        \"creator\": \"Creator\",\n        \"approver\": \"Approver\",\n        \"issuer\": \"Issuer\",\n        \"recipient\": \"Recipient\",\n        \"admin\": \"Admin\"\n      };\n      \n      const role = roleMap[user.role] || \"Recipient\";\n      \n      setUserRole(role);\n      setUserName(user.username);\n      setUserId(user.id);\n      setIsAuthenticated(true);\n\n      // Navigate to appropriate dashboard\n      switch (role) {\n        case \"Creator\":\n          setLocation(\"/creator\");\n          break;\n        case \"Approver\":\n          setLocation(\"/approver\");\n          break;\n        case \"Issuer\":\n          setLocation(\"/issuer\");\n          break;\n        case \"Recipient\":\n          setLocation(\"/recipient\");\n          break;\n        case \"Admin\":\n          setLocation(\"/admin\");\n          break;\n      }\n\n      // Show welcome notification\n      addNotification({\n        type: \"success\",\n        title: \"Login Successful\",\n        message: `Welcome back, ${user.fullName}!`,\n      });\n    } catch (error: any) {\n      addNotification({\n        type: \"error\",\n        title: \"Login Error\",\n        message: error.message || \"An error occurred during login.\",\n      });\n    }\n  };\n\n  const handleLogout = () => {\n    setIsAuthenticated(false);\n    setUserRole(null);\n    setUserName(\"\");\n    setUserId(\"\");\n    setDocuments([]);\n    setActivities([]);\n    setLocation(\"/\");\n    addNotification({\n      type: \"info\",\n      title: \"Logged Out\",\n      message: \"You have been successfully logged out.\",\n    });\n  };\n\n  const addNotification = (notif: {\n    type: \"success\" | \"error\" | \"info\" | \"warning\";\n    title: string;\n    message: string;\n  }) => {\n    const newNotif = {\n      id: Date.now().toString(),\n      ...notif,\n    };\n    setNotifications((prev) => [...prev, newNotif]);\n  };\n\n  const handleCreateDocument = () => {\n    setLocation(\"/creator/create\");\n  };\n\n  const handleDocumentSubmit = async (data: any) => {\n    console.log(\"Document submitted:\", data);\n    \n    try {\n      if (!data.file) {\n        addNotification({\n          type: \"error\",\n          title: \"Error\",\n          message: \"Word document file is required.\",\n        });\n        return;\n      }\n\n      const formData = new FormData();\n      formData.append('file', data.file);\n      formData.append('docName', data.docName);\n      formData.append('docNumber', data.docNumber);\n      formData.append('dateOfIssue', data.dateOfIssue ? new Date(data.dateOfIssue).toISOString() : new Date().toISOString());\n      formData.append('revisionNo', (parseInt(data.revisionNumber) || 0).toString());\n      formData.append('preparedBy', userId);\n      formData.append('status', 'pending');\n      if (data.preparerName) formData.append('preparerName', data.preparerName);\n      if (data.reasonForRevision) formData.append('reasonForRevision', data.reasonForRevision);\n      if (data.duePeriodYears) formData.append('duePeriodYears', data.duePeriodYears);\n\n      const response = await fetch('/api/documents', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Failed to create document');\n      }\n\n      const createdDocument = await response.json();\n\n      addNotification({\n        type: \"success\",\n        title: \"Document Submitted\",\n        message: `${data.docName} has been submitted for approval. Header and footer extracted automatically.`,\n      });\n\n      setLocation(\"/creator\");\n    } catch (error: any) {\n      console.error(\"Error submitting document:\", error);\n      addNotification({\n        type: \"error\",\n        title: \"Error\",\n        message: error.message || \"Failed to submit document. Please try again.\",\n      });\n    }\n  };\n\n  const handleViewDocument = (doc: Document) => {\n    console.log(\"Viewing document:\", doc);\n    addNotification({\n      type: \"info\",\n      title: \"Document Opened\",\n      message: `Viewing ${doc.docName}`,\n    });\n  };\n\n  const handleEditDocument = (docId: string, data: any) => {\n    console.log(\"Editing document:\", docId, data);\n    \n    setDocuments((prev) =>\n      prev.map((doc) =>\n        doc.id === docId\n          ? {\n              ...doc,\n              docName: data.docName,\n              docNumber: data.docNumber,\n              dateOfIssue: data.dateOfIssue,\n              revisionNo: parseInt(data.revisionNumber) || 0,\n              preparedBy: data.preparerName,\n            }\n          : doc\n      )\n    );\n\n    // Add activity\n    const document = documents.find(d => d.id === docId);\n    if (document) {\n      const newActivity: Activity = {\n        id: Date.now().toString(),\n        type: \"created\",\n        docName: data.docName,\n        userName: \"You\",\n        timestamp: \"Just now\",\n      };\n      setActivities((prev) => [newActivity, ...prev]);\n    }\n\n    addNotification({\n      type: \"success\",\n      title: \"Document Updated\",\n      message: `${data.docName} has been updated successfully.`,\n    });\n  };\n\n  const handleDeleteDocument = (docId: string) => {\n    const document = documents.find(d => d.id === docId);\n    \n    setDocuments((prev) => prev.filter((doc) => doc.id !== docId));\n\n    if (document) {\n      addNotification({\n        type: \"info\",\n        title: \"Document Deleted\",\n        message: `${document.docName} has been deleted.`,\n      });\n    }\n  };\n\n  const handleDownloadDocument = (doc: Document) => {\n    console.log(\"Downloading document:\", doc);\n    addNotification({\n      type: \"success\",\n      title: \"Download Started\",\n      message: `Downloading ${doc.docName}...`,\n    });\n  };\n\n  return (\n    <>\n      <Switch>\n        <Route path=\"/\" component={() => <LoginPage onLogin={handleLogin} />} />\n        <Route\n          path=\"/creator\"\n          component={() => (\n            <CreatorDashboardWithAPI\n              onCreateDocument={handleCreateDocument}\n              onLogout={handleLogout}\n              userId={userId}\n              userName={userName}\n            />\n          )}\n        />\n        <Route\n          path=\"/creator/create\"\n          component={() => (\n            <CreateDocumentPage\n              onBack={() => setLocation(\"/creator\")}\n              onSubmit={handleDocumentSubmit}\n              onLogout={handleLogout}\n              userName={userName}\n            />\n          )}\n        />\n        <Route path=\"/approver\" component={() => <ApproverDashboard onLogout={handleLogout} userId={userId} />} />\n        <Route path=\"/issuer\" component={() => <IssuerDashboard onLogout={handleLogout} userId={userId} />} />\n        <Route path=\"/recipient\" component={() => <RecipientDashboard onLogout={handleLogout} userId={userId} />} />\n        <Route path=\"/admin\" component={() => <AdminDashboard onLogout={handleLogout} userId={userId} />} />\n        <Route component={NotFound} />\n      </Switch>\n\n      {notifications.map((notif) => (\n        <NotificationPopup\n          key={notif.id}\n          notification={notif}\n          onDismiss={(id) => setNotifications((prev) => prev.filter((n) => n.id !== id))}\n        />\n      ))}\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":9581,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/examples/ApprovalDialog.tsx":{"content":"import { useState } from \"react\";\nimport ApprovalDialog from \"../ApprovalDialog\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function ApprovalDialogExample() {\n  const [approveOpen, setApproveOpen] = useState(false);\n  const [declineOpen, setDeclineOpen] = useState(false);\n\n  return (\n    <div className=\"p-6 space-x-4\">\n      <Button onClick={() => setApproveOpen(true)}>Open Approve Dialog</Button>\n      <Button variant=\"destructive\" onClick={() => setDeclineOpen(true)}>\n        Open Decline Dialog\n      </Button>\n\n      <ApprovalDialog\n        open={approveOpen}\n        onClose={() => setApproveOpen(false)}\n        onApprove={(data) => console.log(\"Approved with:\", data)}\n        type=\"approve\"\n        title=\"Approve Document\"\n      />\n\n      <ApprovalDialog\n        open={declineOpen}\n        onClose={() => setDeclineOpen(false)}\n        onDecline={(remarks) => console.log(\"Declined with:\", remarks)}\n        type=\"decline\"\n        title=\"Decline Document\"\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":1020,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/pages/CreatorDashboard.tsx":{"content":"import { useState } from \"react\";\nimport DashboardLayout from \"@/components/DashboardLayout\";\nimport StatCard from \"@/components/StatCard\";\nimport DocumentTable, { Document } from \"@/components/DocumentTable\";\nimport ActivityFeed from \"@/components/ActivityFeed\";\nimport DocumentViewDialog from \"@/components/DocumentViewDialog\";\nimport DocumentEditDialog from \"@/components/DocumentEditDialog\";\nimport DeleteConfirmDialog from \"@/components/DeleteConfirmDialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { FileText, Clock, CheckCircle, XCircle, Plus } from \"lucide-react\";\n\ninterface Activity {\n  id: string;\n  type: \"created\" | \"approved\" | \"declined\" | \"issued\" | \"pending\";\n  docName: string;\n  userName: string;\n  timestamp: string;\n  remarks?: string;\n}\n\ninterface CreatorDashboardProps {\n  onCreateDocument?: () => void;\n  onLogout?: () => void;\n  documents?: Document[];\n  activities?: Activity[];\n  userName?: string;\n  onViewDocument?: (doc: Document) => void;\n  onEditDocument?: (docId: string, data: any) => void;\n  onDeleteDocument?: (docId: string) => void;\n  onDownloadDocument?: (doc: Document) => void;\n}\n\nexport default function CreatorDashboard({ \n  onCreateDocument, \n  onLogout,\n  documents = [],\n  activities = [],\n  userName = \"User\",\n  onViewDocument,\n  onEditDocument,\n  onDeleteDocument,\n  onDownloadDocument,\n}: CreatorDashboardProps) {\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedDocument, setSelectedDocument] = useState<Document | null>(null);\n\n  const pendingDocs = documents.filter(doc => doc.status === \"Pending\");\n  const approvedDocs = documents.filter(doc => doc.status === \"Approved\");\n  const declinedDocs = documents.filter(doc => doc.status === \"Declined\");\n  const issuedDocs = documents.filter(doc => doc.status === \"Issued\");\n\n  const handleView = (doc: Document) => {\n    setSelectedDocument(doc);\n    setViewDialogOpen(true);\n    onViewDocument?.(doc);\n  };\n\n  const handleEdit = (doc: Document) => {\n    setSelectedDocument(doc);\n    setEditDialogOpen(true);\n  };\n\n  const handleDelete = (doc: Document) => {\n    setSelectedDocument(doc);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = () => {\n    if (selectedDocument) {\n      onDeleteDocument?.(selectedDocument.id);\n      setDeleteDialogOpen(false);\n      setSelectedDocument(null);\n    }\n  };\n\n  const handleSaveEdit = (docId: string, data: any) => {\n    onEditDocument?.(docId, data);\n    setEditDialogOpen(false);\n    setSelectedDocument(null);\n  };\n\n  return (\n    <DashboardLayout\n      userRole=\"Document Creator\"\n      userName={userName}\n      notificationCount={pendingDocs.length}\n      onLogout={onLogout}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-semibold text-foreground\">My Documents</h2>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Create and manage your documents\n            </p>\n          </div>\n          <Button onClick={onCreateDocument} data-testid=\"button-create-document\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Create Document\n          </Button>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <StatCard\n            title=\"Total Documents\"\n            value={documents.length}\n            icon={FileText}\n            trend=\"Created by you\"\n          />\n          <StatCard title=\"Pending Review\" value={pendingDocs.length} icon={Clock} trend=\"Awaiting approval\" />\n          <StatCard title=\"Approved\" value={approvedDocs.length} icon={CheckCircle} trend=\"Ready for issue\" />\n          <StatCard title=\"Declined\" value={declinedDocs.length} icon={XCircle} trend=\"Requires revision\" />\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-2\">\n            <Tabs defaultValue=\"pending\" className=\"space-y-4\">\n              <TabsList>\n                <TabsTrigger value=\"pending\" data-testid=\"tab-pending\">\n                  Pending ({pendingDocs.length})\n                </TabsTrigger>\n                <TabsTrigger value=\"approved\" data-testid=\"tab-approved\">\n                  Approved ({approvedDocs.length})\n                </TabsTrigger>\n                <TabsTrigger value=\"declined\" data-testid=\"tab-declined\">\n                  Declined ({declinedDocs.length})\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"pending\">\n                {pendingDocs.length > 0 ? (\n                  <DocumentTable\n                    documents={pendingDocs}\n                    onView={handleView}\n                    onEdit={handleEdit}\n                    onDelete={handleDelete}\n                    onDownload={onDownloadDocument}\n                    canEdit={true}\n                    canDelete={true}\n                  />\n                ) : (\n                  <div className=\"border rounded-lg p-12 text-center\">\n                    <FileText className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <p className=\"text-sm text-muted-foreground\">No pending documents</p>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"approved\">\n                {approvedDocs.length > 0 ? (\n                  <DocumentTable\n                    documents={approvedDocs}\n                    onView={handleView}\n                    onDownload={onDownloadDocument}\n                  />\n                ) : (\n                  <div className=\"border rounded-lg p-12 text-center\">\n                    <CheckCircle className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <p className=\"text-sm text-muted-foreground\">No approved documents</p>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"declined\">\n                {declinedDocs.length > 0 ? (\n                  <DocumentTable\n                    documents={declinedDocs}\n                    onView={handleView}\n                    onEdit={handleEdit}\n                    onDelete={handleDelete}\n                    onDownload={onDownloadDocument}\n                    canEdit={true}\n                    canDelete={true}\n                  />\n                ) : (\n                  <div className=\"border rounded-lg p-12 text-center\">\n                    <XCircle className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <p className=\"text-sm text-muted-foreground\">No declined documents</p>\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </div>\n\n          <div>\n            <ActivityFeed activities={activities} maxItems={5} />\n          </div>\n        </div>\n      </div>\n\n      <DocumentViewDialog\n        document={selectedDocument}\n        open={viewDialogOpen}\n        onClose={() => setViewDialogOpen(false)}\n        onDownload={onDownloadDocument}\n      />\n\n      <DocumentEditDialog\n        document={selectedDocument}\n        open={editDialogOpen}\n        onClose={() => setEditDialogOpen(false)}\n        onSave={handleSaveEdit}\n      />\n\n      <DeleteConfirmDialog\n        open={deleteDialogOpen}\n        onClose={() => setDeleteDialogOpen(false)}\n        onConfirm={confirmDelete}\n        title=\"Delete Document\"\n        description={`Are you sure you want to delete \"${selectedDocument?.docName}\"? This action cannot be undone.`}\n      />\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":7781,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/pages/IssuerDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/DashboardLayout\";\nimport StatCard from \"@/components/StatCard\";\nimport DocumentTable, { Document } from \"@/components/DocumentTable\";\nimport WorkflowProgress from \"@/components/WorkflowProgress\";\nimport ApprovalDialog from \"@/components/ApprovalDialog\";\nimport DocumentViewDialog from \"@/components/DocumentViewDialog\";\nimport PDFViewer from \"@/components/PDFViewer\";\nimport { WordDocumentViewer } from \"@/components/WordDocumentViewer\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { FileText, Send, Clock, Archive } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface IssuerDashboardProps {\n  onLogout?: () => void;\n  userId?: string;\n}\n\ninterface ApiDocument {\n  id: string;\n  docName: string;\n  docNumber: string;\n  status: string;\n  dateOfIssue: string;\n  revisionNo: number;\n  preparedBy: string;\n  preparerName?: string;\n  approverName?: string;\n  issuerName?: string;\n  departments?: Array<{ id: string; name: string }>;\n  content?: string;\n  headerInfo?: string;\n  footerInfo?: string;\n  approvalRemarks?: string;\n  declineRemarks?: string;\n  previousVersionId?: string;\n  previousVersion?: ApiDocument;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\ninterface Notification {\n  id: string;\n  message: string;\n  type: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\nexport default function IssuerDashboard({ onLogout, userId = \"issuer-1\" }: IssuerDashboardProps) {\n  const [issueDialogOpen, setIssueDialogOpen] = useState(false);\n  const [declineDialogOpen, setDeclineDialogOpen] = useState(false);\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [pdfViewerOpen, setPdfViewerOpen] = useState(false);\n  const [pdfDocId, setPdfDocId] = useState<string>(\"\");\n  const [pdfDocName, setPdfDocName] = useState<string>(\"\");\n  const [wordViewerOpen, setWordViewerOpen] = useState(false);\n  const [wordViewDocId, setWordViewDocId] = useState<string>(\"\");\n  const [selectedDoc, setSelectedDoc] = useState<ApiDocument | null>(null);\n  const [viewDoc, setViewDoc] = useState<Document | null>(null);\n  const { toast} = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: approvedDocuments = [], isLoading } = useQuery<ApiDocument[]>({\n    queryKey: [\"/api/documents\", \"approved\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/documents?status=approved\");\n      if (!response.ok) throw new Error(\"Failed to fetch approved documents\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const { data: issuedDocuments = [] } = useQuery<ApiDocument[]>({\n    queryKey: [\"/api/documents\", \"issued\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/documents?status=issued\");\n      if (!response.ok) throw new Error(\"Failed to fetch issued documents\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\", userId],\n    queryFn: async () => {\n      const response = await fetch(`/api/notifications/${userId}`);\n      if (!response.ok) throw new Error(\"Failed to fetch notifications\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const issueMutation = useMutation({\n    mutationFn: async ({ docId, issuerName, remarks }: { docId: string; issuerName: string; remarks: string }) => {\n      return apiRequest(\"POST\", `/api/documents/${docId}/issue`, { issuedBy: userId, issuerName, remarks });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Document Issued\",\n        description: \"The document has been successfully issued to all recipients.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to issue document. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const declineMutation = useMutation({\n    mutationFn: async ({ docId, remarks }: { docId: string; remarks: string }) => {\n      return apiRequest(\"POST\", `/api/documents/${docId}/decline`, { declineRemarks: remarks });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Document Declined\",\n        description: \"The document has been sent back to the creator for revision.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to decline document. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleIssue = (doc: Document) => {\n    const fullDoc = approvedDocuments.find((d) => d.id === doc.id);\n    if (fullDoc) {\n      setSelectedDoc(fullDoc);\n      setIssueDialogOpen(true);\n    }\n  };\n\n  const handleDecline = (doc: Document) => {\n    const fullDoc = approvedDocuments.find((d) => d.id === doc.id);\n    if (fullDoc) {\n      setSelectedDoc(fullDoc);\n      setDeclineDialogOpen(true);\n    }\n  };\n\n  const handleView = (doc: Document) => {\n    setViewDoc(doc);\n    setViewDialogOpen(true);\n  };\n\n  const handleIssueConfirm = (data: { remarks: string; approverName: string }) => {\n    if (selectedDoc) {\n      issueMutation.mutate({\n        docId: selectedDoc.id,\n        issuerName: data.approverName,\n        remarks: data.remarks,\n      });\n      setIssueDialogOpen(false);\n      setSelectedDoc(null);\n    }\n  };\n\n  const handleDeclineConfirm = (remarks: string) => {\n    if (selectedDoc) {\n      declineMutation.mutate({\n        docId: selectedDoc.id,\n        remarks,\n      });\n      setDeclineDialogOpen(false);\n      setSelectedDoc(null);\n    }\n  };\n\n  const handleViewWord = (doc: Document) => {\n    setWordViewDocId(doc.id);\n    setWordViewerOpen(true);\n  };\n\n  const handleDownload = async (doc: Document) => {\n    try {\n      const response = await fetch(`/api/documents/${doc.id}/download`);\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to download document');\n      }\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.style.display = 'none';\n      a.href = url;\n      a.download = `${doc.docNumber}_${doc.docName}.docx`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      toast({\n        title: \"Download Successful\",\n        description: `${doc.docName} has been downloaded.`,\n      });\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Download Failed\",\n        description: error.message || \"Failed to download Word document. Please try again.\",\n      });\n    }\n  };\n\n  const handleViewPDF = (doc: Document) => {\n    setPdfDocId(doc.id);\n    setPdfDocName(doc.docName);\n    setPdfViewerOpen(true);\n  };\n\n  const transformedApprovedDocs = (docs: ApiDocument[]): Document[] => {\n    return docs.map((doc) => ({\n      id: doc.id,\n      docName: doc.docName,\n      docNumber: doc.docNumber,\n      status: \"Approved\" as const,\n      dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split(\"T\")[0] : \"\",\n      revisionNo: doc.revisionNo,\n      preparedBy: doc.preparerName || \"Unknown\",\n    }));\n  };\n\n  const transformedIssuedDocs = (docs: ApiDocument[]): Document[] => {\n    return docs.map((doc) => ({\n      id: doc.id,\n      docName: doc.docName,\n      docNumber: doc.docNumber,\n      status: \"Issued\" as const,\n      dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split(\"T\")[0] : \"\",\n      revisionNo: doc.revisionNo,\n      preparedBy: doc.preparerName || \"Unknown\",\n    }));\n  };\n\n  const unreadNotifications = notifications.filter((n) => !n.isRead).length;\n  const issuedToday = issuedDocuments.filter((doc) => {\n    const issuedDate = doc.dateOfIssue ? new Date(doc.dateOfIssue).toDateString() : \"\";\n    return issuedDate === new Date().toDateString();\n  }).length;\n\n  return (\n    <DashboardLayout\n      userRole=\"Document Issuer (MR)\"\n      userName=\"Issuer User\"\n      userId={userId}\n      notificationCount={unreadNotifications}\n      onLogout={onLogout}\n    >\n      <div className=\"space-y-6\">\n        <div>\n          <h2 className=\"text-3xl font-semibold text-foreground\">Document Issuance</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Final review and issue approved documents\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n          <StatCard\n            title=\"Pending Issue\"\n            value={approvedDocuments.length}\n            icon={Clock}\n            trend=\"Approved documents\"\n          />\n          <StatCard title=\"Issued Today\" value={issuedToday} icon={Send} trend=\"Ready to distribute\" />\n          <StatCard\n            title=\"Total Issued\"\n            value={issuedDocuments.length}\n            icon={FileText}\n            trend=\"All time issued\"\n          />\n          <StatCard\n            title=\"Master Copies\"\n            value={issuedDocuments.length}\n            icon={Archive}\n            trend=\"With version history\"\n          />\n        </div>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-lg font-semibold\">Approved - Ready to Issue</h3>\n            <Button variant=\"outline\" size=\"sm\" data-testid=\"button-export\">\n              Export Log\n            </Button>\n          </div>\n\n          {isLoading ? (\n            <div className=\"border rounded-lg p-12 text-center\">\n              <p className=\"text-sm text-muted-foreground\">Loading documents...</p>\n            </div>\n          ) : approvedDocuments.length > 0 ? (\n            <DocumentTable\n              documents={transformedApprovedDocs(approvedDocuments)}\n              onView={handleView}\n              onViewWord={handleViewWord}\n              onDownload={handleDownload}\n              onApprove={handleIssue}\n              onDecline={handleDecline}\n              showActions={true}\n            />\n          ) : (\n            <div className=\"border rounded-lg p-12 text-center\">\n              <FileText className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-sm text-muted-foreground\">No documents ready to issue</p>\n            </div>\n          )}\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Recently Issued Documents</h3>\n          {issuedDocuments.length > 0 ? (\n            <DocumentTable\n              documents={transformedIssuedDocs(issuedDocuments.slice(0, 5))}\n              onView={handleViewPDF}\n              showActions={true}\n            />\n          ) : (\n            <div className=\"border rounded-lg p-12 text-center\">\n              <Send className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-sm text-muted-foreground\">No issued documents yet</p>\n            </div>\n          )}\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Document Workflow</h3>\n          <WorkflowProgress currentStep=\"Issuer\" />\n          <div className=\"mt-6 p-4 bg-muted/30 rounded-lg\">\n            <p className=\"text-sm text-muted-foreground\">\n              <strong>Your Role:</strong> Perform final review, issue documents with controlled PDF\n              conversion, assign control copy numbers, and manage version history access.\n            </p>\n          </div>\n        </Card>\n      </div>\n\n      <ApprovalDialog\n        open={issueDialogOpen}\n        onClose={() => setIssueDialogOpen(false)}\n        onApprove={handleIssueConfirm}\n        type=\"approve\"\n        title={`Issue Document: ${selectedDoc?.docName}`}\n      />\n\n      <ApprovalDialog\n        open={declineDialogOpen}\n        onClose={() => setDeclineDialogOpen(false)}\n        onDecline={handleDeclineConfirm}\n        type=\"decline\"\n        title={`Decline for Revision: ${selectedDoc?.docName}`}\n      />\n\n      <DocumentViewDialog\n        document={viewDoc}\n        open={viewDialogOpen}\n        onClose={() => setViewDialogOpen(false)}\n        onDownload={viewDoc ? () => handleViewWord(viewDoc as any) : () => {}}\n      />\n\n      <PDFViewer\n        documentId={pdfDocId}\n        userId={userId}\n        open={pdfViewerOpen}\n        onClose={() => setPdfViewerOpen(false)}\n        documentName={pdfDocName}\n      />\n\n      <WordDocumentViewer\n        documentId={wordViewDocId}\n        open={wordViewerOpen}\n        onOpenChange={setWordViewerOpen}\n      />\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":13044,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/DocumentTable.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Eye, FileText, Download, MoreVertical, Edit, Trash2 } from \"lucide-react\";\nimport StatusBadge, { DocumentStatus } from \"./StatusBadge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\nexport interface Document {\n  id: string;\n  docName: string;\n  docNumber: string;\n  status: DocumentStatus;\n  dateOfIssue: string;\n  revisionNo: number;\n  preparedBy: string;\n}\n\ninterface DocumentTableProps {\n  documents: Document[];\n  onView?: (doc: Document) => void;\n  onViewWord?: (doc: Document) => void;\n  onDownload?: (doc: Document) => void;\n  onEdit?: (doc: Document) => void;\n  onDelete?: (doc: Document) => void;\n  onApprove?: (doc: Document) => void;\n  onDecline?: (doc: Document) => void;\n  showActions?: boolean;\n  canEdit?: boolean;\n  canDelete?: boolean;\n}\n\nexport default function DocumentTable({\n  documents,\n  onView,\n  onViewWord,\n  onDownload,\n  onEdit,\n  onDelete,\n  onApprove,\n  onDecline,\n  showActions = true,\n  canEdit = false,\n  canDelete = false,\n}: DocumentTableProps) {\n  return (\n    <div className=\"border rounded-lg overflow-hidden\" data-testid=\"table-documents\">\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead className=\"bg-muted/50 border-b\">\n            <tr>\n              <th className=\"px-6 py-3 text-left text-sm font-medium text-foreground\">Document Name</th>\n              <th className=\"px-6 py-3 text-left text-sm font-medium text-foreground\">Doc Number</th>\n              <th className=\"px-6 py-3 text-left text-sm font-medium text-foreground\">Status</th>\n              <th className=\"px-6 py-3 text-left text-sm font-medium text-foreground\">Revision</th>\n              <th className=\"px-6 py-3 text-left text-sm font-medium text-foreground\">Date</th>\n              <th className=\"px-6 py-3 text-left text-sm font-medium text-foreground\">Prepared By</th>\n              {showActions && (\n                <th className=\"px-6 py-3 text-right text-sm font-medium text-foreground\">Actions</th>\n              )}\n            </tr>\n          </thead>\n          <tbody className=\"divide-y\">\n            {documents.map((doc) => (\n              <tr\n                key={doc.id}\n                className=\"hover-elevate active-elevate-2\"\n                data-testid={`row-document-${doc.id}`}\n              >\n                <td className=\"px-6 py-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"text-sm font-medium text-foreground\">{doc.docName}</span>\n                  </div>\n                </td>\n                <td className=\"px-6 py-4\">\n                  <span className=\"text-sm font-mono text-muted-foreground\">{doc.docNumber}</span>\n                </td>\n                <td className=\"px-6 py-4\">\n                  <StatusBadge status={doc.status} />\n                </td>\n                <td className=\"px-6 py-4\">\n                  <span className=\"text-sm text-foreground\">Rev {doc.revisionNo}</span>\n                </td>\n                <td className=\"px-6 py-4\">\n                  <span className=\"text-sm text-muted-foreground\">{doc.dateOfIssue}</span>\n                </td>\n                <td className=\"px-6 py-4\">\n                  <span className=\"text-sm text-muted-foreground\">{doc.preparedBy}</span>\n                </td>\n                {showActions && (\n                  <td className=\"px-6 py-4\">\n                    <div className=\"flex items-center justify-end gap-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => onView?.(doc)}\n                        data-testid={`button-view-${doc.id}`}\n                      >\n                        <Eye className=\"w-4 h-4\" />\n                      </Button>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button size=\"icon\" variant=\"ghost\" data-testid={`button-menu-${doc.id}`}>\n                            <MoreVertical className=\"w-4 h-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          {onViewWord && (\n                            <DropdownMenuItem onClick={() => onViewWord(doc)} data-testid={`menu-view-word-${doc.id}`}>\n                              <FileText className=\"w-4 h-4 mr-2\" />\n                              View Word\n                            </DropdownMenuItem>\n                          )}\n                          {onDownload && (\n                            <DropdownMenuItem onClick={() => onDownload(doc)} data-testid={`menu-download-word-${doc.id}`}>\n                              <Download className=\"w-4 h-4 mr-2\" />\n                              Download as Word\n                            </DropdownMenuItem>\n                          )}\n                          {canEdit && onEdit && (\n                            <DropdownMenuItem onClick={() => onEdit(doc)}>\n                              <Edit className=\"w-4 h-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                          )}\n                          {canDelete && onDelete && (\n                            <>\n                              <DropdownMenuSeparator />\n                              <DropdownMenuItem\n                                onClick={() => onDelete(doc)}\n                                className=\"text-destructive focus:text-destructive\"\n                              >\n                                <Trash2 className=\"w-4 h-4 mr-2\" />\n                                Delete\n                              </DropdownMenuItem>\n                            </>\n                          )}\n                          {onApprove && (doc.status === \"Pending\" || doc.status === \"Approved\") && (\n                            <DropdownMenuItem onClick={() => onApprove(doc)} data-testid={`menu-approve-${doc.id}`}>\n                              {doc.status === \"Approved\" ? \"Issue\" : \"Approve\"}\n                            </DropdownMenuItem>\n                          )}\n                          {onDecline && (doc.status === \"Pending\" || doc.status === \"Approved\") && (\n                            <DropdownMenuItem onClick={() => onDecline(doc)} data-testid={`menu-decline-${doc.id}`}>\n                              Decline\n                            </DropdownMenuItem>\n                          )}\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </div>\n                  </td>\n                )}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6976,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/examples/StatusBadge.tsx":{"content":"import StatusBadge from \"../StatusBadge\";\n\nexport default function StatusBadgeExample() {\n  return (\n    <div className=\"flex flex-wrap gap-4 p-6\">\n      <StatusBadge status=\"Pending\" />\n      <StatusBadge status=\"Approved\" />\n      <StatusBadge status=\"Declined\" />\n      <StatusBadge status=\"Issued\" />\n      <StatusBadge status=\"Revised\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":362,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/DashboardLayout.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { User, LogOut, Sun, Moon } from \"lucide-react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport NotificationPanel from \"@/components/NotificationPanel\";\n\ninterface DashboardLayoutProps {\n  children: React.ReactNode;\n  userRole: string;\n  userName: string;\n  userId?: string;\n  notificationCount?: number;\n  onLogout?: () => void;\n}\n\nexport default function DashboardLayout({\n  children,\n  userRole,\n  userName,\n  userId = \"\",\n  notificationCount = 0,\n  onLogout,\n}: DashboardLayoutProps) {\n  const [isDark, setIsDark] = useState(false);\n\n  const toggleTheme = () => {\n    setIsDark(!isDark);\n    document.documentElement.classList.toggle(\"dark\");\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-40 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"flex h-16 items-center justify-between px-6\">\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"text-xl font-bold text-foreground\">DMS</h1>\n            <div className=\"hidden md:flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">|</span>\n              <span className=\"text-sm font-medium text-muted-foreground\">{userRole}</span>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={toggleTheme}\n              data-testid=\"button-theme-toggle\"\n            >\n              {isDark ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}\n            </Button>\n\n            {userId && <NotificationPanel userId={userId} />}\n\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" data-testid=\"button-user-menu\">\n                  <User className=\"w-5 h-5\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <div className=\"px-2 py-1.5\">\n                  <p className=\"text-sm font-medium\">{userName}</p>\n                  <p className=\"text-xs text-muted-foreground\">{userRole}</p>\n                </div>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem onClick={onLogout} data-testid=\"button-logout\">\n                  <LogOut className=\"w-4 h-4 mr-2\" />\n                  Logout\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto py-6 px-4 md:px-6\">{children}</main>\n    </div>\n  );\n}\n","path":null,"size_bytes":2878,"size_tokens":null},"server/storage.ts":{"content":"import fs from \"fs/promises\";\nimport path from \"path\";\nimport { \n  type User, \n  type InsertUser, \n  type Document,\n  type InsertDocument,\n  type Department,\n  type InsertDepartment,\n  type Notification,\n  type InsertNotification,\n  type ControlCopy,\n  type InsertControlCopy,\n  type PrintLog,\n  type InsertPrintLog,\n  type DocumentRecipient,\n  type InsertDocumentRecipient\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  deleteUser(id: string): Promise<void>;\n  \n  getDocument(id: string): Promise<Document | undefined>;\n  getDocumentsByStatus(status: string, userId?: string): Promise<Document[]>;\n  getDocumentsByUser(userId: string): Promise<Document[]>;\n  createDocument(document: InsertDocument): Promise<Document>;\n  updateDocument(id: string, updates: Partial<Document>): Promise<Document | undefined>;\n  \n  getDepartments(): Promise<Department[]>;\n  createDepartment(department: InsertDepartment): Promise<Department>;\n  deleteDepartment(id: string): Promise<void>;\n  \n  assignDocumentToDepartments(documentId: string, departmentIds: string[]): Promise<void>;\n  getDocumentDepartments(documentId: string): Promise<Department[]>;\n  \n  createNotification(notification: InsertNotification): Promise<Notification>;\n  getUserNotifications(userId: string): Promise<Notification[]>;\n  markNotificationAsRead(id: string): Promise<void>;\n  \n  getUsersByRole(role: string): Promise<User[]>;\n  \n  createControlCopy(controlCopy: Omit<InsertControlCopy, 'copyNumber'>): Promise<ControlCopy>;\n  getControlCopiesByDocument(documentId: string): Promise<ControlCopy[]>;\n  getControlCopiesByUser(userId: string): Promise<ControlCopy[]>;\n  \n  createPrintLog(printLog: InsertPrintLog): Promise<PrintLog>;\n  getPrintLogsByDocument(documentId: string): Promise<PrintLog[]>;\n  getPrintLogsByUser(userId: string): Promise<PrintLog[]>;\n  \n  createDocumentRecipient(recipient: InsertDocumentRecipient): Promise<DocumentRecipient>;\n  getDocumentRecipients(documentId: string): Promise<DocumentRecipient[]>;\n  getUserAccessibleDocuments(userId: string): Promise<Document[]>;\n}\n\ninterface JsonData {\n  users: User[];\n  documents: Document[];\n  departments: Department[];\n  notifications: Notification[];\n  documentDepartments: Array<{ documentId: string; departmentId: string }>;\n  controlCopies: ControlCopy[];\n  printLogs: PrintLog[];\n  documentRecipients: DocumentRecipient[];\n}\n\nexport class JsonStorage implements IStorage {\n  private dataPath = path.join(process.cwd(), \"data.json\");\n  private data: JsonData = {\n    users: [],\n    documents: [],\n    departments: [],\n    notifications: [],\n    documentDepartments: [],\n    controlCopies: [],\n    printLogs: [],\n    documentRecipients: []\n  };\n  private ready: Promise<void>;\n  private saveQueue: Promise<void> = Promise.resolve();\n\n  constructor() {\n    this.ready = this.loadData();\n  }\n\n  private async loadData(): Promise<void> {\n    try {\n      const fileContent = await fs.readFile(this.dataPath, \"utf-8\");\n      this.data = JSON.parse(fileContent);\n    } catch (error) {\n      await this.initializeData();\n    }\n  }\n\n  private async initializeData(): Promise<void> {\n    this.data = {\n      users: [\n        {\n          id: \"creator-1\",\n          username: \"Priyanka.k@cybaemtech.com\",\n          password: \"123\",\n          role: \"creator\",\n          fullName: \"Priyanka K\",\n          masterCopyAccess: false\n        },\n        {\n          id: \"approver-1\",\n          username: \"approver@cybaem.com\",\n          password: \"123\",\n          role: \"approver\",\n          fullName: \"John Approver\",\n          masterCopyAccess: false\n        },\n        {\n          id: \"issuer-1\",\n          username: \"issuer@cybaem.com\",\n          password: \"123\",\n          role: \"issuer\",\n          fullName: \"Jane Issuer\",\n          masterCopyAccess: true\n        },\n        {\n          id: \"admin-1\",\n          username: \"admin@cybaem.com\",\n          password: \"123\",\n          role: \"admin\",\n          fullName: \"Admin User\",\n          masterCopyAccess: true\n        }\n      ],\n      departments: [\n        { id: \"dept-1\", name: \"Engineering\", code: \"ENG\", createdAt: new Date() },\n        { id: \"dept-2\", name: \"Quality Assurance\", code: \"QA\", createdAt: new Date() },\n        { id: \"dept-3\", name: \"Operations\", code: \"OPS\", createdAt: new Date() },\n        { id: \"dept-4\", name: \"Finance\", code: \"FIN\", createdAt: new Date() },\n        { id: \"dept-5\", name: \"Human Resources\", code: \"HR\", createdAt: new Date() }\n      ],\n      documents: [],\n      notifications: [],\n      documentDepartments: [],\n      controlCopies: [],\n      printLogs: [],\n      documentRecipients: []\n    };\n    await this.saveData();\n  }\n\n  private async saveData(): Promise<void> {\n    this.saveQueue = this.saveQueue.then(async () => {\n      await fs.writeFile(this.dataPath, JSON.stringify(this.data, null, 2));\n    });\n    await this.saveQueue;\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    await this.ready;\n    return this.data.users.find(u => u.id === id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    await this.ready;\n    return this.data.users.find(u => u.username === username);\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    await this.ready;\n    const user: User = {\n      id: `user-${Date.now()}`,\n      username: insertUser.username,\n      password: insertUser.password,\n      role: insertUser.role || \"creator\",\n      fullName: insertUser.fullName,\n      masterCopyAccess: insertUser.masterCopyAccess ?? false\n    };\n    this.data.users.push(user);\n    await this.saveData();\n    return user;\n  }\n\n  async deleteUser(id: string): Promise<void> {\n    await this.ready;\n    const index = this.data.users.findIndex(u => u.id === id);\n    if (index === -1) {\n      throw new Error(`User with id ${id} not found`);\n    }\n    this.data.users.splice(index, 1);\n    await this.saveData();\n  }\n\n  async getDocument(id: string): Promise<Document | undefined> {\n    await this.ready;\n    return this.data.documents.find(d => d.id === id);\n  }\n\n  async getDocumentsByStatus(status: string): Promise<Document[]> {\n    await this.ready;\n    return this.data.documents\n      .filter(d => d.status === status)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  }\n\n  async getDocumentsByUser(userId: string): Promise<Document[]> {\n    await this.ready;\n    return this.data.documents\n      .filter(d => d.preparedBy === userId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  }\n\n  async createDocument(insertDocument: InsertDocument): Promise<Document> {\n    await this.ready;\n    const doc: Document = {\n      id: `doc-${Date.now()}`,\n      docName: insertDocument.docName,\n      docNumber: insertDocument.docNumber,\n      status: \"pending\",\n      dateOfIssue: insertDocument.dateOfIssue || null,\n      revisionNo: insertDocument.revisionNo || 0,\n      preparedBy: insertDocument.preparedBy,\n      approvedBy: null,\n      issuedBy: null,\n      content: insertDocument.content || null,\n      headerInfo: insertDocument.headerInfo || null,\n      footerInfo: insertDocument.footerInfo || null,\n      duePeriodYears: insertDocument.duePeriodYears || null,\n      reasonForRevision: insertDocument.reasonForRevision || null,\n      reviewDueDate: insertDocument.reviewDueDate || null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      approvedAt: null,\n      issuedAt: null,\n      approvalRemarks: insertDocument.approvalRemarks || null,\n      declineRemarks: insertDocument.declineRemarks || null,\n      issueRemarks: null,\n      issuerName: null,\n      previousVersionId: insertDocument.previousVersionId || null,\n      pdfFilePath: null,\n      wordFilePath: null\n    };\n    this.data.documents.push(doc);\n    await this.saveData();\n    return doc;\n  }\n\n  async updateDocument(id: string, updates: Partial<Document>): Promise<Document | undefined> {\n    await this.ready;\n    const index = this.data.documents.findIndex(d => d.id === id);\n    if (index === -1) return undefined;\n    \n    this.data.documents[index] = {\n      ...this.data.documents[index],\n      ...updates,\n      updatedAt: new Date()\n    };\n    await this.saveData();\n    return this.data.documents[index];\n  }\n\n  async getDepartments(): Promise<Department[]> {\n    await this.ready;\n    return this.data.departments;\n  }\n\n  async createDepartment(insertDepartment: InsertDepartment): Promise<Department> {\n    await this.ready;\n    const dept: Department = {\n      ...insertDepartment,\n      id: `dept-${Date.now()}`,\n      createdAt: new Date()\n    };\n    this.data.departments.push(dept);\n    await this.saveData();\n    return dept;\n  }\n\n  async deleteDepartment(id: string): Promise<void> {\n    await this.ready;\n    const index = this.data.departments.findIndex(d => d.id === id);\n    if (index === -1) {\n      throw new Error(`Department with id ${id} not found`);\n    }\n    this.data.departments.splice(index, 1);\n    // Also remove any document-department associations\n    this.data.documentDepartments = this.data.documentDepartments.filter(\n      dd => dd.departmentId !== id\n    );\n    await this.saveData();\n  }\n\n  async assignDocumentToDepartments(documentId: string, departmentIds: string[]): Promise<void> {\n    await this.ready;\n    this.data.documentDepartments = this.data.documentDepartments.filter(\n      dd => dd.documentId !== documentId\n    );\n    \n    for (const deptId of departmentIds) {\n      this.data.documentDepartments.push({ documentId, departmentId: deptId });\n    }\n    \n    await this.saveData();\n  }\n\n  async getDocumentDepartments(documentId: string): Promise<Department[]> {\n    await this.ready;\n    const deptIds = this.data.documentDepartments\n      .filter(dd => dd.documentId === documentId)\n      .map(dd => dd.departmentId);\n    \n    return this.data.departments.filter(d => deptIds.includes(d.id));\n  }\n\n  async createNotification(insertNotification: InsertNotification): Promise<Notification> {\n    await this.ready;\n    const notification: Notification = {\n      ...insertNotification,\n      id: `notif-${Date.now()}-${Math.random()}`,\n      isRead: false,\n      createdAt: new Date()\n    };\n    this.data.notifications.push(notification);\n    await this.saveData();\n    return notification;\n  }\n\n  async getUserNotifications(userId: string): Promise<Notification[]> {\n    await this.ready;\n    return this.data.notifications\n      .filter(n => n.userId === userId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  }\n\n  async markNotificationAsRead(id: string): Promise<void> {\n    await this.ready;\n    const notification = this.data.notifications.find(n => n.id === id);\n    if (notification) {\n      notification.isRead = true;\n      await this.saveData();\n    }\n  }\n\n  async getUsersByRole(role: string): Promise<User[]> {\n    await this.ready;\n    return this.data.users.filter(u => u.role === role);\n  }\n\n  async createControlCopy(insertControlCopy: Omit<InsertControlCopy, 'copyNumber'>): Promise<ControlCopy> {\n    await this.ready;\n    \n    return new Promise((resolve, reject) => {\n      this.saveQueue = this.saveQueue.then(async () => {\n        try {\n          const copyNumber = await this.getNextCopyNumber(insertControlCopy.documentId, insertControlCopy.userId);\n          const controlCopy: ControlCopy = {\n            id: `cc-${Date.now()}-${Math.random()}`,\n            documentId: insertControlCopy.documentId,\n            userId: insertControlCopy.userId,\n            actionType: insertControlCopy.actionType,\n            copyNumber,\n            generatedAt: new Date()\n          };\n          this.data.controlCopies.push(controlCopy);\n          await fs.writeFile(this.dataPath, JSON.stringify(this.data, null, 2));\n          resolve(controlCopy);\n        } catch (error) {\n          reject(error);\n        }\n      });\n    });\n  }\n\n  async getControlCopiesByDocument(documentId: string): Promise<ControlCopy[]> {\n    await this.ready;\n    return this.data.controlCopies\n      .filter(cc => cc.documentId === documentId)\n      .sort((a, b) => new Date(b.generatedAt).getTime() - new Date(a.generatedAt).getTime());\n  }\n\n  async getControlCopiesByUser(userId: string): Promise<ControlCopy[]> {\n    await this.ready;\n    return this.data.controlCopies\n      .filter(cc => cc.userId === userId)\n      .sort((a, b) => new Date(b.generatedAt).getTime() - new Date(a.generatedAt).getTime());\n  }\n\n  async getNextCopyNumber(documentId: string, userId: string): Promise<number> {\n    await this.ready;\n    const userCopies = this.data.controlCopies.filter(\n      cc => cc.documentId === documentId && cc.userId === userId\n    );\n    if (userCopies.length === 0) return 1;\n    return Math.max(...userCopies.map(cc => cc.copyNumber)) + 1;\n  }\n\n  async createPrintLog(insertPrintLog: InsertPrintLog): Promise<PrintLog> {\n    await this.ready;\n    const printLog: PrintLog = {\n      id: `pl-${Date.now()}-${Math.random()}`,\n      documentId: insertPrintLog.documentId,\n      userId: insertPrintLog.userId,\n      controlCopyId: insertPrintLog.controlCopyId,\n      medium: insertPrintLog.medium || null,\n      printedAt: new Date()\n    };\n    this.data.printLogs.push(printLog);\n    await this.saveData();\n    return printLog;\n  }\n\n  async getPrintLogsByDocument(documentId: string): Promise<PrintLog[]> {\n    await this.ready;\n    return this.data.printLogs\n      .filter(pl => pl.documentId === documentId)\n      .sort((a, b) => new Date(b.printedAt).getTime() - new Date(a.printedAt).getTime());\n  }\n\n  async getPrintLogsByUser(userId: string): Promise<PrintLog[]> {\n    await this.ready;\n    return this.data.printLogs\n      .filter(pl => pl.userId === userId)\n      .sort((a, b) => new Date(b.printedAt).getTime() - new Date(a.printedAt).getTime());\n  }\n\n  async createDocumentRecipient(insertRecipient: InsertDocumentRecipient): Promise<DocumentRecipient> {\n    await this.ready;\n    \n    if (!insertRecipient.userId && !insertRecipient.departmentId) {\n      throw new Error(\"Document recipient must have either userId or departmentId\");\n    }\n    \n    const recipient: DocumentRecipient = {\n      id: `dr-${Date.now()}-${Math.random()}`,\n      documentId: insertRecipient.documentId,\n      userId: insertRecipient.userId || null,\n      departmentId: insertRecipient.departmentId || null,\n      notifiedAt: new Date(),\n      readAt: null\n    };\n    this.data.documentRecipients.push(recipient);\n    await this.saveData();\n    return recipient;\n  }\n\n  async getDocumentRecipients(documentId: string): Promise<DocumentRecipient[]> {\n    await this.ready;\n    return this.data.documentRecipients.filter(dr => dr.documentId === documentId);\n  }\n\n  async getUserAccessibleDocuments(userId: string): Promise<Document[]> {\n    await this.ready;\n    const accessibleDocIds = this.data.documentRecipients\n      .filter(dr => dr.userId === userId)\n      .map(dr => dr.documentId);\n    \n    return this.data.documents.filter(d => accessibleDocIds.includes(d.id) && d.status === 'issued');\n  }\n}\n\nexport const storage = new JsonStorage();\n","path":null,"size_bytes":15243,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport multer from \"multer\";\nimport express, { type Request, Response } from \"express\";\nimport { eq, like, sql } from \"drizzle-orm\";\nimport { pdfService } from \"./services/pdf-service\";\nimport puppeteer from \"puppeteer\";\nimport fs from \"fs/promises\";\nimport path from \"path\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  const upload = multer({ storage: multer.memoryStorage() });\n  \n  app.post(\"/api/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username and password are required\" });\n      }\n\n      const user = await storage.getUserByUsername(username);\n      \n      if (!user || user.password !== password) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      res.json({\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        fullName: user.fullName\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n  \n  app.get(\"/api/documents\", async (req, res) => {\n    try {\n      const { status, userId } = req.query;\n      let documents;\n      \n      if (status) {\n        documents = await storage.getDocumentsByStatus(status as string);\n      } else if (userId) {\n        documents = await storage.getDocumentsByUser(userId as string);\n      } else {\n        return res.status(400).json({ message: \"Status or userId query parameter is required\" });\n      }\n      \n      const documentsWithDetails = await Promise.all(\n        documents.map(async (doc) => {\n          const preparer = await storage.getUser(doc.preparedBy);\n          const approver = doc.approvedBy ? await storage.getUser(doc.approvedBy) : null;\n          const issuer = doc.issuedBy ? await storage.getUser(doc.issuedBy) : null;\n          const depts = await storage.getDocumentDepartments(doc.id);\n          \n          return {\n            ...doc,\n            preparerName: preparer?.fullName || \"Unknown\",\n            approverName: approver?.fullName || null,\n            issuerName: issuer?.fullName || null,\n            departments: depts\n          };\n        })\n      );\n      \n      res.json(documentsWithDetails);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/documents/due-for-review\", async (req, res) => {\n    try {\n      const { daysAhead = '30' } = req.query;\n      const daysAheadInt = parseInt(daysAhead as string, 10);\n      \n      if (isNaN(daysAheadInt) || daysAheadInt < 0) {\n        return res.status(400).json({ message: \"Invalid daysAhead parameter\" });\n      }\n      \n      const now = new Date();\n      const futureDate = new Date();\n      futureDate.setDate(futureDate.getDate() + daysAheadInt);\n      \n      const issuedDocs = await storage.getDocumentsByStatus(\"issued\");\n      \n      const dueForReview = issuedDocs.filter(doc => {\n        if (!doc.reviewDueDate) return false;\n        const dueDate = new Date(doc.reviewDueDate);\n        return dueDate <= futureDate;\n      });\n      \n      const documentsWithDetails = await Promise.all(\n        dueForReview.map(async (doc) => {\n          const preparer = await storage.getUser(doc.preparedBy);\n          const depts = await storage.getDocumentDepartments(doc.id);\n          const daysUntilDue = Math.ceil((new Date(doc.reviewDueDate!).getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n          \n          return {\n            ...doc,\n            preparerName: preparer?.fullName || \"Unknown\",\n            departments: depts,\n            daysUntilDue\n          };\n        })\n      );\n      \n      documentsWithDetails.sort((a, b) => a.daysUntilDue - b.daysUntilDue);\n      \n      res.json(documentsWithDetails);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/documents/:id\", async (req, res) => {\n    try {\n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      \n      const preparer = await storage.getUser(document.preparedBy);\n      const approver = document.approvedBy ? await storage.getUser(document.approvedBy) : null;\n      const issuer = document.issuedBy ? await storage.getUser(document.issuedBy) : null;\n      const depts = await storage.getDocumentDepartments(document.id);\n      const previousVersion = document.previousVersionId \n        ? await storage.getDocument(document.previousVersionId) \n        : null;\n      \n      res.json({\n        ...document,\n        preparerName: preparer?.fullName || \"Unknown\",\n        approverName: approver?.fullName || null,\n        issuerName: issuer?.fullName || null,\n        departments: depts,\n        previousVersion\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/documents\", upload.single('file'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"Word document file is required\" });\n      }\n\n      const allowedMimeTypes = [\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n        'application/msword'\n      ];\n      if (!allowedMimeTypes.includes(req.file.mimetype)) {\n        return res.status(400).json({ message: \"Only Word documents (.doc, .docx) are allowed\" });\n      }\n\n      const maxSize = 10 * 1024 * 1024;\n      if (req.file.size > maxSize) {\n        return res.status(400).json({ message: \"File size must be less than 10MB\" });\n      }\n\n      const extracted = await pdfService.extractHeaderFooterFromWord(req.file.buffer);\n\n      const duePeriodYears = req.body.duePeriodYears ? parseInt(req.body.duePeriodYears, 10) : undefined;\n      const dateOfIssue = req.body.dateOfIssue ? new Date(req.body.dateOfIssue) : new Date();\n      \n      let reviewDueDate = undefined;\n      if (duePeriodYears && duePeriodYears > 0) {\n        reviewDueDate = new Date(dateOfIssue);\n        reviewDueDate.setFullYear(reviewDueDate.getFullYear() + duePeriodYears);\n      }\n\n      const documentData = {\n        ...req.body,\n        revisionNo: req.body.revisionNo ? parseInt(req.body.revisionNo, 10) : 0,\n        duePeriodYears,\n        reasonForRevision: req.body.reasonForRevision || undefined,\n        dateOfIssue,\n        reviewDueDate,\n        headerInfo: extracted.headerInfo,\n        footerInfo: extracted.footerInfo\n      };\n      \n      const document = await storage.createDocument(documentData);\n      \n      const filePath = await pdfService.saveUploadedFile(\n        req.file.buffer,\n        req.file.originalname,\n        document.id\n      );\n      \n      await storage.updateDocument(document.id, { wordFilePath: filePath });\n      \n      const approvers = await storage.getUsersByRole(\"approver\");\n      for (const approver of approvers) {\n        await storage.createNotification({\n          userId: approver.id,\n          documentId: document.id,\n          message: `New document \"${document.docName}\" (${document.docNumber}) is ready for your approval`,\n          type: \"new_document\"\n        });\n      }\n      \n      res.status(201).json({ ...document, wordFilePath: filePath });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/documents/:id/approve\", async (req, res) => {\n    try {\n      const { approvalRemarks, approvedBy, approverName, departments } = req.body;\n      \n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      \n      const approver = await storage.getUser(approvedBy);\n      const finalApproverName = approverName || approver?.fullName || \"Unknown\";\n      \n      const updatedDoc = await storage.updateDocument(req.params.id, {\n        status: \"approved\",\n        approvalRemarks,\n        approvedBy,\n        approvedAt: new Date()\n      });\n      \n      if (departments && departments.length > 0) {\n        await storage.assignDocumentToDepartments(req.params.id, departments);\n      }\n      \n      const issuers = await storage.getUsersByRole(\"issuer\");\n      for (const issuer of issuers) {\n        await storage.createNotification({\n          userId: issuer.id,\n          documentId: req.params.id,\n          message: `Document \"${document.docName}\" (${document.docNumber}) has been approved by ${finalApproverName}. Remarks: \"${approvalRemarks}\"`,\n          type: \"approved_document\"\n        });\n      }\n      \n      await storage.createNotification({\n        userId: document.preparedBy,\n        documentId: req.params.id,\n        message: `Your document \"${document.docName}\" (${document.docNumber}) has been approved by ${finalApproverName}`,\n        type: \"document_status_update\"\n      });\n      \n      res.json(updatedDoc);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/documents/:id/decline\", async (req, res) => {\n    try {\n      const { declineRemarks } = req.body;\n      \n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      \n      const updatedDoc = await storage.updateDocument(req.params.id, {\n        status: \"declined\",\n        declineRemarks,\n        approvedBy: null,\n        issuedBy: null\n      });\n      \n      await storage.createNotification({\n        userId: document.preparedBy,\n        documentId: req.params.id,\n        message: `Your document \"${document.docName}\" (${document.docNumber}) has been declined by issuer. Remarks: ${declineRemarks}. Please review and resubmit.`,\n        type: \"document_declined\"\n      });\n      \n      res.json(updatedDoc);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/documents/:id/issue\", async (req, res) => {\n    try {\n      const { issuedBy, issuerName, remarks } = req.body;\n      \n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      \n      const updatedDoc = await storage.updateDocument(req.params.id, {\n        status: \"issued\",\n        issuedBy,\n        issuerName,\n        issueRemarks: remarks,\n        issuedAt: new Date()\n      });\n      \n      await storage.createNotification({\n        userId: document.preparedBy,\n        documentId: req.params.id,\n        message: `Your document \"${document.docName}\" (${document.docNumber}) has been issued by ${issuerName}`,\n        type: \"document_issued\"\n      });\n      \n      if (document.approvedBy) {\n        await storage.createNotification({\n          userId: document.approvedBy,\n          documentId: req.params.id,\n          message: `Document \"${document.docName}\" (${document.docNumber}) has been issued`,\n          type: \"document_issued\"\n        });\n      }\n      \n      const departments = await storage.getDocumentDepartments(req.params.id);\n      for (const dept of departments) {\n        await storage.createDocumentRecipient({\n          documentId: req.params.id,\n          departmentId: dept.id\n        });\n      }\n      \n      res.json(updatedDoc);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/notifications/:userId\", async (req, res) => {\n    try {\n      const notifications = await storage.getUserNotifications(req.params.userId);\n      res.json(notifications);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/notifications/:id/read\", async (req, res) => {\n    try {\n      await storage.markNotificationAsRead(req.params.id);\n      res.json({ message: \"Notification marked as read\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/departments\", async (req, res) => {\n    try {\n      const departments = await storage.getDepartments();\n      res.json(departments);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/departments\", async (req, res) => {\n    try {\n      const department = await storage.createDepartment(req.body);\n      res.status(201).json(department);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/users\", async (req, res) => {\n    try {\n      const user = await storage.createUser(req.body);\n      res.status(201).json(user);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/users\", async (req, res) => {\n    try {\n      const { role } = req.query;\n      if (role) {\n        const users = await storage.getUsersByRole(role as string);\n        res.json(users);\n      } else {\n        res.status(400).json({ message: \"Role query parameter is required\" });\n      }\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/users/:id\", async (req, res) => {\n    try {\n      await storage.deleteUser(req.params.id);\n      res.json({ success: true, message: \"User deleted successfully\" });\n    } catch (error: any) {\n      if (error.message.includes(\"not found\")) {\n        res.status(404).json({ message: error.message });\n      } else {\n        res.status(500).json({ message: error.message });\n      }\n    }\n  });\n\n  app.delete(\"/api/departments/:id\", async (req, res) => {\n    try {\n      await storage.deleteDepartment(req.params.id);\n      res.json({ success: true, message: \"Department deleted successfully\" });\n    } catch (error: any) {\n      if (error.message.includes(\"not found\")) {\n        res.status(404).json({ message: error.message });\n      } else {\n        res.status(500).json({ message: error.message });\n      }\n    }\n  });\n\n  app.get(\"/api/admin/users\", async (req, res) => {\n    try {\n      const creators = await storage.getUsersByRole(\"creator\");\n      const approvers = await storage.getUsersByRole(\"approver\");\n      const issuers = await storage.getUsersByRole(\"issuer\");\n      const admins = await storage.getUsersByRole(\"admin\");\n      const recipients = await storage.getUsersByRole(\"recipient\");\n      \n      res.json({\n        creators: creators.map(u => ({ id: u.id, username: u.username, fullName: u.fullName, role: u.role })),\n        approvers: approvers.map(u => ({ id: u.id, username: u.username, fullName: u.fullName, role: u.role })),\n        issuers: issuers.map(u => ({ id: u.id, username: u.username, fullName: u.fullName, role: u.role })),\n        admins: admins.map(u => ({ id: u.id, username: u.username, fullName: u.fullName, role: u.role })),\n        recipients: recipients.map(u => ({ id: u.id, username: u.username, fullName: u.fullName, role: u.role })),\n        total: creators.length + approvers.length + issuers.length + admins.length + recipients.length\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/documents\", async (req, res) => {\n    try {\n      const pending = await storage.getDocumentsByStatus(\"pending\");\n      const approved = await storage.getDocumentsByStatus(\"approved\");\n      const issued = await storage.getDocumentsByStatus(\"issued\");\n      const declined = await storage.getDocumentsByStatus(\"declined\");\n      \n      const allDocs = [...pending, ...approved, ...issued, ...declined];\n      \n      const documentsWithDetails = await Promise.all(\n        allDocs.map(async (doc) => {\n          const preparer = await storage.getUser(doc.preparedBy);\n          const approver = doc.approvedBy ? await storage.getUser(doc.approvedBy) : null;\n          const issuer = doc.issuedBy ? await storage.getUser(doc.issuedBy) : null;\n          const depts = await storage.getDocumentDepartments(doc.id);\n          \n          return {\n            ...doc,\n            preparerName: preparer?.fullName || \"Unknown\",\n            approverName: approver?.fullName || null,\n            issuerName: issuer?.fullName || null,\n            departments: depts\n          };\n        })\n      );\n      \n      res.json({\n        documents: documentsWithDetails,\n        stats: {\n          total: allDocs.length,\n          pending: pending.length,\n          approved: approved.length,\n          issued: issued.length,\n          declined: declined.length\n        }\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/stats\", async (req, res) => {\n    try {\n      const pending = await storage.getDocumentsByStatus(\"pending\");\n      const approved = await storage.getDocumentsByStatus(\"approved\");\n      const issued = await storage.getDocumentsByStatus(\"issued\");\n      const declined = await storage.getDocumentsByStatus(\"declined\");\n      const departments = await storage.getDepartments();\n      \n      const creators = await storage.getUsersByRole(\"creator\");\n      const approvers = await storage.getUsersByRole(\"approver\");\n      const issuers = await storage.getUsersByRole(\"issuer\");\n      \n      const now = new Date();\n      const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n      \n      const allDocs = [...pending, ...approved, ...issued, ...declined];\n      const recentDocs = allDocs.filter(doc => \n        doc.createdAt && new Date(doc.createdAt) >= thirtyDaysAgo\n      );\n      \n      const weeklyActivity = [];\n      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n      for (let i = 6; i >= 0; i--) {\n        const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);\n        const dayDocs = allDocs.filter(doc => {\n          if (!doc.createdAt) return false;\n          const docDate = new Date(doc.createdAt);\n          return docDate.toDateString() === date.toDateString();\n        });\n        weeklyActivity.push({\n          day: days[date.getDay()],\n          documents: dayDocs.length\n        });\n      }\n      \n      res.json({\n        documents: {\n          total: allDocs.length,\n          pending: pending.length,\n          approved: approved.length,\n          issued: issued.length,\n          declined: declined.length,\n          recentCount: recentDocs.length\n        },\n        users: {\n          creators: creators.length,\n          approvers: approvers.length,\n          issuers: issuers.length,\n          total: creators.length + approvers.length + issuers.length\n        },\n        departments: {\n          total: departments.length,\n          list: departments\n        },\n        weeklyActivity,\n        recentDocuments: allDocs.slice(0, 10).map(doc => ({\n          id: doc.id,\n          docName: doc.docName,\n          docNumber: doc.docNumber,\n          status: doc.status,\n          createdAt: doc.createdAt\n        }))\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/documents/:id/upload\", upload.single('file'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n\n      const filePath = await pdfService.saveUploadedFile(\n        req.file.buffer,\n        req.file.originalname,\n        req.params.id\n      );\n\n      const updatedDoc = await storage.updateDocument(req.params.id, {\n        wordFilePath: filePath\n      });\n\n      res.json({ message: \"File uploaded successfully\", document: updatedDoc });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/documents/:id/download\", async (req, res) => {\n    try {\n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n\n      if (!document.wordFilePath) {\n        return res.status(404).json({ message: \"No Word file available for this document\" });\n      }\n\n      const path = await import(\"path\");\n      const fs = await import(\"fs/promises\");\n      \n      try {\n        await fs.access(document.wordFilePath);\n        const fileName = path.basename(document.wordFilePath);\n        \n        res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document');\n        res.setHeader('Content-Disposition', `attachment; filename=\"${fileName}\"`);\n        \n        const fileBuffer = await fs.readFile(document.wordFilePath);\n        res.send(fileBuffer);\n      } catch (err) {\n        return res.status(404).json({ message: \"Word file not found on server\" });\n      }\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/documents/:id/view-word\", async (req, res) => {\n    try {\n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n\n      if (!document.wordFilePath) {\n        return res.status(404).json({ message: \"No Word file available for this document\" });\n      }\n\n      try {\n        await fs.access(document.wordFilePath);\n        const wordBuffer = await fs.readFile(document.wordFilePath);\n        \n        const mammoth = await import(\"mammoth\");\n        const result = await mammoth.default.convertToHtml({ buffer: wordBuffer });\n        \n        res.json({\n          html: result.value,\n          messages: result.messages,\n          docName: document.docName,\n          docNumber: document.docNumber,\n          revisionNo: document.revisionNo\n        });\n      } catch (err) {\n        return res.status(404).json({ message: \"Word file not found on server\" });\n      }\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Health check endpoint for PDF service\n  app.get(\"/api/health/pdf\", async (req, res) => {\n    try {\n      console.log('PDF health check requested');\n      \n      // Test Puppeteer\n      const browser = await puppeteer.launch({\n        headless: true,\n        args: ['--no-sandbox', '--disable-setuid-sandbox']\n      });\n      \n      const page = await browser.newPage();\n      await page.setContent('<html><body><h1>Test PDF</h1></body></html>');\n      \n      const pdfBuffer = await page.pdf({\n        format: 'A4',\n        printBackground: true\n      });\n      \n      await browser.close();\n      \n      res.json({\n        status: 'healthy',\n        pdfService: 'operational',\n        puppeteer: 'working',\n        testPdfSize: pdfBuffer.length\n      });\n    } catch (error: any) {\n      console.error('PDF health check failed:', error);\n      res.status(500).json({\n        status: 'unhealthy',\n        error: error.message,\n        pdfService: 'failed'\n      });\n    }\n  });\n\n  app.get(\"/api/documents/:id/pdf\", async (req, res) => {\n    try {\n      console.log('PDF request for document:', req.params.id);\n      \n      const { userId, version } = req.query;\n      if (!userId) {\n        console.log('Missing userId parameter');\n        return res.status(400).json({ message: \"userId query parameter is required\" });\n      }\n      \n      const user = await storage.getUser(userId as string);\n      if (!user) {\n        console.log('User not found:', userId);\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      let document = await storage.getDocument(req.params.id);\n      if (!document) {\n        console.log('Document not found:', req.params.id);\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      \n      console.log('Found document:', document.docName, 'Status:', document.status);\n      \n      const originalDocNumber = document.docNumber;\n      const allIssuedDocs = await storage.getDocumentsByStatus(\"issued\");\n      const allVersions = allIssuedDocs.filter(d => d.docNumber === originalDocNumber);\n      \n      if (allVersions.length === 0) {\n        console.log('No issued versions found for document:', originalDocNumber);\n        return res.status(404).json({ message: \"No issued versions found for this document\" });\n      }\n      \n      const latestVersion = allVersions.reduce((latest, current) => {\n        return current.revisionNo > latest.revisionNo ? current : latest;\n      }, allVersions[0]);\n      \n      if (version !== undefined) {\n        const requestedVersion = parseInt(version as string, 10);\n        if (isNaN(requestedVersion)) {\n          return res.status(400).json({ message: \"Invalid version parameter\" });\n        }\n        if (!user.masterCopyAccess) {\n          return res.status(403).json({ message: \"Access denied. Only master copy users can access specific versions.\" });\n        }\n        const requestedDoc = allVersions.find(d => d.revisionNo === requestedVersion);\n        if (!requestedDoc) {\n          return res.status(404).json({ message: `Version ${requestedVersion} not found` });\n        }\n        document = await storage.getDocument(requestedDoc.id) || requestedDoc;\n      } else if (!user.masterCopyAccess && document.id !== latestVersion.id) {\n        return res.status(403).json({ message: \"Access denied. Only the latest version can be accessed. Please contact administrator for previous versions.\" });\n      }\n      \n      if (document.status !== \"issued\") {\n        console.log('Document not issued, status:', document.status);\n        return res.status(403).json({ message: \"Only issued documents can be viewed as PDF\" });\n      }\n      \n      if (!document.wordFilePath) {\n        console.log('No Word file path for document:', document.id);\n        return res.status(404).json({ message: \"No Word file uploaded for this document\" });\n      }\n\n      // Verify file exists before processing\n      try {\n        await fs.access(document.wordFilePath);\n        console.log('Word file exists:', document.wordFilePath);\n      } catch (fileError) {\n        console.error('Word file not found:', document.wordFilePath, fileError);\n        return res.status(404).json({ message: \"Word file not found on server\" });\n      }\n\n      let pdfPath;\n      try {\n        console.log('Creating control copy...');\n        const controlCopy = await storage.createControlCopy({\n          documentId: document.id,\n          userId: userId as string,\n          actionType: \"view\"\n        });\n        \n        const controlCopyInfo = {\n          userId: user.id,\n          userFullName: user.fullName,\n          controlCopyNumber: controlCopy.copyNumber,\n          date: new Date().toLocaleDateString()\n        };\n        \n        console.log('Converting Word to PDF with control copy:', controlCopy.copyNumber);\n        pdfPath = await pdfService.convertWordToPDF(\n          document.wordFilePath,\n          document,\n          controlCopyInfo\n        );\n        \n        console.log('PDF conversion successful:', pdfPath);\n      } catch (err: any) {\n        console.error(\"PDF conversion error:\", err);\n        return res.status(500).json({ message: \"Failed to convert Word to PDF. Please check the document file and try again.\" });\n      }\n      \n      try {\n        console.log('Reading PDF file:', pdfPath);\n        const pdfBuffer = await fs.readFile(pdfPath);\n        \n        if (pdfBuffer.length === 0) {\n          throw new Error('PDF file is empty');\n        }\n        \n        console.log('Sending PDF response, size:', pdfBuffer.length);\n        res.setHeader('Content-Type', 'application/pdf');\n        res.setHeader('Content-Disposition', 'inline');\n        res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n        res.setHeader('Content-Length', pdfBuffer.length.toString());\n        res.send(pdfBuffer);\n        \n      } catch (err: any) {\n        console.error(\"PDF file read error:\", err);\n        return res.status(500).json({ message: \"PDF file not found or unreadable after conversion.\" });\n      }\n    } catch (error: any) {\n      console.error(\"PDF endpoint error:\", error);\n      res.status(500).json({ message: error.message || 'Internal server error' });\n    }\n  });\n\n  app.post(\"/api/documents/:id/print\", async (req, res) => {\n    try {\n      const { userId, version } = req.body;\n      if (!userId || typeof userId !== 'string' || userId.trim() === '') {\n        return res.status(400).json({ message: \"userId is required and must be a non-empty string.\" });\n      }\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      let document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      const originalDocNumber = document.docNumber;\n      const allIssuedDocs = await storage.getDocumentsByStatus(\"issued\");\n      const allVersions = allIssuedDocs.filter(d => d.docNumber === originalDocNumber);\n      if (allVersions.length === 0) {\n        return res.status(404).json({ message: \"No issued versions found for this document\" });\n      }\n      const latestVersion = allVersions.reduce((latest, current) => {\n        return current.revisionNo > latest.revisionNo ? current : latest;\n      }, allVersions[0]);\n      if (version !== undefined) {\n        const requestedVersion = parseInt(version as string, 10);\n        if (isNaN(requestedVersion)) {\n          return res.status(400).json({ message: \"Invalid version parameter\" });\n        }\n        if (!user.masterCopyAccess) {\n          return res.status(403).json({ message: \"Access denied. Only master copy users can print specific versions.\" });\n        }\n        const requestedDoc = allVersions.find(d => d.revisionNo === requestedVersion);\n        if (!requestedDoc) {\n          return res.status(404).json({ message: `Version ${requestedVersion} not found` });\n        }\n        document = await storage.getDocument(requestedDoc.id) || requestedDoc;\n      } else if (!user.masterCopyAccess && document.id !== latestVersion.id) {\n        return res.status(403).json({ message: \"Access denied. Only the latest version can be printed. Please contact administrator for previous versions.\" });\n      }\n      if (document.status !== \"issued\") {\n        return res.status(403).json({ message: \"Only issued documents can be printed\" });\n      }\n      if (!document.wordFilePath) {\n        return res.status(404).json({ message: \"No Word file uploaded for this document\" });\n      }\n      // Check for document content before PDF generation\n      // Instead of checking document.content, check if word file exists and is accessible\n      try {\n        await fs.access(document.wordFilePath);\n        const stats = await fs.stat(document.wordFilePath);\n        if (stats.size === 0) {\n          return res.status(400).json({ message: \"Document file is empty. Cannot generate PDF.\" });\n        }\n      } catch (fileError) {\n        return res.status(400).json({ message: \"Document file not found or inaccessible. Cannot generate PDF.\" });\n      }\n      let pdfPath;\n      try {\n        const controlCopy = await storage.createControlCopy({\n          documentId: document.id,\n          userId: userId,\n          actionType: \"print\"\n        });\n        await storage.createPrintLog({\n          documentId: document.id,\n          userId: userId,\n          controlCopyId: controlCopy.id,\n          medium: \"PDF\"\n        });\n        const controlCopyInfo = {\n          userId: user.id,\n          userFullName: user.fullName,\n          controlCopyNumber: controlCopy.copyNumber,\n          date: new Date().toLocaleDateString()\n        };\n        pdfPath = await pdfService.convertWordToPDF(\n          document.wordFilePath,\n          document,\n          controlCopyInfo\n        );\n      } catch (err) {\n        console.error(\"PDF conversion error (print):\", err);\n        return res.status(500).json({ message: \"Failed to convert Word to PDF for printing. Please check the document file and try again.\" });\n      }\n      try {\n        const pdfBuffer = await fs.readFile(pdfPath);\n        res.setHeader('Content-Type', 'application/pdf');\n        res.setHeader('Content-Disposition', 'inline');\n        res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n        res.send(pdfBuffer);\n      } catch (err) {\n        console.error(\"PDF file read error (print):\", err);\n        return res.status(500).json({ message: \"PDF file not found or unreadable after conversion.\" });\n      }\n    } catch (error: any) {\n      console.error(\"Print endpoint error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/reports/print-logs\", async (req, res) => {\n    try {\n      const { documentId, userId } = req.query;\n      \n      let printLogs;\n      if (documentId) {\n        printLogs = await storage.getPrintLogsByDocument(documentId as string);\n      } else if (userId) {\n        printLogs = await storage.getPrintLogsByUser(userId as string);\n      } else {\n        return res.status(400).json({ message: \"documentId or userId query parameter is required\" });\n      }\n\n      const logsWithDetails = await Promise.all(\n        printLogs.map(async (log) => {\n          const document = await storage.getDocument(log.documentId);\n          const user = await storage.getUser(log.userId);\n          const controlCopy = await storage.getControlCopiesByDocument(log.documentId);\n          const userCopy = controlCopy.find(cc => cc.id === log.controlCopyId);\n\n          return {\n            ...log,\n            documentName: document?.docName || \"Unknown\",\n            documentNumber: document?.docNumber || \"Unknown\",\n            userName: user?.fullName || \"Unknown\",\n            userEmail: user?.username || \"Unknown\",\n            controlCopyNumber: userCopy?.copyNumber || 0,\n          };\n        })\n      );\n\n      res.json(logsWithDetails);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/reports/control-copies\", async (req, res) => {\n    try {\n      const { documentId, userId } = req.query;\n      \n      let controlCopies;\n      if (documentId) {\n        controlCopies = await storage.getControlCopiesByDocument(documentId as string);\n      } else if (userId) {\n        controlCopies = await storage.getControlCopiesByUser(userId as string);\n      } else {\n        return res.status(400).json({ message: \"documentId or userId query parameter is required\" });\n      }\n\n      const copiesWithDetails = await Promise.all(\n        controlCopies.map(async (cc) => {\n          const document = await storage.getDocument(cc.documentId);\n          const user = await storage.getUser(cc.userId);\n\n          return {\n            ...cc,\n            documentName: document?.docName || \"Unknown\",\n            documentNumber: document?.docNumber || \"Unknown\",\n            userName: user?.fullName || \"Unknown\",\n            userEmail: user?.username || \"Unknown\",\n          };\n        })\n      );\n\n      res.json(copiesWithDetails);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/documents/:docNumber/versions\", async (req, res) => {\n    try {\n      const { userId } = req.query;\n      \n      if (!userId) {\n        return res.status(400).json({ message: \"userId query parameter is required\" });\n      }\n\n      const user = await storage.getUser(userId as string);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const allDocuments = await storage.getDocumentsByStatus(\"issued\");\n      const documentVersions = allDocuments.filter(d => d.docNumber === req.params.docNumber);\n\n      if (user.masterCopyAccess) {\n        res.json(documentVersions);\n      } else {\n        const latestVersion = documentVersions.reduce((latest, current) => {\n          return current.revisionNo > latest.revisionNo ? current : latest;\n        }, documentVersions[0]);\n        res.json([latestVersion]);\n      }\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":36535,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/DocumentUploadForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card } from \"@/components/ui/card\";\nimport { Upload, FileText, X } from \"lucide-react\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\nconst documentSchema = z.object({\n  docName: z.string().min(1, \"Document name is required\"),\n  docNumber: z.string().min(1, \"Document number is required\"),\n  dateOfIssue: z.string().min(1, \"Date of issue is required\"),\n  revisionNumber: z.string().min(1, \"Revision number is required\"),\n  duePeriodYears: z.string().optional(),\n  preparerName: z.string().min(1, \"Preparer name is required\"),\n  reasonForRevision: z.string().optional(),\n});\n\ntype DocumentFormValues = z.infer<typeof documentSchema>;\n\ninterface DocumentUploadFormProps {\n  onSubmit?: (data: DocumentFormValues & { file?: File }) => void;\n}\n\nexport default function DocumentUploadForm({ onSubmit }: DocumentUploadFormProps) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [fileError, setFileError] = useState<string>(\"\");\n\n  const form = useForm<DocumentFormValues>({\n    resolver: zodResolver(documentSchema),\n    defaultValues: {\n      docName: \"\",\n      docNumber: \"\",\n      dateOfIssue: \"\",\n      revisionNumber: \"0\",\n      duePeriodYears: \"\",\n      preparerName: \"\",\n      reasonForRevision: \"\",\n    },\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files[0]) {\n      setSelectedFile(e.target.files[0]);\n      setFileError(\"\");\n    }\n  };\n\n  const handleSubmit = (data: DocumentFormValues) => {\n    if (!selectedFile) {\n      setFileError(\"Word document is required for document content.\");\n      return;\n    }\n    onSubmit?.({ ...data, file: selectedFile });\n    console.log(\"Form submitted:\", { ...data, file: selectedFile?.name });\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6\">\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Document Information</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"docName\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Document Name *</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"e.g., Quality Control SOP\" {...field} data-testid=\"input-doc-name\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"docNumber\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Document Number *</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"e.g., QC-SOP-001\" {...field} data-testid=\"input-doc-number\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"dateOfIssue\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Date of Issue *</FormLabel>\n                  <FormControl>\n                    <Input type=\"date\" {...field} data-testid=\"input-date-issue\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"revisionNumber\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Revision Number *</FormLabel>\n                  <FormControl>\n                    <Input type=\"number\" placeholder=\"0\" {...field} data-testid=\"input-revision-number\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"duePeriodYears\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Due Period (Years)</FormLabel>\n                  <FormControl>\n                    <Input type=\"number\" placeholder=\"e.g., 2\" {...field} data-testid=\"input-due-period\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"preparerName\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Preparer Name *</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Your name\" {...field} data-testid=\"input-preparer-name\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          <FormField\n            control={form.control}\n            name=\"reasonForRevision\"\n            render={({ field }) => (\n              <FormItem className=\"mt-4\">\n                <FormLabel>Reason for Revision</FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Describe the reason for document revision...\"\n                    className=\"resize-none\"\n                    rows={3}\n                    {...field}\n                    data-testid=\"input-revision-reason\"\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n        </Card>\n\n        <Card className=\"p-6 border-blue-200 dark:border-blue-900\">\n          <h3 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n            <Upload className=\"w-5 h-5 text-blue-600\" />\n            Upload Word Document *\n          </h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Upload your Word document. This will be the main content of your document.\n          </p>\n          <div className=\"border-2 border-dashed rounded-lg p-8 text-center hover:border-blue-400 transition-colors\">\n            <input\n              type=\"file\"\n              id=\"file-upload\"\n              className=\"hidden\"\n              accept=\".doc,.docx\"\n              onChange={handleFileChange}\n              data-testid=\"input-file-upload\"\n            />\n            <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\n              {selectedFile ? (\n                <div className=\"flex items-center justify-center gap-3\">\n                  <FileText className=\"w-10 h-10 text-primary\" />\n                  <div className=\"text-left\">\n                    <p className=\"text-sm font-medium text-foreground\">{selectedFile.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {(selectedFile.size / 1024).toFixed(2)} KB\n                    </p>\n                  </div>\n                  <Button\n                    type=\"button\"\n                    size=\"icon\"\n                    variant=\"ghost\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      setSelectedFile(null);\n                      setFileError(\"\");\n                    }}\n                    data-testid=\"button-remove-file\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  <Upload className=\"w-10 h-10 mx-auto text-muted-foreground\" />\n                  <p className=\"text-sm font-medium text-foreground\">Click to upload Word document</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Word documents only (.doc, .docx) - Required\n                  </p>\n                </div>\n              )}\n            </label>\n          </div>\n          {fileError && (\n            <p className=\"text-sm text-red-500 mt-2\" data-testid=\"text-file-error\">{fileError}</p>\n          )}\n        </Card>\n\n        <div className=\"flex justify-end gap-4\">\n          <Button type=\"button\" variant=\"outline\" data-testid=\"button-cancel\">\n            Cancel\n          </Button>\n          <Button type=\"submit\" data-testid=\"button-submit\">\n            Submit for Approval\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}\n","path":null,"size_bytes":8783,"size_tokens":null},"client/src/components/examples/StatCard.tsx":{"content":"import StatCard from \"../StatCard\";\nimport { FileText, CheckCircle, Clock, AlertCircle } from \"lucide-react\";\n\nexport default function StatCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 p-6\">\n      <StatCard title=\"Total Documents\" value={245} icon={FileText} trend=\"+12% from last month\" />\n      <StatCard title=\"Pending Approval\" value={18} icon={Clock} trend=\"5 urgent\" />\n      <StatCard title=\"Issued\" value={203} icon={CheckCircle} trend=\"This month: 23\" />\n      <StatCard title=\"Declined\" value={24} icon={AlertCircle} />\n    </div>\n  );\n}\n","path":null,"size_bytes":602,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    // Disable runtime error overlay to prevent \"unknown runtime error\" issues\n    // runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(__dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(__dirname, \"shared\"),\n      \"@assets\": path.resolve(__dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(__dirname, \"client\"),\n  build: {\n    outDir: path.resolve(__dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    hmr: {\n      overlay: false  // Disable HMR overlay to prevent runtime error messages\n    },\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1311,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  role: text(\"role\").notNull().default(\"creator\"),\n  fullName: text(\"full_name\").notNull(),\n  masterCopyAccess: boolean(\"master_copy_access\").notNull().default(false),\n});\n\nexport const departments = pgTable(\"departments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().unique(),\n  code: text(\"code\").notNull().unique(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const documents = pgTable(\"documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  docName: text(\"doc_name\").notNull(),\n  docNumber: text(\"doc_number\").notNull().unique(),\n  status: text(\"status\").notNull().default(\"pending\"),\n  dateOfIssue: timestamp(\"date_of_issue\").defaultNow(),\n  revisionNo: integer(\"revision_no\").notNull().default(0),\n  preparedBy: varchar(\"prepared_by\").notNull().references(() => users.id),\n  approvedBy: varchar(\"approved_by\").references(() => users.id),\n  issuedBy: varchar(\"issued_by\").references(() => users.id),\n  content: text(\"content\"),\n  headerInfo: text(\"header_info\"),\n  footerInfo: text(\"footer_info\"),\n  duePeriodYears: integer(\"due_period_years\"),\n  reasonForRevision: text(\"reason_for_revision\"),\n  reviewDueDate: timestamp(\"review_due_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  approvedAt: timestamp(\"approved_at\"),\n  issuedAt: timestamp(\"issued_at\"),\n  approvalRemarks: text(\"approval_remarks\"),\n  declineRemarks: text(\"decline_remarks\"),\n  issueRemarks: text(\"issue_remarks\"),\n  issuerName: text(\"issuer_name\"),\n  previousVersionId: varchar(\"previous_version_id\").references((): any => documents.id),\n  pdfFilePath: text(\"pdf_file_path\"),\n  wordFilePath: text(\"word_file_path\"),\n});\n\nexport const documentDepartments = pgTable(\"document_departments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").notNull().references(() => documents.id),\n  departmentId: varchar(\"department_id\").notNull().references(() => departments.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  documentId: varchar(\"document_id\").notNull().references(() => documents.id),\n  message: text(\"message\").notNull(),\n  type: text(\"type\").notNull(),\n  isRead: boolean(\"is_read\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const controlCopies = pgTable(\"control_copies\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").notNull().references(() => documents.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  copyNumber: integer(\"copy_number\").notNull(),\n  actionType: text(\"action_type\").notNull(),\n  generatedAt: timestamp(\"generated_at\").defaultNow().notNull(),\n});\n\nexport const printLogs = pgTable(\"print_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").notNull().references(() => documents.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  controlCopyId: varchar(\"control_copy_id\").notNull().references(() => controlCopies.id),\n  printedAt: timestamp(\"printed_at\").defaultNow().notNull(),\n  medium: text(\"medium\"),\n});\n\nexport const documentRecipients = pgTable(\"document_recipients\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").notNull().references(() => documents.id),\n  userId: varchar(\"user_id\").references(() => users.id),\n  departmentId: varchar(\"department_id\").references(() => departments.id),\n  notifiedAt: timestamp(\"notified_at\").defaultNow().notNull(),\n  readAt: timestamp(\"read_at\"),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n  fullName: true,\n  role: true,\n  masterCopyAccess: true,\n});\n\nexport const insertDocumentSchema = createInsertSchema(documents).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  approvedAt: true,\n  issuedAt: true,\n});\n\nexport const insertDepartmentSchema = createInsertSchema(departments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertControlCopySchema = createInsertSchema(controlCopies).omit({\n  id: true,\n  generatedAt: true,\n  copyNumber: true,\n});\n\nexport const insertPrintLogSchema = createInsertSchema(printLogs).omit({\n  id: true,\n  printedAt: true,\n});\n\nexport const insertDocumentRecipientSchema = createInsertSchema(documentRecipients).omit({\n  id: true,\n  notifiedAt: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type Document = typeof documents.$inferSelect;\nexport type InsertDocument = z.infer<typeof insertDocumentSchema>;\nexport type Department = typeof departments.$inferSelect;\nexport type InsertDepartment = z.infer<typeof insertDepartmentSchema>;\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type ControlCopy = typeof controlCopies.$inferSelect;\nexport type InsertControlCopy = z.infer<typeof insertControlCopySchema>;\nexport type PrintLog = typeof printLogs.$inferSelect;\nexport type InsertPrintLog = z.infer<typeof insertPrintLogSchema>;\nexport type DocumentRecipient = typeof documentRecipients.$inferSelect;\nexport type InsertDocumentRecipient = z.infer<typeof insertDocumentRecipientSchema>;\n","path":null,"size_bytes":6168,"size_tokens":null},"client/src/components/examples/NotificationPopup.tsx":{"content":"import { useState } from \"react\";\nimport NotificationPopup from \"../NotificationPopup\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function NotificationPopupExample() {\n  const [notifications, setNotifications] = useState<any[]>([]);\n\n  const addNotification = (type: \"success\" | \"error\" | \"info\" | \"warning\") => {\n    const newNotif = {\n      id: Date.now().toString(),\n      type,\n      title: `${type.charAt(0).toUpperCase() + type.slice(1)} Notification`,\n      message: `This is a ${type} notification message.`,\n    };\n    setNotifications((prev) => [...prev, newNotif]);\n  };\n\n  return (\n    <div className=\"p-6 space-x-4\">\n      <Button onClick={() => addNotification(\"success\")}>Success</Button>\n      <Button onClick={() => addNotification(\"error\")} variant=\"destructive\">\n        Error\n      </Button>\n      <Button onClick={() => addNotification(\"warning\")}>Warning</Button>\n      <Button onClick={() => addNotification(\"info\")}>Info</Button>\n\n      {notifications.map((notif) => (\n        <NotificationPopup\n          key={notif.id}\n          notification={notif}\n          onDismiss={(id) => setNotifications((prev) => prev.filter((n) => n.id !== id))}\n        />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1228,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"replit.md":{"content":"# Document Management System (DMS)\n\n## Overview\n\nThis is an enterprise-grade Document Management System built to handle the complete lifecycle of controlled documents. The system manages document creation, approval workflows, issuance, and version control with full audit trails. It supports role-based access control with distinct interfaces for document creators, approvers, and issuers, ensuring proper document governance in corporate environments.\n\nThe application provides a structured workflow where documents move through creation → approval → issuance stages, with the ability to track revisions, manage department assignments, and maintain comprehensive document metadata including headers, footers, and control copy numbers.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## Recent Changes\n\n### November 2025 - Replit Environment Setup\n1. **Project Import Setup**:\n   - Installed Node.js 20 runtime environment\n   - Installed all npm dependencies (React, Vite, Express, TypeScript, shadcn/ui components)\n   - Fixed missing document schema fields in JsonStorage (duePeriodYears, reasonForRevision, reviewDueDate)\n   - Updated browserslist database to latest version\n   \n2. **Development Workflow Configuration**:\n   - Set up workflow to run `npm run dev` on port 5000\n   - Configured Vite dev server with `allowedHosts: true` for Replit proxy compatibility\n   - Server binds to 0.0.0.0:5000 for proper external access\n   - Development server serves both frontend (via Vite) and backend API (Express)\n\n3. **Deployment Configuration**:\n   - Configured autoscale deployment target for stateless operation\n   - Build command: `npm run build` (compiles both frontend and backend)\n   - Run command: `npm run start` (production-ready Express server)\n   - Static files served from `dist/public` directory\n\n4. **Data Initialization**:\n   - JSON storage automatically creates `data.json` with sample data on first run\n   - Pre-seeded with test users for each role (creator, approver, issuer, admin)\n   - Pre-configured departments for document assignment\n\n### November 2025 - Login & Document Enhancement\n1. **Login Page Improvements**:\n   - Redesigned login UI with modern, clean layout\n   - Removed role dropdown - role is now automatically determined from user credentials\n   - Added dark mode toggle in header\n   - Updated demo credentials display to show actual system users\n   - Implemented backend authentication endpoint (`POST /api/login`) for credential validation\n\n2. **Document Header/Footer Auto-Extraction**:\n   - Removed manual header/footer input fields from document creation form\n   - Implemented automatic extraction from uploaded Word documents using `mammoth` library\n   - Backend processes headers/footers during document upload via `pdfService.extractHeaderFooterFromWord`\n   - Added informative message on form explaining auto-extraction feature\n\n3. **PDF Viewing & Printing**:\n   - Verified PDF viewing functionality with control copy tracking working correctly\n   - Control copy footer includes: User ID, Control Copy Number, and Date\n   - Print functionality logs all print events to audit trail\n\n4. **Word Document View & Download Options**:\n   - Added separate \"View Word\" and \"Download as Word\" menu options in DocumentTable dropdown\n   - Both Approver and Issuer dashboards now support viewing Word documents in modal viewer\n   - Both dashboards also support direct download of original Word files\n   - Implemented handleViewWord and handleDownload handlers in both dashboard pages\n   - Backend `/api/documents/:id/word` endpoint serves Word files with proper headers\n\n5. **Puppeteer Configuration Enhancement**:\n   - Enhanced Puppeteer launch arguments for better compatibility in cloud/containerized environments\n   - Added args: `--disable-dev-shm-usage`, `--disable-accelerated-2d-canvas`, `--disable-gpu`, `--no-first-run`, `--no-zygote`, `--single-process`\n   - Improved headless browser stability for PDF generation in Replit environment\n   - All args designed to prevent common Chromium issues in sandboxed environments\n\n6. **Document Review Reminder System**:\n   - Added `duePeriodYears` and `reasonForRevision` fields to document schema\n   - System automatically calculates `reviewDueDate` based on date of issue + due period in years\n   - Created `/api/documents/due-for-review` endpoint to retrieve documents requiring review\n   - Endpoint includes overdue documents and calculates days until due for urgency sorting\n   - Built `ReviewReminders` component with three urgency levels:\n     - Overdue (red badge): Documents past their review due date\n     - Urgent (yellow badge): Documents due within 14 days\n     - Normal (blue badge): Documents due within specified period (default 60 days)\n   - Integrated review reminders into Creator dashboard for proactive document management\n   - Component displays document name, number, department, and formatted due date with visual urgency indicators\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework**: React 18+ with TypeScript using Vite as the build tool\n\n**UI Component System**: shadcn/ui components built on Radix UI primitives, implementing a Material Design-inspired system as specified in design guidelines. The component library emphasizes clarity, consistent information architecture, and professional aesthetics suitable for enterprise environments.\n\n**Design System**:\n- Typography: Inter font family for primary text, Roboto Mono for document numbers and control copy numbers\n- Spacing: Tailwind CSS utilities with primitives of 2, 4, 6, and 8\n- Layout: Responsive design with max-width containers (7xl for main content, 2xl for forms)\n- Color scheme: Neutral base with HSL color system supporting light/dark modes\n\n**State Management**: \n- React Query (TanStack Query) for server state management and data fetching\n- React Hook Form with Zod validation for form state\n- Local component state with useState hooks for UI interactions\n\n**Routing**: Wouter for lightweight client-side routing, handling navigation between login, creator dashboard, approver dashboard, issuer dashboard, and document creation pages\n\n**Key UI Patterns**:\n- Dashboard layouts with statistics cards, document tables, and activity feeds\n- Modal dialogs for document viewing, editing, approval/decline workflows\n- Status badges with color-coded visual indicators for document states\n- Workflow progress visualization showing document lifecycle stages\n- Notification system with toast messages and popup notifications\n\n### Backend Architecture\n\n**Runtime**: Node.js with Express.js framework\n\n**Language**: TypeScript with ES modules\n\n**API Design**: RESTful HTTP endpoints under `/api` namespace:\n- `GET /api/documents` - Retrieve documents by status or user (with query parameters)\n- `GET /api/documents/:id` - Retrieve single document with full details including related data\n- Additional CRUD operations for documents, users, departments, and notifications\n\n**Request Processing**:\n- JSON body parsing with raw buffer capture for webhook verification\n- URL-encoded form data support\n- Request/response logging middleware with duration tracking\n- Error handling with appropriate HTTP status codes\n\n**Business Logic Layer**: Storage abstraction layer (`IStorage` interface) implemented by `JsonStorage` class, providing clean separation between HTTP handlers and data operations\n\n### Data Storage\n\n**Storage Type**: JSON file-based storage (`data.json`)\n\n**Implementation**: Custom `JsonStorage` class with race condition protection through:\n- Ready promise pattern ensuring data loads before any operation\n- Write queue serializing all file writes to prevent concurrent overwrites\n- In-memory data cache with automatic persistence to disk\n\n**Data Collections**:\n\n1. **Users**: Stores user credentials, roles (creator/approver/issuer), and full names. Includes pre-seeded accounts:\n   - Creator: Priyanka.k@cybaemtech.com\n   - Approver: approver@cybaem.com  \n   - Issuer: issuer@cybaem.com\n\n2. **Documents**: Core entity tracking document metadata including:\n   - Document name, number (unique), and content\n   - Status workflow (pending → approved/declined → issued)\n   - Revision tracking with revision numbers and references to previous versions\n   - Multi-stage timestamps (created, updated, approved, issued)\n   - User references for preparer, approver, and issuer\n   - Header/footer information for document formatting (auto-extracted from Word files)\n   - Approval/decline remarks for audit trail\n   - Review management: duePeriodYears (years until review), reasonForRevision, and auto-calculated reviewDueDate\n\n3. **Departments**: Pre-seeded organizational units:\n   - Engineering (ENG), Quality Assurance (QA), Operations (OPS), Finance (FIN), Human Resources (HR)\n\n4. **Document-Departments**: Junction records enabling documents to be assigned to multiple departments\n\n5. **Notifications**: User notifications for document workflow events (pending, approved, declined, issued)\n\n**Key Design Decisions**:\n- String-based IDs with timestamps for uniqueness\n- Soft workflow states via status field rather than separate files\n- Version history maintained through `previousVersionId` self-reference\n- Timestamps for all significant workflow stages\n- Separate remarks fields for approval and decline paths\n- Atomic operations with serialized writes to prevent data loss\n\n### Authentication & Authorization\n\n**Current Implementation**: Simple role-based authentication with username/password stored in JSON file. Login page accepts role selection (Creator, Approver, Issuer, Recipient, Admin).\n\n**Session Management**: In-memory sessions (no persistent storage required)\n\n**Authorization Pattern**: Role-based access control where UI components and API endpoints filter data based on user role. Different dashboard views for each role type with appropriate document filtering.\n\n### External Dependencies\n\n**Third-Party Services**:\n- Google Fonts CDN: Inter and Roboto Mono font families\n\n**Key NPM Packages**:\n- `fs/promises`: Native Node.js file system operations for JSON persistence\n- `drizzle-orm` & `drizzle-kit`: TypeScript schema definitions (schemas defined but not actively used with JSON storage)\n- `@tanstack/react-query`: Server state management and caching\n- `react-hook-form` & `@hookform/resolvers`: Form handling with Zod schema validation\n- `zod` & `drizzle-zod`: Runtime type validation and schema generation\n- `date-fns`: Date manipulation and formatting utilities\n- Radix UI components: Unstyled, accessible component primitives for dialogs, dropdowns, popovers, etc.\n- `class-variance-authority` & `clsx` & `tailwind-merge`: Utility-first CSS class management\n- `cmdk`: Command palette component\n- `wouter`: Lightweight routing library\n\n**Development Tools**:\n- Vite: Fast build tool and dev server with HMR\n- TypeScript: Static type checking\n- Tailwind CSS: Utility-first CSS framework\n- PostCSS with Autoprefixer: CSS processing\n- esbuild: Server-side bundling for production\n\n**Replit-Specific Integrations**:\n- `@replit/vite-plugin-runtime-error-modal`: Development error overlay\n- `@replit/vite-plugin-cartographer`: Development tooling (conditional)\n- `@replit/vite-plugin-dev-banner`: Development banner (conditional)","path":null,"size_bytes":11280,"size_tokens":null},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { users, departments, documents, notifications } from \"@shared/schema\";\n\nasync function seed() {\n  console.log(\"Seeding database...\");\n\n  const creator = await db.insert(users).values({\n    username: \"creator@example.com\",\n    password: \"password123\",\n    fullName: \"John Smith\",\n    role: \"creator\"\n  }).returning();\n\n  const approver = await db.insert(users).values({\n    username: \"approver@example.com\",\n    password: \"password123\",\n    fullName: \"Sarah Johnson\",\n    role: \"approver\"\n  }).returning();\n\n  const issuer = await db.insert(users).values({\n    username: \"issuer@example.com\",\n    password: \"password123\",\n    fullName: \"Michael Roberts\",\n    role: \"issuer\"\n  }).returning();\n\n  const depts = await db.insert(departments).values([\n    { name: \"Quality Control\", code: \"QC\" },\n    { name: \"Production\", code: \"PROD\" },\n    { name: \"Safety\", code: \"SAFE\" },\n    { name: \"Engineering\", code: \"ENG\" },\n    { name: \"Operations\", code: \"OPS\" },\n    { name: \"Administration\", code: \"ADMIN\" }\n  ]).returning();\n\n  const doc1 = await db.insert(documents).values({\n    docName: \"Quality Control SOP\",\n    docNumber: \"QC-SOP-001\",\n    status: \"pending\",\n    revisionNo: 2,\n    preparedBy: creator[0].id,\n    content: \"This is the content of the Quality Control SOP document...\",\n    headerInfo: `Document No: QC-SOP-001\nRevision: 2\nDate: ${new Date().toLocaleDateString()}\nPrepared By: ${creator[0].fullName}\nDepartment: Quality Control\nCategory: Standard Operating Procedure`,\n    footerInfo: `Confidential - Internal Use Only\nPage 1 of 5\n© Company Name ${new Date().getFullYear()}`\n  }).returning();\n\n  const doc2 = await db.insert(documents).values({\n    docName: \"Safety Inspection Format\",\n    docNumber: \"SF-FMT-012\",\n    status: \"pending\",\n    revisionNo: 0,\n    preparedBy: creator[0].id,\n    content: \"This document outlines the safety inspection procedures...\",\n    headerInfo: `Document No: SF-FMT-012\nRevision: 0\nDate: ${new Date().toLocaleDateString()}\nPrepared By: ${creator[0].fullName}\nDepartment: Safety\nCategory: Format`,\n    footerInfo: `Confidential - Internal Use Only\nPage 1 of 3\n© Company Name ${new Date().getFullYear()}`\n  }).returning();\n\n  await db.insert(notifications).values({\n    userId: approver[0].id,\n    documentId: doc1[0].id,\n    message: `New document \"${doc1[0].docName}\" (${doc1[0].docNumber}) is ready for your approval`,\n    type: \"new_document\"\n  });\n\n  await db.insert(notifications).values({\n    userId: approver[0].id,\n    documentId: doc2[0].id,\n    message: `New document \"${doc2[0].docName}\" (${doc2[0].docNumber}) is ready for your approval`,\n    type: \"new_document\"\n  });\n\n  console.log(\"Database seeded successfully!\");\n  console.log(\"\\nTest Credentials:\");\n  console.log(\"Creator:\", creator[0].username, \"/ password123\");\n  console.log(\"Approver:\", approver[0].username, \"/ password123\");\n  console.log(\"Issuer:\", issuer[0].username, \"/ password123\");\n  \n  process.exit(0);\n}\n\nseed().catch(console.error);\n","path":null,"size_bytes":3001,"size_tokens":null},"client/src/components/NotificationPanel.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Bell, Check, FileText, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\n\ninterface Notification {\n  id: string;\n  message: string;\n  type: string;\n  isRead: boolean;\n  createdAt: string;\n  documentId: string;\n}\n\ninterface NotificationPanelProps {\n  userId: string;\n}\n\nexport default function NotificationPanel({ userId }: NotificationPanelProps) {\n  const queryClient = useQueryClient();\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\", userId],\n    queryFn: async () => {\n      const response = await fetch(`/api/notifications/${userId}`);\n      if (!response.ok) throw new Error(\"Failed to fetch notifications\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const response = await fetch(`/api/notifications/${notificationId}/read`, {\n        method: \"POST\",\n      });\n      if (!response.ok) throw new Error(\"Failed to mark notification as read\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\", userId] });\n    },\n  });\n\n  const unreadCount = notifications.filter(n => !n.isRead).length;\n\n  const handleMarkAsRead = (notificationId: string) => {\n    markAsReadMutation.mutate(notificationId);\n  };\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"new_document\":\n      case \"approved_document\":\n      case \"document_status_update\":\n      case \"document_declined\":\n        return <FileText className=\"w-4 h-4\" />;\n      default:\n        return <Bell className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getNotificationColor = (type: string) => {\n    switch (type) {\n      case \"approved_document\":\n        return \"text-green-600 bg-green-50 dark:bg-green-950/20\";\n      case \"document_declined\":\n        return \"text-red-600 bg-red-50 dark:bg-red-950/20\";\n      case \"new_document\":\n        return \"text-blue-600 bg-blue-50 dark:bg-blue-950/20\";\n      default:\n        return \"text-muted-foreground bg-muted/30\";\n    }\n  };\n\n  const formatTime = (dateString: string) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n    if (diffInSeconds < 60) return \"Just now\";\n    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;\n    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  return (\n    <Popover>\n      <PopoverTrigger asChild>\n        <Button \n          size=\"icon\" \n          variant=\"ghost\" \n          className=\"relative\" \n          data-testid=\"button-notifications\"\n        >\n          <Bell className=\"w-5 h-5\" />\n          {unreadCount > 0 && (\n            <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-destructive text-destructive-foreground rounded-full text-xs flex items-center justify-center font-medium\">\n              {unreadCount > 9 ? \"9+\" : unreadCount}\n            </span>\n          )}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-96 p-0\" \n        align=\"end\"\n        data-testid=\"notification-panel\"\n      >\n        <div className=\"flex items-center justify-between p-4 border-b\">\n          <div className=\"flex items-center gap-2\">\n            <Bell className=\"w-5 h-5\" />\n            <h3 className=\"font-semibold\">Notifications</h3>\n            {unreadCount > 0 && (\n              <span className=\"px-2 py-0.5 text-xs bg-primary text-primary-foreground rounded-full\">\n                {unreadCount}\n              </span>\n            )}\n          </div>\n        </div>\n\n        <ScrollArea className=\"h-[400px]\">\n          {notifications.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <Bell className=\"w-12 h-12 text-muted-foreground mb-3\" />\n              <p className=\"text-sm text-muted-foreground\">No notifications yet</p>\n            </div>\n          ) : (\n            <div className=\"divide-y\">\n              {notifications.map((notification) => (\n                <div\n                  key={notification.id}\n                  className={`p-4 hover:bg-muted/50 transition-colors ${\n                    !notification.isRead ? \"bg-muted/30\" : \"\"\n                  }`}\n                  data-testid={`notification-${notification.id}`}\n                >\n                  <div className=\"flex gap-3\">\n                    <div className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${getNotificationColor(notification.type)}`}>\n                      {getNotificationIcon(notification.type)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className={`text-sm ${!notification.isRead ? \"font-medium\" : \"\"}`}>\n                        {notification.message}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {formatTime(notification.createdAt)}\n                      </p>\n                    </div>\n                    {!notification.isRead && (\n                      <Button\n                        size=\"icon\"\n                        variant=\"ghost\"\n                        className=\"flex-shrink-0 h-8 w-8\"\n                        onClick={() => handleMarkAsRead(notification.id)}\n                        data-testid={`button-mark-read-${notification.id}`}\n                      >\n                        <Check className=\"w-4 h-4\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n      </PopoverContent>\n    </Popover>\n  );\n}\n","path":null,"size_bytes":6150,"size_tokens":null},"client/src/pages/CreatorDashboardWithAPI.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/DashboardLayout\";\nimport StatCard from \"@/components/StatCard\";\nimport DocumentTable, { Document } from \"@/components/DocumentTable\";\nimport ActivityFeed from \"@/components/ActivityFeed\";\nimport DocumentViewDialog from \"@/components/DocumentViewDialog\";\nimport DocumentEditDialog from \"@/components/DocumentEditDialog\";\nimport DeleteConfirmDialog from \"@/components/DeleteConfirmDialog\";\nimport ReviewReminders from \"@/components/ReviewReminders\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { FileText, Clock, CheckCircle, XCircle, Plus } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DocumentStatus } from \"@/components/StatusBadge\";\n\ninterface CreatorDashboardProps {\n  onCreateDocument?: () => void;\n  onLogout?: () => void;\n  userId?: string;\n  userName?: string;\n}\n\ninterface ApiDocument {\n  id: string;\n  docName: string;\n  docNumber: string;\n  status: string;\n  dateOfIssue: string;\n  revisionNo: number;\n  preparedBy: string;\n  preparerName?: string;\n  approverName?: string;\n  issuerName?: string;\n  departments?: Array<{ id: string; name: string }>;\n  content?: string;\n  headerInfo?: string;\n  footerInfo?: string;\n  approvalRemarks?: string;\n  declineRemarks?: string;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\ninterface Activity {\n  id: string;\n  type: \"created\" | \"approved\" | \"declined\" | \"issued\" | \"pending\";\n  docName: string;\n  userName: string;\n  timestamp: string;\n  remarks?: string;\n}\n\ninterface Notification {\n  id: string;\n  message: string;\n  type: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\nexport default function CreatorDashboardWithAPI({ \n  onCreateDocument, \n  onLogout,\n  userId = \"creator-1\",\n  userName = \"Creator User\"\n}: CreatorDashboardProps) {\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedDoc, setSelectedDoc] = useState<ApiDocument | null>(null);\n  const [viewDoc, setViewDoc] = useState<Document | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: myDocuments = [], isLoading } = useQuery<ApiDocument[]>({\n    queryKey: [\"/api/documents\", userId],\n    queryFn: async () => {\n      const response = await fetch(`/api/documents?userId=${userId}`);\n      if (!response.ok) throw new Error(\"Failed to fetch documents\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\", userId],\n    queryFn: async () => {\n      const response = await fetch(`/api/notifications/${userId}`);\n      if (!response.ok) throw new Error(\"Failed to fetch notifications\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (docId: string) => {\n      const response = await fetch(`/api/documents/${docId}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete document\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\", userId] });\n      toast({\n        title: \"Document Deleted\",\n        description: \"The document has been successfully deleted.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete document. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const pendingDocs = myDocuments.filter(doc => doc.status === \"pending\");\n  const approvedDocs = myDocuments.filter(doc => doc.status === \"approved\");\n  const declinedDocs = myDocuments.filter(doc => doc.status === \"declined\");\n  const issuedDocs = myDocuments.filter(doc => doc.status === \"issued\");\n  const unreadNotifications = notifications.filter(n => !n.isRead).length;\n\n  const handleView = (doc: Document) => {\n    setViewDoc(doc);\n    setViewDialogOpen(true);\n  };\n\n  const handleEdit = (doc: Document) => {\n    const fullDoc = myDocuments.find(d => d.id === doc.id);\n    if (fullDoc) {\n      setSelectedDoc(fullDoc);\n      setEditDialogOpen(true);\n    }\n  };\n\n  const handleDelete = (doc: Document) => {\n    const fullDoc = myDocuments.find(d => d.id === doc.id);\n    if (fullDoc) {\n      setSelectedDoc(fullDoc);\n      setDeleteDialogOpen(true);\n    }\n  };\n\n  const confirmDelete = () => {\n    if (selectedDoc) {\n      deleteMutation.mutate(selectedDoc.id);\n      setDeleteDialogOpen(false);\n      setSelectedDoc(null);\n    }\n  };\n\n  const handleSaveEdit = (docId: string, data: any) => {\n    console.log(\"Editing document:\", docId, data);\n    setEditDialogOpen(false);\n    setSelectedDoc(null);\n    toast({\n      title: \"Document Updated\",\n      description: \"Your changes have been saved successfully.\",\n    });\n  };\n\n  const handleDownload = (doc: Document) => {\n    toast({\n      title: \"Download Started\",\n      description: `Downloading ${doc.docName}...`,\n    });\n  };\n\n  const transformedDocs = (docs: ApiDocument[]): Document[] => {\n    return docs.map(doc => ({\n      id: doc.id,\n      docName: doc.docName,\n      docNumber: doc.docNumber,\n      status: (doc.status.charAt(0).toUpperCase() + doc.status.slice(1)) as DocumentStatus,\n      dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n      revisionNo: doc.revisionNo,\n      preparedBy: doc.preparerName || 'Unknown',\n    }));\n  };\n\n  const activities: Activity[] = myDocuments.slice(0, 5).map(doc => ({\n    id: doc.id,\n    type: doc.status === \"pending\" ? \"pending\" : \n          doc.status === \"approved\" ? \"approved\" : \n          doc.status === \"declined\" ? \"declined\" : \n          doc.status === \"issued\" ? \"issued\" : \"created\",\n    docName: doc.docName,\n    userName: doc.preparerName || userName,\n    timestamp: doc.createdAt ? new Date(doc.createdAt).toLocaleString() : \"Unknown\",\n    remarks: doc.approvalRemarks || doc.declineRemarks\n  }));\n\n  return (\n    <DashboardLayout\n      userRole=\"Document Creator\"\n      userName={userName}\n      userId={userId}\n      notificationCount={unreadNotifications}\n      onLogout={onLogout}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-semibold text-foreground\">My Documents</h2>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Create and manage your documents\n            </p>\n          </div>\n          <Button onClick={onCreateDocument} data-testid=\"button-create-document\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Create Document\n          </Button>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <StatCard\n            title=\"Total Documents\"\n            value={myDocuments.length}\n            icon={FileText}\n            trend=\"Created by you\"\n          />\n          <StatCard \n            title=\"Pending Review\" \n            value={pendingDocs.length} \n            icon={Clock} \n            trend=\"Awaiting approval\" \n          />\n          <StatCard \n            title=\"Approved\" \n            value={approvedDocs.length} \n            icon={CheckCircle} \n            trend=\"Ready for issue\" \n          />\n          <StatCard \n            title=\"Declined\" \n            value={declinedDocs.length} \n            icon={XCircle} \n            trend=\"Requires revision\" \n          />\n        </div>\n\n        <ReviewReminders daysAhead={60} />\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-2\">\n            <Tabs defaultValue=\"pending\" className=\"space-y-4\">\n              <TabsList>\n                <TabsTrigger value=\"pending\" data-testid=\"tab-pending\">\n                  Pending ({pendingDocs.length})\n                </TabsTrigger>\n                <TabsTrigger value=\"approved\" data-testid=\"tab-approved\">\n                  Approved ({approvedDocs.length})\n                </TabsTrigger>\n                <TabsTrigger value=\"declined\" data-testid=\"tab-declined\">\n                  Declined ({declinedDocs.length})\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"pending\">\n                {isLoading ? (\n                  <div className=\"border rounded-lg p-12 text-center\">\n                    <p className=\"text-sm text-muted-foreground\">Loading documents...</p>\n                  </div>\n                ) : pendingDocs.length > 0 ? (\n                  <DocumentTable\n                    documents={transformedDocs(pendingDocs)}\n                    onView={handleView}\n                    onEdit={handleEdit}\n                    onDelete={handleDelete}\n                    onDownload={handleDownload}\n                    canEdit={true}\n                    canDelete={true}\n                  />\n                ) : (\n                  <div className=\"border rounded-lg p-12 text-center\">\n                    <FileText className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <p className=\"text-sm text-muted-foreground\">No pending documents</p>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"approved\">\n                {approvedDocs.length > 0 ? (\n                  <DocumentTable\n                    documents={transformedDocs(approvedDocs)}\n                    onView={handleView}\n                    onDownload={handleDownload}\n                  />\n                ) : (\n                  <div className=\"border rounded-lg p-12 text-center\">\n                    <CheckCircle className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <p className=\"text-sm text-muted-foreground\">No approved documents</p>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"declined\">\n                {declinedDocs.length > 0 ? (\n                  <DocumentTable\n                    documents={transformedDocs(declinedDocs)}\n                    onView={handleView}\n                    onEdit={handleEdit}\n                    onDelete={handleDelete}\n                    onDownload={handleDownload}\n                    canEdit={true}\n                    canDelete={true}\n                  />\n                ) : (\n                  <div className=\"border rounded-lg p-12 text-center\">\n                    <XCircle className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                    <p className=\"text-sm text-muted-foreground\">No declined documents</p>\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </div>\n\n          <div>\n            <ActivityFeed activities={activities} maxItems={5} />\n          </div>\n        </div>\n      </div>\n\n      <DocumentViewDialog\n        document={viewDoc}\n        open={viewDialogOpen}\n        onClose={() => setViewDialogOpen(false)}\n        onDownload={handleDownload}\n      />\n\n      <DocumentEditDialog\n        document={selectedDoc ? {\n          id: selectedDoc.id,\n          docName: selectedDoc.docName,\n          docNumber: selectedDoc.docNumber,\n          status: (selectedDoc.status.charAt(0).toUpperCase() + selectedDoc.status.slice(1)) as DocumentStatus,\n          dateOfIssue: selectedDoc.dateOfIssue ? new Date(selectedDoc.dateOfIssue).toISOString().split('T')[0] : '',\n          revisionNo: selectedDoc.revisionNo,\n          preparedBy: selectedDoc.preparerName || 'Unknown',\n        } : null}\n        open={editDialogOpen}\n        onClose={() => setEditDialogOpen(false)}\n        onSave={handleSaveEdit}\n      />\n\n      <DeleteConfirmDialog\n        open={deleteDialogOpen}\n        onClose={() => setDeleteDialogOpen(false)}\n        onConfirm={confirmDelete}\n        title=\"Delete Document\"\n        description={`Are you sure you want to delete \"${selectedDoc?.docName}\"? This action cannot be undone.`}\n      />\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":12280,"size_tokens":null},"APPROVER_WORKFLOW_GUIDE.md":{"content":"# Approver Workflow - Complete UI Features\n\n## ✅ What the Approver Sees - All Fields Implemented!\n\n### 📋 When Approver Reviews a Document:\n\n```\n┌──────────────────────────────────────────────────────────────┐\n│  Document Approval Dialog                                     │\n├──────────────────────────────────────────────────────────────┤\n│                                                                │\n│  ✅ FIELD 1: Approved By                                      │\n│  ┌──────────────────────────────────────────────────────┐   │\n│  │ Enter your name (Required)                            │   │\n│  └──────────────────────────────────────────────────────┘   │\n│                                                                │\n│  ✅ FIELD 2: Remarks                                          │\n│  ┌──────────────────────────────────────────────────────┐   │\n│  │ Add approval remarks... (Required)                    │   │\n│  │                                                        │   │\n│  │                                                        │   │\n│  └──────────────────────────────────────────────────────┘   │\n│                                                                │\n│  ✅ FIELD 3: Share with Departments (Optional)                │\n│  ┌──────────────────────────────────────────────────────┐   │\n│  │ ☐ Engineering (ENG)        ☐ Finance (FIN)           │   │\n│  │ ☐ Quality Assurance (QA)   ☐ Human Resources (HR)    │   │\n│  │ ☐ Operations (OPS)                                    │   │\n│  └──────────────────────────────────────────────────────┘   │\n│                                                                │\n│  [Cancel]                                    [Approve] ✅      │\n│                                                                │\n└──────────────────────────────────────────────────────────────┘\n```\n\n### 📋 When Approver Declines a Document:\n\n```\n┌──────────────────────────────────────────────────────────────┐\n│  Decline Document                                              │\n├──────────────────────────────────────────────────────────────┤\n│                                                                │\n│  ✅ FIELD: Decline Remarks                                    │\n│  ┌──────────────────────────────────────────────────────┐   │\n│  │ Add reason for declining... (Required)                │   │\n│  │                                                        │   │\n│  │                                                        │   │\n│  └──────────────────────────────────────────────────────┘   │\n│                                                                │\n│  [Cancel]                                    [Decline] ❌      │\n│                                                                │\n└──────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## 🔄 Complete Workflow\n\n### Step 1: Approver Receives Notification\n- ✅ Notification appears on dashboard\n- ✅ Shows: \"New document [Name] ([Number]) is ready for your approval\"\n- ✅ Stored in `data.json` → `notifications` array\n\n### Step 2: Approver Views Document\n- ✅ Can view document with header information:\n  - Company Logo | Document Management System | Department\n- ✅ Can view document with footer information:\n  - Page number | Confidential | Revision number\n- ✅ Can download document (Word format)\n\n### Step 3: Approver Makes Decision\n\n#### Option A: APPROVE\n1. ✅ Click \"Approve\" button\n2. ✅ Dialog opens with 3 fields:\n   - **Approved By**: Enter approver name (e.g., \"John Approver\")\n   - **Remarks**: Enter approval remarks (e.g., \"Document meets all standards\")\n   - **Share with Departments**: Check departments (QA, Operations, etc.)\n3. ✅ Click \"Approve\" button in dialog\n4. ✅ **Saved to data.json**:\n   ```json\n   {\n     \"status\": \"approved\",\n     \"approvedBy\": \"approver-1\",\n     \"approvalRemarks\": \"Document meets all standards\",\n     \"approvedAt\": \"2025-11-05T04:15:24.696Z\"\n   }\n   ```\n5. ✅ **Departments saved to data.json**:\n   ```json\n   \"documentDepartments\": [\n     { \"documentId\": \"doc-123\", \"departmentId\": \"dept-2\" },\n     { \"documentId\": \"doc-123\", \"departmentId\": \"dept-3\" }\n   ]\n   ```\n6. ✅ **Notifications sent**:\n   - To Issuer (MR): \"Document approved by [Name]. Remarks: [Remarks]\"\n   - To Creator: \"Your document has been approved by [Name]\"\n\n#### Option B: DECLINE\n1. ✅ Click \"Decline\" button\n2. ✅ Dialog opens with 1 field:\n   - **Remarks**: Enter reason for declining\n3. ✅ Click \"Decline\" button in dialog\n4. ✅ **Saved to data.json**:\n   ```json\n   {\n     \"status\": \"declined\",\n     \"declineRemarks\": \"Missing section 5.2. Please add and resubmit.\"\n   }\n   ```\n5. ✅ **Notification sent to Creator**:\n   - \"Your document has been declined. Please review and resubmit.\"\n6. ✅ Document goes back to Creator for correction\n\n---\n\n## 📊 Data Storage in data.json\n\nAll approver actions are automatically saved to `data.json`:\n\n### Document Record (with approval data):\n```json\n{\n  \"id\": \"doc-1762316110317\",\n  \"docName\": \"Quality Control Procedure\",\n  \"status\": \"approved\",\n  \"preparedBy\": \"creator-1\",\n  \"approvedBy\": \"approver-1\",              ⭐ WHO APPROVED\n  \"approvalRemarks\": \"Document reviewed...\", ⭐ APPROVAL REMARKS\n  \"approvedAt\": \"2025-11-05T04:15:24.696Z\", ⭐ WHEN APPROVED\n  \"headerInfo\": \"Company Logo | DMS | QC\",\n  \"footerInfo\": \"Page 1 of 1 | Rev. 0\"\n}\n```\n\n### Notifications Created:\n```json\n[\n  {\n    \"userId\": \"issuer-1\",\n    \"message\": \"Document approved by John Approver. Remarks: '...'\",\n    \"type\": \"approved_document\"\n  },\n  {\n    \"userId\": \"creator-1\",\n    \"message\": \"Your document has been approved by John Approver\",\n    \"type\": \"document_status_update\"\n  }\n]\n```\n\n### Department Assignments:\n```json\n\"documentDepartments\": [\n  { \"documentId\": \"doc-123\", \"departmentId\": \"dept-2\" },\n  { \"documentId\": \"doc-123\", \"departmentId\": \"dept-3\" }\n]\n```\n\n---\n\n## 🎯 All Features Are Working!\n\n✅ **Approver Name Field** - Input box for approver to enter their name\n✅ **Approval Remarks Field** - Textarea for approval comments\n✅ **Decline Remarks Field** - Textarea for decline reasons\n✅ **Department Selection** - Checkboxes for selecting departments\n✅ **Notifications to Issuer** - Automatically sent when approved\n✅ **Notifications to Creator** - Sent for both approve and decline\n✅ **JSON Storage** - All data persisted to `data.json`\n✅ **Header/Footer Display** - Shown in document view\n✅ **Document Download** - Available in Word format\n\n---\n\n## 🚀 How to Test\n\n1. **Login as Creator**: `Priyanka.k@cybaemtech.com` / `123`\n   - Create a new document\n\n2. **Login as Approver**: `approver@cybaem.com` / `123`\n   - See notification on dashboard\n   - Click \"View\" to see document with header/footer\n   - Click \"Approve\" to see all 3 fields:\n     - Approved By\n     - Remarks\n     - Department checkboxes\n   - Fill in and submit\n\n3. **Check data.json**:\n   - See all approval data saved\n   - See department assignments\n   - See notifications created\n\nEverything is working and storing data in JSON!\n","path":null,"size_bytes":8908,"size_tokens":null},"client/src/components/PDFViewer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Printer, ZoomIn, ZoomOut, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport * as pdfjsLib from 'pdfjs-dist';\n\n// Configure PDF.js worker to use local file\n// This avoids the CDN loading issues and works offline\npdfjsLib.GlobalWorkerOptions.workerSrc = '/pdf.worker.min.js';\n\ninterface PDFViewerProps {\n  documentId: string;\n  userId: string;\n  open: boolean;\n  onClose: () => void;\n  documentName?: string;\n}\n\nexport default function PDFViewer({ documentId, userId, open, onClose, documentName }: PDFViewerProps) {\n  const [pdfDoc, setPdfDoc] = useState<any>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(0);\n  const [scale, setScale] = useState(1.2);\n  const [isLoading, setIsLoading] = useState(false);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const { toast } = useToast();\n\n  const printMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/documents/${documentId}/print`, { userId });\n      return response.blob();\n    },\n    onSuccess: (pdfBlob) => {\n      const url = URL.createObjectURL(pdfBlob);\n      const printWindow = window.open(url, '_blank');\n      if (printWindow) {\n        printWindow.addEventListener('load', () => {\n          printWindow.print();\n          URL.revokeObjectURL(url);\n        });\n      }\n      toast({\n        title: \"Print Initiated\",\n        description: \"PDF generated with control copy number. Print action logged.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Print Failed\",\n        description: error.message || \"Failed to generate print copy\",\n      });\n    }\n  });\n\n  useEffect(() => {\n    if (!open || !documentId || !userId) return;\n\n    const loadPDF = async () => {\n      setIsLoading(true);\n      try {\n        console.log(`Loading PDF for document ${documentId} and user ${userId}`);\n        \n        const response = await fetch(`/api/documents/${documentId}/pdf?userId=${userId}`);\n        \n        if (!response.ok) {\n          const errorText = await response.text();\n          console.error('PDF fetch error:', response.status, errorText);\n          throw new Error(`Failed to load PDF: ${response.status} - ${errorText}`);\n        }\n        \n        const contentType = response.headers.get('content-type');\n        if (!contentType || !contentType.includes('application/pdf')) {\n          console.error('Invalid content type:', contentType);\n          throw new Error('Invalid response format - expected PDF');\n        }\n        \n        const arrayBuffer = await response.arrayBuffer();\n        \n        if (arrayBuffer.byteLength === 0) {\n          throw new Error('Empty PDF response');\n        }\n        \n        console.log('PDF data loaded, size:', arrayBuffer.byteLength);\n        \n        // Enhanced PDF.js loading with better error handling\n        const loadingTask = pdfjsLib.getDocument({ \n          data: arrayBuffer,\n          // Disable worker if it fails to load\n          useWorkerFetch: false,\n          isEvalSupported: false,\n          useSystemFonts: true\n        });\n        \n        loadingTask.onProgress = (progress: any) => {\n          console.log(`PDF loading progress: ${progress.loaded}/${progress.total}`);\n        };\n        \n        const pdf = await loadingTask.promise;\n        \n        setPdfDoc(pdf);\n        setTotalPages(pdf.numPages);\n        setCurrentPage(1);\n        \n        console.log('PDF loaded successfully, pages:', pdf.numPages);\n        \n      } catch (error: any) {\n        console.error('PDF loading error:', error);\n        \n        // Check if it's a worker-related error\n        if (error.message && error.message.includes('worker')) {\n          console.warn('Worker error detected, trying without worker...');\n          try {\n            // Try to disable worker and reload\n            pdfjsLib.GlobalWorkerOptions.workerSrc = '';\n            const response = await fetch(`/api/documents/${documentId}/pdf?userId=${userId}`);\n            const arrayBuffer = await response.arrayBuffer();\n            const loadingTask = pdfjsLib.getDocument({ \n              data: arrayBuffer,\n              disableWorker: true\n            });\n            const pdf = await loadingTask.promise;\n            setPdfDoc(pdf);\n            setTotalPages(pdf.numPages);\n            setCurrentPage(1);\n            console.log('PDF loaded successfully without worker, pages:', pdf.numPages);\n            return;\n          } catch (fallbackError: any) {\n            console.error('Fallback PDF loading also failed:', fallbackError);\n          }\n        }\n        \n        toast({\n          variant: \"destructive\",\n          title: \"PDF Load Failed\",\n          description: error.message || \"Failed to load PDF document. Try refreshing the page.\",\n        });\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadPDF();\n  }, [open, documentId, userId, toast]);\n\n  useEffect(() => {\n    if (!pdfDoc || !canvasRef.current) return;\n\n    const renderPage = async () => {\n      const page = await pdfDoc.getPage(currentPage);\n      const viewport = page.getViewport({ scale });\n      \n      const canvas = canvasRef.current!;\n      const context = canvas.getContext('2d')!;\n      canvas.height = viewport.height;\n      canvas.width = viewport.width;\n\n      const renderContext = {\n        canvasContext: context,\n        viewport: viewport,\n      };\n\n      await page.render(renderContext).promise;\n    };\n\n    renderPage();\n  }, [pdfDoc, currentPage, scale]);\n\n  const handleZoomIn = () => setScale(prev => Math.min(prev + 0.2, 3));\n  const handleZoomOut = () => setScale(prev => Math.max(prev - 0.2, 0.5));\n  const handlePrevPage = () => setCurrentPage(prev => Math.max(prev - 1, 1));\n  const handleNextPage = () => setCurrentPage(prev => Math.min(prev + 1, totalPages));\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-5xl max-h-[95vh]\" data-testid=\"dialog-pdf-viewer\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center justify-between\">\n            <span>{documentName || \"Document Viewer\"}</span>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleZoomOut}\n                disabled={scale <= 0.5}\n                data-testid=\"button-zoom-out\"\n              >\n                <ZoomOut className=\"w-4 h-4\" />\n              </Button>\n              <span className=\"text-sm text-muted-foreground min-w-[60px] text-center\">\n                {Math.round(scale * 100)}%\n              </span>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleZoomIn}\n                disabled={scale >= 3}\n                data-testid=\"button-zoom-in\"\n              >\n                <ZoomIn className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center h-[60vh]\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n              <span className=\"ml-2 text-muted-foreground\">Loading PDF...</span>\n            </div>\n          ) : (\n            <div className=\"overflow-auto h-[60vh] bg-gray-100 dark:bg-gray-900 rounded-md p-4 flex justify-center\">\n              <canvas\n                ref={canvasRef}\n                className=\"shadow-lg bg-white\"\n                data-testid=\"canvas-pdf\"\n              />\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handlePrevPage}\n              disabled={currentPage <= 1 || isLoading}\n              data-testid=\"button-prev-page\"\n            >\n              <ChevronLeft className=\"w-4 h-4\" />\n              Prev\n            </Button>\n            <span className=\"text-sm text-muted-foreground min-w-[80px] text-center\">\n              Page {currentPage} of {totalPages}\n            </span>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleNextPage}\n              disabled={currentPage >= totalPages || isLoading}\n              data-testid=\"button-next-page\"\n            >\n              Next\n              <ChevronRight className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"default\"\n              onClick={() => printMutation.mutate()}\n              disabled={printMutation.isPending || isLoading}\n              data-testid=\"button-print-pdf\"\n            >\n              {printMutation.isPending ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  Generating...\n                </>\n              ) : (\n                <>\n                  <Printer className=\"w-4 h-4 mr-2\" />\n                  Print\n                </>\n              )}\n            </Button>\n            <Button variant=\"outline\" onClick={onClose} data-testid=\"button-close-pdf\">\n              Close\n            </Button>\n          </div>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9855,"size_tokens":null},"client/src/pages/ReportsPage.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Download, Search, FileSpreadsheet } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport * as XLSX from 'xlsx';\n\ninterface PrintLog {\n  id: string;\n  documentId: string;\n  userId: string;\n  controlCopyId: string;\n  printedAt: string;\n  documentName: string;\n  documentNumber: string;\n  userName: string;\n  userEmail: string;\n  controlCopyNumber: number;\n}\n\ninterface ControlCopy {\n  id: string;\n  documentId: string;\n  userId: string;\n  actionType: string;\n  copyNumber: number;\n  generatedAt: string;\n  documentName: string;\n  documentNumber: string;\n  userName: string;\n  userEmail: string;\n}\n\nexport default function ReportsPage() {\n  const [searchDocId, setSearchDocId] = useState(\"\");\n  const [searchUserId, setSearchUserId] = useState(\"\");\n  const [searchCCDocId, setSearchCCDocId] = useState(\"\");\n  const [searchCCUserId, setSearchCCUserId] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"printLogs\");\n  const { toast } = useToast();\n\n  const { data: printLogsByDoc, isLoading: loadingByDoc, refetch: refetchByDoc } = useQuery<PrintLog[]>({\n    queryKey: [\"/api/reports/print-logs\", searchDocId],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/print-logs?documentId=${searchDocId}`);\n      if (!response.ok) throw new Error('Failed to fetch print logs');\n      return response.json();\n    },\n    enabled: !!searchDocId && activeTab === \"printLogs\",\n  });\n\n  const { data: printLogsByUser, isLoading: loadingByUser, refetch: refetchByUser } = useQuery<PrintLog[]>({\n    queryKey: [`/api/reports/print-logs?userId=${searchUserId}`],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/print-logs?userId=${searchUserId}`);\n      if (!response.ok) throw new Error('Failed to fetch print logs');\n      return response.json();\n    },\n    enabled: !!searchUserId && activeTab === \"printLogs\",\n  });\n\n  const { data: issuedDocs, isLoading: loadingIssued } = useQuery<any[]>({\n    queryKey: [\"/api/documents\", { status: \"issued\" }],\n    queryFn: async () => {\n      const response = await fetch('/api/documents?status=issued');\n      if (!response.ok) throw new Error('Failed to fetch issued documents');\n      return response.json();\n    },\n    enabled: activeTab === \"issuedDocs\",\n  });\n\n  const { data: controlCopiesByDoc, isLoading: loadingCCByDoc, refetch: refetchCCByDoc } = useQuery<ControlCopy[]>({\n    queryKey: [\"/api/reports/control-copies\", searchCCDocId],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/control-copies?documentId=${searchCCDocId}`);\n      if (!response.ok) throw new Error('Failed to fetch control copies');\n      return response.json();\n    },\n    enabled: !!searchCCDocId && activeTab === \"controlCopies\",\n  });\n\n  const { data: controlCopiesByUser, isLoading: loadingCCByUser, refetch: refetchCCByUser } = useQuery<ControlCopy[]>({\n    queryKey: [`/api/reports/control-copies?userId=${searchCCUserId}`],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/control-copies?userId=${searchCCUserId}`);\n      if (!response.ok) throw new Error('Failed to fetch control copies');\n      return response.json();\n    },\n    enabled: !!searchCCUserId && activeTab === \"controlCopies\",\n  });\n\n  const exportToExcel = (data: any[], filename: string) => {\n    if (!data || data.length === 0) {\n      toast({\n        variant: \"destructive\",\n        title: \"No Data\",\n        description: \"No data available to export\",\n      });\n      return;\n    }\n\n    const worksheet = XLSX.utils.json_to_sheet(data);\n    const workbook = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(workbook, worksheet, \"Report\");\n    \n    const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });\n    const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n    const link = document.createElement('a');\n    const url = URL.createObjectURL(blob);\n    link.setAttribute('href', url);\n    link.setAttribute('download', `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);\n    link.style.visibility = 'hidden';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    toast({\n      title: \"Export Successful\",\n      description: `Data exported to ${filename}.xlsx`,\n    });\n  };\n\n  const renderPrintLogs = (logs: PrintLog[] | undefined, loading: boolean) => {\n    if (loading) {\n      return <div className=\"text-center py-8 text-muted-foreground\">Loading...</div>;\n    }\n\n    if (!logs || logs.length === 0) {\n      return <div className=\"text-center py-8 text-muted-foreground\">No print logs found</div>;\n    }\n\n    return (\n      <>\n        <div className=\"flex justify-end mb-4\">\n          <Button\n            onClick={() => exportToExcel(logs, 'print_logs')}\n            variant=\"outline\"\n            data-testid=\"button-export-print-logs\"\n          >\n            <Download className=\"w-4 h-4 mr-2\" />\n            Export to Excel\n          </Button>\n        </div>\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Document Number</TableHead>\n              <TableHead>Document Name</TableHead>\n              <TableHead>User Name</TableHead>\n              <TableHead>User Email</TableHead>\n              <TableHead>Control Copy No.</TableHead>\n              <TableHead>Printed At</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {logs.map((log) => (\n              <TableRow key={log.id} data-testid={`row-print-log-${log.id}`}>\n                <TableCell className=\"font-mono\">{log.documentNumber}</TableCell>\n                <TableCell>{log.documentName}</TableCell>\n                <TableCell>{log.userName}</TableCell>\n                <TableCell>{log.userEmail}</TableCell>\n                <TableCell className=\"font-mono\">{log.controlCopyNumber}</TableCell>\n                <TableCell>{new Date(log.printedAt).toLocaleString()}</TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </>\n    );\n  };\n\n  const renderControlCopies = (copies: ControlCopy[] | undefined, loading: boolean) => {\n    if (loading) {\n      return <div className=\"text-center py-8 text-muted-foreground\">Loading...</div>;\n    }\n\n    if (!copies || copies.length === 0) {\n      return <div className=\"text-center py-8 text-muted-foreground\">No control copies found</div>;\n    }\n\n    return (\n      <>\n        <div className=\"flex justify-end mb-4\">\n          <Button\n            onClick={() => exportToExcel(copies, 'control_copies')}\n            variant=\"outline\"\n            data-testid=\"button-export-control-copies\"\n          >\n            <Download className=\"w-4 h-4 mr-2\" />\n            Export to Excel\n          </Button>\n        </div>\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Document Number</TableHead>\n              <TableHead>Document Name</TableHead>\n              <TableHead>User Name</TableHead>\n              <TableHead>User Email</TableHead>\n              <TableHead>Control Copy No.</TableHead>\n              <TableHead>Action Type</TableHead>\n              <TableHead>Generated At</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {copies.map((cc) => (\n              <TableRow key={cc.id} data-testid={`row-control-copy-${cc.id}`}>\n                <TableCell className=\"font-mono\">{cc.documentNumber}</TableCell>\n                <TableCell>{cc.documentName}</TableCell>\n                <TableCell>{cc.userName}</TableCell>\n                <TableCell>{cc.userEmail}</TableCell>\n                <TableCell className=\"font-mono\">{cc.copyNumber}</TableCell>\n                <TableCell className=\"capitalize\">{cc.actionType}</TableCell>\n                <TableCell>{new Date(cc.generatedAt).toLocaleString()}</TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </>\n    );\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-7xl\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-3xl font-bold flex items-center gap-2\" data-testid=\"text-reports-title\">\n          <FileSpreadsheet className=\"w-8 h-8\" />\n          Reports & Analytics\n        </h1>\n        <p className=\"text-muted-foreground mt-2\">\n          View and export print logs and issued document reports\n        </p>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-3 max-w-2xl\">\n          <TabsTrigger value=\"printLogs\" data-testid=\"tab-print-logs\">\n            Print Logs\n          </TabsTrigger>\n          <TabsTrigger value=\"controlCopies\" data-testid=\"tab-control-copies\">\n            Control Copies\n          </TabsTrigger>\n          <TabsTrigger value=\"issuedDocs\" data-testid=\"tab-issued-docs\">\n            Issued Documents\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"printLogs\" className=\"space-y-4\">\n          <Card className=\"p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Search Print Logs</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"docId\">By Document ID</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"docId\"\n                    placeholder=\"Enter document ID\"\n                    value={searchDocId}\n                    onChange={(e) => setSearchDocId(e.target.value)}\n                    data-testid=\"input-search-doc-id\"\n                  />\n                  <Button onClick={() => refetchByDoc()} disabled={!searchDocId} data-testid=\"button-search-doc\">\n                    <Search className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"userId\">By User ID</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"userId\"\n                    placeholder=\"Enter user ID\"\n                    value={searchUserId}\n                    onChange={(e) => setSearchUserId(e.target.value)}\n                    data-testid=\"input-search-user-id\"\n                  />\n                  <Button onClick={() => refetchByUser()} disabled={!searchUserId} data-testid=\"button-search-user\">\n                    <Search className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          <Card className=\"p-6\">\n            {searchDocId && renderPrintLogs(printLogsByDoc, loadingByDoc)}\n            {searchUserId && renderPrintLogs(printLogsByUser, loadingByUser)}\n            {!searchDocId && !searchUserId && (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                Enter a document ID or user ID to view print logs\n              </div>\n            )}\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"controlCopies\" className=\"space-y-4\">\n          <Card className=\"p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Search Control Copies</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"ccDocId\">By Document ID</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"ccDocId\"\n                    placeholder=\"Enter document ID\"\n                    value={searchCCDocId}\n                    onChange={(e) => setSearchCCDocId(e.target.value)}\n                    data-testid=\"input-search-cc-doc-id\"\n                  />\n                  <Button onClick={() => refetchCCByDoc()} disabled={!searchCCDocId} data-testid=\"button-search-cc-doc\">\n                    <Search className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"ccUserId\">By User ID</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"ccUserId\"\n                    placeholder=\"Enter user ID\"\n                    value={searchCCUserId}\n                    onChange={(e) => setSearchCCUserId(e.target.value)}\n                    data-testid=\"input-search-cc-user-id\"\n                  />\n                  <Button onClick={() => refetchCCByUser()} disabled={!searchCCUserId} data-testid=\"button-search-cc-user\">\n                    <Search className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          <Card className=\"p-6\">\n            {searchCCDocId && renderControlCopies(controlCopiesByDoc, loadingCCByDoc)}\n            {searchCCUserId && renderControlCopies(controlCopiesByUser, loadingCCByUser)}\n            {!searchCCDocId && !searchCCUserId && (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                Enter a document ID or user ID to view control copies\n              </div>\n            )}\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"issuedDocs\" className=\"space-y-4\">\n          <Card className=\"p-6\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-xl font-semibold\">Issued Documents</h2>\n              {issuedDocs && issuedDocs.length > 0 && (\n                <Button\n                  onClick={() => exportToExcel(issuedDocs, 'issued_documents')}\n                  variant=\"outline\"\n                  data-testid=\"button-export-issued-docs\"\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Export to Excel\n                </Button>\n              )}\n            </div>\n\n            {loadingIssued ? (\n              <div className=\"text-center py-8 text-muted-foreground\">Loading...</div>\n            ) : !issuedDocs || issuedDocs.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">No issued documents found</div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Document Number</TableHead>\n                    <TableHead>Document Name</TableHead>\n                    <TableHead>Revision</TableHead>\n                    <TableHead>Issued By</TableHead>\n                    <TableHead>Issued At</TableHead>\n                    <TableHead>Departments</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {issuedDocs.map((doc: any) => (\n                    <TableRow key={doc.id} data-testid={`row-issued-doc-${doc.id}`}>\n                      <TableCell className=\"font-mono\">{doc.docNumber}</TableCell>\n                      <TableCell>{doc.docName}</TableCell>\n                      <TableCell>Rev {doc.revisionNo}</TableCell>\n                      <TableCell>{doc.issuerName || 'N/A'}</TableCell>\n                      <TableCell>{doc.issuedAt ? new Date(doc.issuedAt).toLocaleString() : 'N/A'}</TableCell>\n                      <TableCell>\n                        {doc.departments?.map((d: any) => d.name).join(', ') || 'N/A'}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":16009,"size_tokens":null},"server/services/pdf-service.ts":{"content":"import mammoth from \"mammoth\";\nimport puppeteer from \"puppeteer\";\nimport path from \"path\";\nimport fs from \"fs/promises\";\nimport { type Document } from \"@shared/schema\";\n\nexport interface ControlCopyInfo {\n  userId: string;\n  userFullName: string;\n  controlCopyNumber: number;\n  date: string;\n}\n\nexport class PDFService {\n  private uploadsDir = path.join(process.cwd(), \"uploads\");\n  private pdfsDir = path.join(process.cwd(), \"pdfs\");\n\n  constructor() {\n    // Directories will be initialized via initialize() method\n  }\n\n  async initialize(): Promise<void> {\n    await this.ensureDirectories();\n  }\n\n  private async ensureDirectories(): Promise<void> {\n    await fs.mkdir(this.uploadsDir, { recursive: true });\n    await fs.mkdir(this.pdfsDir, { recursive: true });\n  }\n\n  async convertWordToPDF(\n    wordFilePath: string,\n    document: Document,\n    controlCopyInfo?: ControlCopyInfo\n  ): Promise<string> {\n    // Try the main conversion method first, fallback if it fails\n    try {\n      console.log('Attempting PDF conversion with Puppeteer...');\n      return await this.convertWordToPDFWithPuppeteer(wordFilePath, document, controlCopyInfo);\n    } catch (puppeteerError: any) {\n      console.error('Puppeteer conversion failed, trying alternative method:', puppeteerError.message);\n      \n      // Use fallback method\n      try {\n        console.log('Using alternative PDF conversion method...');\n        return await this.convertWordToPDFAlternative(wordFilePath, document, controlCopyInfo);\n      } catch (fallbackError: any) {\n        console.error('Both PDF conversion methods failed:', fallbackError.message);\n        throw new Error(`PDF conversion failed: ${fallbackError.message}`);\n      }\n    }\n  }\n\n  private async convertWordToPDFWithPuppeteer(\n    wordFilePath: string,\n    document: Document,\n    controlCopyInfo?: ControlCopyInfo\n  ): Promise<string> {\n    let browser;\n    try {\n      // Validate input file exists\n      await fs.access(wordFilePath);\n      \n      console.log('Converting Word to PDF with Puppeteer for:', wordFilePath);\n      \n      const wordBuffer = await fs.readFile(wordFilePath);\n      const result = await mammoth.convertToHtml({ buffer: wordBuffer });\n      const htmlContent = result.value;\n\n      if (!htmlContent.trim()) {\n        throw new Error('Empty or invalid Word document content');\n      }\n\n      const fullHtml = this.buildFullHtml(document, htmlContent, controlCopyInfo);\n\n      console.log('Launching Puppeteer...');\n      \n      // Enhanced Puppeteer configuration for Windows\n      browser = await puppeteer.launch({\n        headless: true,\n        executablePath: process.env.PUPPETEER_EXECUTABLE_PATH,\n        args: [\n          '--no-sandbox',\n          '--disable-setuid-sandbox',\n          '--disable-dev-shm-usage',\n          '--disable-accelerated-2d-canvas',\n          '--disable-gpu',\n          '--no-first-run',\n          '--no-zygote',\n          '--single-process',\n          '--disable-background-timer-throttling',\n          '--disable-backgrounding-occluded-windows',\n          '--disable-renderer-backgrounding',\n          '--disable-features=VizDisplayCompositor',\n          '--disable-extensions',\n          '--disable-plugins',\n          '--disable-default-apps',\n          '--disable-software-rasterizer',\n          '--remote-debugging-port=0', // Use random port\n          '--disable-web-security',\n          '--allow-running-insecure-content'\n        ],\n        timeout: 60000, // 60 second timeout\n        protocolTimeout: 60000,\n        ignoreDefaultArgs: ['--disable-extensions'], // Don't disable extensions twice\n        handleSIGINT: false,\n        handleSIGTERM: false,\n        handleSIGHUP: false\n      });\n\n      console.log('Browser launched successfully');\n\n      try {\n        console.log('Creating new page...');\n        const page = await browser.newPage();\n        \n        // Set a reasonable timeout and viewport\n        page.setDefaultTimeout(45000);\n        page.setDefaultNavigationTimeout(45000);\n        \n        await page.setViewport({ width: 1200, height: 800 });\n        \n        console.log('Setting HTML content...');\n        await page.setContent(fullHtml, { \n          waitUntil: ['load', 'domcontentloaded'],\n          timeout: 45000\n        });\n\n        // Wait a bit for any dynamic content to load\n        await new Promise(resolve => setTimeout(resolve, 2000));\n\n        const pdfFileName = controlCopyInfo \n          ? `${document.docNumber}_v${document.revisionNo}_cc${controlCopyInfo.controlCopyNumber}.pdf`\n          : `${document.docNumber}_v${document.revisionNo}.pdf`;\n        \n        const pdfPath = path.join(this.pdfsDir, pdfFileName);\n\n        console.log('Generating PDF:', pdfPath);\n        \n        const pdfBuffer = await page.pdf({\n          format: 'A4',\n          printBackground: true,\n          margin: {\n            top: '80px',\n            bottom: '100px',\n            left: '40px',\n            right: '40px'\n          },\n          timeout: 45000,\n          preferCSSPageSize: true\n        });\n\n        // Write the PDF buffer to file\n        await fs.writeFile(pdfPath, pdfBuffer);\n\n        // Verify the PDF was created and has content\n        const stats = await fs.stat(pdfPath);\n        if (stats.size === 0) {\n          throw new Error('Generated PDF file is empty');\n        }\n\n        console.log('PDF generated successfully:', pdfPath, 'Size:', stats.size);\n        return pdfPath;\n        \n      } catch (pageError) {\n        console.error('Page operation failed:', pageError);\n        throw pageError;\n      }\n    } catch (error: any) {\n      console.error('Error in convertWordToPDFWithPuppeteer:', error);\n      // Re-throw the original error to allow fallback handling\n      throw error;\n    } finally {\n      if (browser) {\n        try {\n          await browser.close();\n          console.log('Browser closed successfully');\n        } catch (closeError) {\n          console.warn('Error closing browser:', closeError);\n        }\n      }\n    }\n  }\n\n  private async convertWordToPDFAlternative(\n    wordFilePath: string,\n    document: Document,\n    controlCopyInfo?: ControlCopyInfo\n  ): Promise<string> {\n    console.log('Using alternative PDF conversion method');\n    \n    try {\n      // Read the Word document and try to get both HTML and text\n      const wordBuffer = await fs.readFile(wordFilePath);\n      \n      // Try to get HTML content first\n      let content = '';\n      try {\n        const htmlResult = await mammoth.convertToHtml({ buffer: wordBuffer });\n        content = htmlResult.value;\n        \n        // If HTML is empty or just whitespace, try extracting raw text\n        if (!content || content.trim().length === 0 || content.trim() === '<p></p>') {\n          const textResult = await mammoth.extractRawText({ buffer: wordBuffer });\n          content = textResult.value;\n        }\n      } catch (htmlError) {\n        console.warn('HTML extraction failed, trying text extraction:', htmlError);\n        const textResult = await mammoth.extractRawText({ buffer: wordBuffer });\n        content = textResult.value;\n      }\n\n      // If still no content, use document metadata\n      if (!content || content.trim().length === 0) {\n        content = `Document: ${document.docName}\\n\\nThis document appears to be empty or the content could not be extracted.\\n\\nDocument Details:\\n- Document Number: ${document.docNumber}\\n- Revision: ${document.revisionNo}\\n- Status: ${document.status}\\n- Created: ${new Date(document.createdAt || new Date()).toLocaleDateString()}`;\n      }\n\n      const pdfFileName = controlCopyInfo \n        ? `${document.docNumber}_v${document.revisionNo}_cc${controlCopyInfo.controlCopyNumber}.pdf`\n        : `${document.docNumber}_v${document.revisionNo}.pdf`;\n      \n      const pdfPath = path.join(this.pdfsDir, pdfFileName);\n\n      // Create a PDF using pdf-lib\n      const { PDFDocument, StandardFonts, rgb } = await import('pdf-lib');\n      \n      const pdfDoc = await PDFDocument.create();\n      let page = pdfDoc.addPage([595.28, 841.89]); // A4 size\n      const { width, height } = page.getSize();\n      \n      const font = await pdfDoc.embedFont(StandardFonts.Helvetica);\n      const boldFont = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\n      const fontSize = 12;\n      const titleFontSize = 16;\n      const margin = 50;\n      const lineHeight = fontSize * 1.5;\n      \n      let yPosition = height - margin;\n      \n      // Add header\n      page.drawText(document.docName || 'Document', {\n        x: margin,\n        y: yPosition,\n        size: titleFontSize,\n        font: boldFont,\n        color: rgb(0, 0, 0.8),\n      });\n      yPosition -= 30;\n      \n      page.drawText(`Doc No: ${document.docNumber} | Rev: ${document.revisionNo} | Date: ${new Date(document.dateOfIssue || new Date()).toLocaleDateString()}`, {\n        x: margin,\n        y: yPosition,\n        size: 10,\n        font,\n        color: rgb(0.5, 0.5, 0.5),\n      });\n      yPosition -= 40;\n      \n      // Process content - Clean up unicode characters that can't be encoded\n      const textContent = String(content);\n      // Remove or replace problematic unicode characters\n      const cleanedContent = textContent\n        .replace(/[^\\x00-\\x7F]/g, '') // Remove non-ASCII characters\n        .replace(/→/g, '->')  // Replace arrow with ASCII equivalent\n        .replace(/—/g, '--')  // Replace em dash\n        .replace(/'/g, \"'\")   // Replace curly quotes\n        .replace(/\"/g, '\"')   // Replace curly quotes\n        .replace(/…/g, '...') // Replace ellipsis\n        .trim();\n      \n      const lines = cleanedContent.split('\\n'); // Remove HTML tags if any\n      \n      for (const line of lines) {\n        if (yPosition < margin + 50) {\n          // Add new page\n          page = pdfDoc.addPage([595.28, 841.89]);\n          yPosition = height - margin;\n        }\n        \n        if (line.trim() === '') {\n          yPosition -= lineHeight / 2; // Smaller gap for empty lines\n          continue;\n        }\n        \n        // Clean the line of any problematic characters\n        const cleanLine = line\n          .replace(/<[^>]*>/g, '') // Remove HTML tags\n          .replace(/[^\\x00-\\x7F]/g, '') // Remove non-ASCII characters\n          .trim();\n        \n        if (!cleanLine) {\n          yPosition -= lineHeight / 2;\n          continue;\n        }\n        \n        // Wrap long lines\n        const maxWidth = width - 2 * margin;\n        const words = cleanLine.split(' ');\n        let currentLine = '';\n        \n        for (const word of words) {\n          const cleanWord = word.replace(/[^\\x00-\\x7F]/g, ''); // Clean each word\n          const testLine = currentLine + (currentLine ? ' ' : '') + cleanWord;\n          \n          let textWidth = 0;\n          try {\n            textWidth = font.widthOfTextAtSize(testLine, fontSize);\n          } catch (encodingError: any) {\n            console.warn('Encoding error for text:', testLine, encodingError?.message || 'Unknown encoding error');\n            // Skip this word if it can't be encoded\n            continue;\n          }\n          \n          if (textWidth > maxWidth && currentLine) {\n            // Draw current line\n            try {\n              page.drawText(currentLine, {\n                x: margin,\n                y: yPosition,\n                size: fontSize,\n                font,\n                color: rgb(0, 0, 0),\n              });\n            } catch (drawError: any) {\n              console.warn('Error drawing text:', currentLine, drawError?.message || 'Unknown draw error');\n            }\n            yPosition -= lineHeight;\n            currentLine = cleanWord;\n            \n            // Check if we need a new page\n            if (yPosition < margin + 50) {\n              page = pdfDoc.addPage([595.28, 841.89]);\n              yPosition = height - margin;\n            }\n          } else {\n            currentLine = testLine;\n          }\n        }\n        \n        // Draw remaining text\n        if (currentLine && yPosition >= margin + 50) {\n          try {\n            page.drawText(currentLine, {\n              x: margin,\n              y: yPosition,\n              size: fontSize,\n              font,\n              color: rgb(0, 0, 0),\n            });\n          } catch (drawError: any) {\n            console.warn('Error drawing remaining text:', currentLine, drawError?.message || 'Unknown draw error');\n          }\n          yPosition -= lineHeight;\n        }\n      }\n      \n      // Add control copy info if provided\n      if (controlCopyInfo) {\n        // Ensure we have space for the control copy info\n        if (yPosition < margin + 30) {\n          page = pdfDoc.addPage([595.28, 841.89]);\n          yPosition = height - margin;\n        }\n        \n        yPosition = margin + 20; // Position near bottom\n        page.drawRectangle({\n          x: margin - 5,\n          y: yPosition - 15,\n          width: width - 2 * margin + 10,\n          height: 25,\n          borderColor: rgb(1, 0.8, 0),\n          borderWidth: 2,\n          color: rgb(1, 0.95, 0.8),\n        });\n        \n        page.drawText(`CONTROLLED COPY - User: ${controlCopyInfo.userId} | Copy: ${controlCopyInfo.controlCopyNumber} | Date: ${controlCopyInfo.date}`, {\n          x: margin,\n          y: yPosition,\n          size: 8,\n          font: boldFont,\n          color: rgb(0.8, 0, 0),\n        });\n      }\n      \n      const pdfBytes = await pdfDoc.save();\n      await fs.writeFile(pdfPath, pdfBytes);\n      \n      console.log('Alternative PDF generated successfully:', pdfPath, 'Size:', pdfBytes.length);\n      return pdfPath;\n      \n    } catch (error: any) {\n      console.error('Error in alternative PDF conversion:', error);\n      throw new Error(`Alternative PDF conversion failed: ${error.message}`);\n    }\n  }\n\n  private buildFullHtml(\n    document: Document,\n    bodyContent: string,\n    controlCopyInfo?: ControlCopyInfo\n  ): string {\n    const headerHtml = this.buildHeader(document);\n    const footerHtml = this.buildFooter(document, controlCopyInfo);\n\n    return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    @page {\n      margin: 0;\n      size: A4;\n    }\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      margin: 0;\n      padding: 0;\n      font-family: Arial, sans-serif;\n      font-size: 12pt;\n      line-height: 1.6;\n      background: white;\n      color: black;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    .page {\n      min-height: 100vh;\n      padding: 100px 40px 120px 40px;\n      position: relative;\n    }\n    .header {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      height: 80px;\n      background: #f8f9fa;\n      border-bottom: 2px solid #007bff;\n      padding: 10px 40px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      z-index: 1000;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    .footer {\n      position: fixed;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      height: 100px;\n      background: #f8f9fa;\n      border-top: 2px solid #007bff;\n      padding: 10px 40px;\n      font-size: 10pt;\n      z-index: 1000;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    .content {\n      position: relative;\n      z-index: 1;\n      background: white;\n      min-height: 500px;\n      padding: 20px 0;\n    }\n    .content p {\n      margin-bottom: 10px;\n    }\n    .content h1, .content h2, .content h3 {\n      margin-bottom: 15px;\n      margin-top: 20px;\n    }\n    .control-copy-watermark {\n      background: #fff3cd;\n      border: 2px dashed #ffc107;\n      padding: 8px;\n      margin-top: 5px;\n      font-weight: bold;\n      color: #856404;\n      text-align: center;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    .header-info, .footer-info {\n      font-size: 10pt;\n      color: #333;\n    }\n    .doc-title {\n      font-size: 14pt;\n      font-weight: bold;\n      color: #007bff;\n    }\n    /* Ensure content is visible */\n    .content * {\n      color: black !important;\n      background: transparent !important;\n    }\n    /* Handle tables and lists */\n    .content table {\n      width: 100%;\n      border-collapse: collapse;\n      margin: 15px 0;\n    }\n    .content table td, .content table th {\n      border: 1px solid #ccc;\n      padding: 8px;\n      text-align: left;\n    }\n    .content ul, .content ol {\n      margin: 10px 0;\n      padding-left: 30px;\n    }\n    .content li {\n      margin-bottom: 5px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"page\">\n    <div class=\"header\">\n      ${headerHtml}\n    </div>\n    \n    <div class=\"content\">\n      ${bodyContent || '<p>No content available in this document.</p>'}\n    </div>\n    \n    <div class=\"footer\">\n      ${footerHtml}\n    </div>\n  </div>\n</body>\n</html>\n    `;\n  }\n\n  private buildHeader(document: Document): string {\n    return `\n      <div>\n        <div class=\"doc-title\">${document.docName}</div>\n        <div class=\"header-info\">\n          <strong>Doc No:</strong> ${document.docNumber} | \n          <strong>Rev:</strong> ${document.revisionNo} | \n          <strong>Date:</strong> ${new Date(document.dateOfIssue || new Date()).toLocaleDateString()}\n        </div>\n        ${document.headerInfo ? `<div class=\"header-info\">${this.escapeHtml(document.headerInfo)}</div>` : ''}\n      </div>\n    `;\n  }\n\n  private buildFooter(document: Document, controlCopyInfo?: ControlCopyInfo): string {\n    let footerContent = `\n      <div class=\"footer-info\">\n        ${document.footerInfo ? `<div>${this.escapeHtml(document.footerInfo)}</div>` : ''}\n      </div>\n    `;\n\n    if (controlCopyInfo) {\n      footerContent += `\n        <div class=\"control-copy-watermark\">\n          CONTROLLED COPY - NOT FOR DISTRIBUTION<br/>\n          User ID: ${controlCopyInfo.userId} | \n          Control Copy No: ${controlCopyInfo.controlCopyNumber} | \n          Date: ${controlCopyInfo.date}\n        </div>\n      `;\n    }\n\n    return footerContent;\n  }\n\n  private escapeHtml(text: string): string {\n    const map: { [key: string]: string } = {\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#039;'\n    };\n    return text.replace(/[&<>\"']/g, m => map[m]);\n  }\n\n  async saveUploadedFile(fileBuffer: Buffer, originalName: string, documentId: string): Promise<string> {\n    await this.ensureDirectories();\n    const fileName = `${documentId}_${Date.now()}_${originalName}`;\n    const filePath = path.join(this.uploadsDir, fileName);\n    await fs.writeFile(filePath, fileBuffer);\n    return filePath;\n  }\n\n  async getDocumentVersions(docNumber: string): Promise<string[]> {\n    const files = await fs.readdir(this.pdfsDir);\n    return files.filter(f => f.startsWith(docNumber));\n  }\n\n  async extractHeaderFooterFromWord(fileBuffer: Buffer): Promise<{ headerInfo: string, footerInfo: string }> {\n    try {\n      const result = await mammoth.convertToHtml({ buffer: fileBuffer });\n      const htmlContent = result.value;\n      \n      const lines = htmlContent.split('</p>').map(line => {\n        const text = line.replace(/<[^>]*>/g, '').trim();\n        return text;\n      }).filter(line => line.length > 0);\n      \n      let headerInfo = '';\n      let footerInfo = '';\n      \n      if (lines.length > 0) {\n        headerInfo = lines.slice(0, Math.min(2, lines.length)).join(' ');\n      }\n      \n      if (lines.length > 2) {\n        footerInfo = lines.slice(-2).join(' ');\n      } else {\n        footerInfo = 'Standard Footer';\n      }\n      \n      return {\n        headerInfo: headerInfo || 'Document Header',\n        footerInfo: footerInfo || 'Document Footer'\n      };\n    } catch (error) {\n      console.error('Error extracting header/footer:', error);\n      return {\n        headerInfo: 'Document Header',\n        footerInfo: 'Document Footer'\n      };\n    }\n  }\n}\n\nexport const pdfService = new PDFService();\n","path":null,"size_bytes":19928,"size_tokens":null},"client/src/pages/AdminDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport DashboardLayout from \"@/components/DashboardLayout\";\nimport DocumentTable, { Document } from \"@/components/DocumentTable\";\nimport DocumentViewDialog from \"@/components/DocumentViewDialog\";\nimport { Card } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { \n  FileText, \n  Users, \n  Building2, \n  CheckCircle, \n  Clock, \n  XCircle, \n  Send, \n  Download,\n  TrendingUp,\n  UserCheck,\n  UserCog,\n  Shield,\n  BarChart3,\n  Activity,\n  Calendar,\n  ArrowUpRight,\n  ArrowDownRight,\n  Plus,\n  UserPlus,\n  Loader2,\n  Trash2,\n  Edit,\n  ChevronDown,\n  ChevronRight,\n  Eye\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell\n} from \"recharts\";\n\n// Import department data\nimport departmentData from \"../../../shared/departmentData.json\";\n\ninterface AdminDashboardProps {\n  onLogout?: () => void;\n  userId?: string;\n}\n\ninterface ApiDocument {\n  id: string;\n  docName: string;\n  docNumber: string;\n  status: string;\n  dateOfIssue: string;\n  revisionNo: number;\n  preparedBy: string;\n  preparerName?: string;\n  approvedBy?: string;\n  approverName?: string;\n  issuedBy?: string;\n  issuerName?: string;\n  approvedAt?: string;\n  issuedAt?: string;\n  approvalRemarks?: string;\n  declineRemarks?: string;\n  issueRemarks?: string;\n  previousVersionId?: string;\n  createdAt?: string;\n  departments?: Array<{ id: string; name: string }>;\n}\n\ninterface AdminStats {\n  documents: {\n    total: number;\n    pending: number;\n    approved: number;\n    issued: number;\n    declined: number;\n    recentCount: number;\n  };\n  users: {\n    creators: number;\n    approvers: number;\n    issuers: number;\n    total: number;\n  };\n  departments: {\n    total: number;\n    list: Array<{ id: string; name: string; code: string }>;\n  };\n  weeklyActivity: Array<{ day: string; documents: number }>;\n  recentDocuments: Array<{\n    id: string;\n    docName: string;\n    docNumber: string;\n    status: string;\n    createdAt?: string;\n  }>;\n}\n\ninterface AdminUsers {\n  creators: Array<{ id: string; username: string; fullName: string; role: string }>;\n  approvers: Array<{ id: string; username: string; fullName: string; role: string }>;\n  issuers: Array<{ id: string; username: string; fullName: string; role: string }>;\n  admins: Array<{ id: string; username: string; fullName: string; role: string }>;\n  recipients: Array<{ id: string; username: string; fullName: string; role: string }>;\n  total: number;\n}\n\ninterface DynamicDepartment {\n  id: string;\n  name: string;\n  code: string;\n  createdAt: string;\n}\n\ninterface AdminDocuments {\n  documents: ApiDocument[];\n  stats: {\n    total: number;\n    pending: number;\n    approved: number;\n    issued: number;\n    declined: number;\n  };\n}\n\nconst userFormSchema = z.object({\n  username: z.string().min(1, \"Email is required\").email(\"Please enter a valid email\"),\n  password: z.string().min(3, \"Password must be at least 3 characters\"),\n  fullName: z.string().min(1, \"Full name is required\"),\n  role: z.enum([\"creator\", \"approver\", \"issuer\", \"admin\", \"recipient\"]),\n  masterCopyAccess: z.boolean().default(false),\n});\n\nconst departmentFormSchema = z.object({\n  name: z.string().min(1, \"Department name is required\"),\n  code: z.string().min(1, \"Department code is required\").max(10, \"Code must be 10 characters or less\"),\n});\n\ntype UserFormValues = z.infer<typeof userFormSchema>;\ntype DepartmentFormValues = z.infer<typeof departmentFormSchema>;\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: {\n      staggerChildren: 0.1\n    }\n  }\n};\n\nconst itemVariants = {\n  hidden: { y: 20, opacity: 0 },\n  visible: {\n    y: 0,\n    opacity: 1,\n    transition: {\n      type: \"spring\",\n      stiffness: 100\n    }\n  }\n};\n\nconst cardVariants = {\n  hidden: { scale: 0.9, opacity: 0 },\n  visible: {\n    scale: 1,\n    opacity: 1,\n    transition: {\n      type: \"spring\",\n      stiffness: 200,\n      damping: 20\n    }\n  },\n  hover: {\n    scale: 1.02,\n    transition: { duration: 0.2 }\n  }\n};\n\nconst COLORS = ['hsl(var(--primary))', 'hsl(var(--chart-2))', 'hsl(var(--chart-3))', 'hsl(var(--destructive))'];\n\nfunction StatCardAnimated({ \n  title, \n  value, \n  icon: Icon, \n  trend, \n  trendUp,\n  color,\n  delay = 0 \n}: { \n  title: string; \n  value: number; \n  icon: React.ElementType; \n  trend?: string;\n  trendUp?: boolean;\n  color: string;\n  delay?: number;\n}) {\n  return (\n    <motion.div\n      variants={cardVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n      whileHover=\"hover\"\n      transition={{ delay }}\n    >\n      <Card className=\"p-6 relative overflow-visible\" data-testid={`card-stat-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium text-muted-foreground\">{title}</p>\n            <motion.p \n              className=\"text-3xl font-bold text-foreground\"\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: delay + 0.2 }}\n              data-testid={`text-value-${title.toLowerCase().replace(/\\s+/g, '-')}`}\n            >\n              {value}\n            </motion.p>\n            {trend && (\n              <div className=\"flex items-center gap-1 text-xs\">\n                {trendUp !== undefined && (\n                  trendUp ? (\n                    <ArrowUpRight className=\"w-3 h-3 text-green-500\" />\n                  ) : (\n                    <ArrowDownRight className=\"w-3 h-3 text-red-500\" />\n                  )\n                )}\n                <span className={trendUp ? \"text-green-600 dark:text-green-400\" : trendUp === false ? \"text-red-600 dark:text-red-400\" : \"text-muted-foreground\"}>\n                  {trend}\n                </span>\n              </div>\n            )}\n          </div>\n          <motion.div \n            className={`p-3 rounded-xl ${color}`}\n            whileHover={{ rotate: 5, scale: 1.1 }}\n            transition={{ type: \"spring\", stiffness: 300 }}\n          >\n            <Icon className=\"w-6 h-6 text-white\" />\n          </motion.div>\n        </div>\n        <motion.div \n          className={`absolute bottom-0 left-0 h-1 ${color}`}\n          initial={{ width: 0 }}\n          animate={{ width: \"100%\" }}\n          transition={{ delay: delay + 0.3, duration: 0.5 }}\n          style={{ borderRadius: \"0 0 0 var(--radius)\" }}\n        />\n      </Card>\n    </motion.div>\n  );\n}\n\nfunction DetailedDocumentCard({ doc, onView }: { doc: ApiDocument; onView: (doc: Document) => void }) {\n  const getStatusColor = (status: string) => {\n    switch (status.toLowerCase()) {\n      case 'pending': return 'bg-amber-500/10 text-amber-600';\n      case 'approved': return 'bg-blue-500/10 text-blue-600';\n      case 'issued': return 'bg-green-500/10 text-green-600';\n      case 'declined': return 'bg-red-500/10 text-red-600';\n      default: return 'bg-gray-500/10 text-gray-600';\n    }\n  };\n\n  const getCurrentStage = () => {\n    switch (doc.status.toLowerCase()) {\n      case 'pending':\n        return doc.approvedBy ? 'Awaiting Issue (Issuer)' : 'Awaiting Approval (Approver)';\n      case 'approved':\n        return 'Awaiting Issue (Issuer)';\n      case 'issued':\n        return 'Document Issued';\n      case 'declined':\n        return 'Document Declined';\n      default:\n        return 'Unknown Stage';\n    }\n  };\n\n  const getActionUser = () => {\n    if (doc.status.toLowerCase() === 'declined') {\n      return doc.approverName || 'Unknown User';\n    }\n    if (doc.status.toLowerCase() === 'issued') {\n      return doc.issuerName || 'Unknown User';\n    }\n    if (doc.status.toLowerCase() === 'approved') {\n      return doc.approverName || 'Unknown User';\n    }\n    return null;\n  };\n\n  const getRemarks = () => {\n    if (doc.status.toLowerCase() === 'declined') {\n      return doc.declineRemarks;\n    }\n    if (doc.status.toLowerCase() === 'issued') {\n      return doc.issueRemarks;\n    }\n    if (doc.status.toLowerCase() === 'approved') {\n      return doc.approvalRemarks;\n    }\n    return null;\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"p-4 rounded-lg border bg-card hover-elevate\"\n    >\n      <div className=\"flex items-start justify-between mb-3\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <FileText className=\"w-4 h-4 text-muted-foreground\" />\n            <h4 className=\"font-medium text-sm\">{doc.docName}</h4>\n            <Badge variant=\"outline\" className={getStatusColor(doc.status)}>\n              {doc.status.charAt(0).toUpperCase() + doc.status.slice(1)}\n            </Badge>\n          </div>\n          <p className=\"text-xs text-muted-foreground font-mono mb-1\">{doc.docNumber}</p>\n          <p className=\"text-xs text-muted-foreground\">Rev {doc.revisionNo} • Prepared by {doc.preparerName}</p>\n        </div>\n        <Button\n          size=\"sm\"\n          variant=\"ghost\"\n          onClick={() => onView({\n            id: doc.id,\n            docName: doc.docName,\n            docNumber: doc.docNumber,\n            status: doc.status.charAt(0).toUpperCase() + doc.status.slice(1) as \"Pending\" | \"Approved\" | \"Declined\" | \"Issued\",\n            dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n            revisionNo: doc.revisionNo,\n            preparedBy: doc.preparerName || 'Unknown'\n          })}\n        >\n          <Eye className=\"w-4 h-4\" />\n        </Button>\n      </div>\n      \n      <div className=\"space-y-2\">\n        <div className=\"flex items-center gap-2 text-xs\">\n          <Activity className=\"w-3 h-3 text-blue-500\" />\n          <span className=\"font-medium\">Current Stage:</span>\n          <span className=\"text-muted-foreground\">{getCurrentStage()}</span>\n        </div>\n        \n        {getActionUser() && (\n          <div className=\"flex items-center gap-2 text-xs\">\n            <Users className=\"w-3 h-3 text-green-500\" />\n            <span className=\"font-medium\">Action By:</span>\n            <span className=\"text-muted-foreground\">{getActionUser()}</span>\n            {doc.status.toLowerCase() === 'declined' && (\n              <Badge variant=\"destructive\" className=\"text-xs px-1 py-0\">Declined</Badge>\n            )}\n          </div>\n        )}\n        \n        {getRemarks() && (\n          <div className=\"mt-2 p-2 rounded bg-muted/30\">\n            <p className=\"text-xs font-medium text-foreground mb-1\">Review Comments:</p>\n            <p className=\"text-xs text-muted-foreground italic\">\"{getRemarks()}\"</p>\n          </div>\n        )}\n        \n        {doc.departments && doc.departments.length > 0 && (\n          <div className=\"flex items-center gap-1 flex-wrap\">\n            <span className=\"text-xs font-medium\">Departments:</span>\n            {doc.departments.slice(0, 3).map((dept, index) => (\n              <Badge key={dept.id} variant=\"outline\" className=\"text-xs px-1 py-0\">\n                {dept.name}\n              </Badge>\n            ))}\n            {doc.departments.length > 3 && (\n              <span className=\"text-xs text-muted-foreground\">+{doc.departments.length - 3} more</span>\n            )}\n          </div>\n        )}\n        \n        <div className=\"flex items-center justify-between text-xs text-muted-foreground pt-1 border-t\">\n          <span>Created: {doc.createdAt ? new Date(doc.createdAt).toLocaleDateString() : 'Unknown'}</span>\n          {doc.approvedAt && (\n            <span>Approved: {new Date(doc.approvedAt).toLocaleDateString()}</span>\n          )}\n          {doc.issuedAt && (\n            <span>Issued: {new Date(doc.issuedAt).toLocaleDateString()}</span>\n          )}\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\nfunction UserCard({ user, role, index, onDelete }: { \n  user: { id: string; fullName: string; username: string }; \n  role: string; \n  index: number;\n  onDelete: (userId: string) => void;\n}) {\n  const roleColors: Record<string, string> = {\n    creator: \"bg-blue-500/10 text-blue-600 dark:text-blue-400\",\n    approver: \"bg-green-500/10 text-green-600 dark:text-green-400\",\n    issuer: \"bg-purple-500/10 text-purple-600 dark:text-purple-400\",\n    admin: \"bg-orange-500/10 text-orange-600 dark:text-orange-400\",\n    recipient: \"bg-gray-500/10 text-gray-600 dark:text-gray-400\"\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, x: -20 }}\n      animate={{ opacity: 1, x: 0 }}\n      transition={{ delay: index * 0.05 }}\n      className=\"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover-elevate\"\n      data-testid={`user-card-${user.id}`}\n    >\n      <div className=\"flex items-center gap-3\">\n        <Avatar className=\"h-10 w-10\">\n          <AvatarFallback className=\"bg-primary/10 text-primary font-medium\">\n            {user.fullName.split(' ').map(n => n[0]).join('').toUpperCase()}\n          </AvatarFallback>\n        </Avatar>\n        <div>\n          <p className=\"font-medium text-sm\">{user.fullName}</p>\n          <p className=\"text-xs text-muted-foreground\">{user.username}</p>\n        </div>\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <Badge variant=\"secondary\" className={roleColors[role]}>\n          {role.charAt(0).toUpperCase() + role.slice(1)}\n        </Badge>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => onDelete(user.id)}\n          className=\"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10\"\n        >\n          <Trash2 className=\"h-4 w-4\" />\n        </Button>\n      </div>\n    </motion.div>\n  );\n}\n\nexport default function AdminDashboard({ onLogout, userId = \"admin-1\" }: AdminDashboardProps) {\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [selectedDoc, setSelectedDoc] = useState<Document | null>(null);\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [userDialogOpen, setUserDialogOpen] = useState(false);\n  const [deptDialogOpen, setDeptDialogOpen] = useState(false);\n  const [expandedCategories, setExpandedCategories] = useState<Record<string, boolean>>({});\n  const { toast } = useToast();\n\n  // Form configurations\n  const userForm = useForm<UserFormValues>({\n    resolver: zodResolver(userFormSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n      fullName: \"\",\n      role: \"creator\",\n      masterCopyAccess: false,\n    },\n  });\n\n  const deptForm = useForm<DepartmentFormValues>({\n    resolver: zodResolver(departmentFormSchema),\n    defaultValues: {\n      name: \"\",\n      code: \"\",\n    },\n  });\n\n  const { data: stats, isLoading: statsLoading } = useQuery<AdminStats>({\n    queryKey: [\"/api/admin/stats\"],\n    refetchInterval: 10000,\n  });\n\n  const { data: usersData, isLoading: usersLoading } = useQuery<AdminUsers>({\n    queryKey: [\"/api/admin/users\"],\n    refetchInterval: 30000,\n  });\n\n  const { data: documentsData, isLoading: documentsLoading } = useQuery<AdminDocuments>({\n    queryKey: [\"/api/admin/documents\"],\n    refetchInterval: 5000,\n  });\n\n  // Query for dynamic departments (ones that can be deleted)\n  const { data: dynamicDepartments, isLoading: departmentsLoading } = useQuery<DynamicDepartment[]>({\n    queryKey: [\"/api/departments\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/departments\");\n      return response.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: UserFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/users\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"User Created\",\n        description: \"New user has been added successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      setUserDialogOpen(false);\n      userForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create user.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createDeptMutation = useMutation({\n    mutationFn: async (data: DepartmentFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/departments\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Department Created\",\n        description: \"New department has been added successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/departments\"] });\n      setDeptDialogOpen(false);\n      deptForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create department.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleView = (doc: Document) => {\n    setSelectedDoc(doc);\n    setViewDialogOpen(true);\n  };\n\n  const handleExportLogs = () => {\n    toast({\n      title: \"Export Started\",\n      description: \"Your document logs are being exported to Excel...\",\n    });\n  };\n\n  const onUserSubmit = (data: UserFormValues) => {\n    createUserMutation.mutate(data);\n  };\n\n  const onDeptSubmit = (data: DepartmentFormValues) => {\n    createDeptMutation.mutate(data);\n  };\n\n  // Delete mutations\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      console.log('Attempting to delete user:', userId);\n      const response = await apiRequest(\"DELETE\", `/api/users/${userId}`);\n      if (!response.ok) {\n        throw new Error(`Failed to delete user: ${response.statusText}`);\n      }\n      return response.json();\n    },\n    onSuccess: (data, variables) => {\n      console.log('User deleted successfully:', variables);\n      toast({\n        title: \"User Deleted\",\n        description: \"User has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n    },\n    onError: (error: Error, variables) => {\n      console.error('Delete user error:', error, 'for user:', variables);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete user.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteDeptMutation = useMutation({\n    mutationFn: async (deptId: string) => {\n      console.log('Attempting to delete department:', deptId);\n      const response = await apiRequest(\"DELETE\", `/api/departments/${deptId}`);\n      if (!response.ok) {\n        throw new Error(`Failed to delete department: ${response.statusText}`);\n      }\n      return response.json();\n    },\n    onSuccess: (data, variables) => {\n      console.log('Department deleted successfully:', variables);\n      toast({\n        title: \"Department Deleted\",\n        description: \"Department has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/departments\"] });\n    },\n    onError: (error: Error, variables) => {\n      console.error('Delete department error:', error, 'for department:', variables);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete department.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteUser = (userId: string) => {\n    if (confirm(`Are you sure you want to delete this user? This action cannot be undone.`)) {\n      console.log('User confirmed deletion for user:', userId);\n      deleteUserMutation.mutate(userId);\n    }\n  };\n\n  const handleDeleteDept = (deptId: string) => {\n    if (confirm(`Are you sure you want to delete this department? This action cannot be undone.`)) {\n      console.log('User confirmed deletion for department:', deptId);\n      deleteDeptMutation.mutate(deptId);\n    }\n  };\n\n  const toggleCategory = (categoryId: string) => {\n    setExpandedCategories(prev => ({\n      ...prev,\n      [categoryId]: !prev[categoryId]\n    }));\n  };\n\n  const transformDocuments = (docs: ApiDocument[]): Document[] => {\n    return docs.map((doc) => ({\n      id: doc.id,\n      docName: doc.docName,\n      docNumber: doc.docNumber,\n      status: doc.status.charAt(0).toUpperCase() + doc.status.slice(1) as \"Pending\" | \"Approved\" | \"Declined\" | \"Issued\",\n      dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split(\"T\")[0] : \"\",\n      revisionNo: doc.revisionNo,\n      preparedBy: doc.preparerName || \"Unknown\",\n    }));\n  };\n\n  const pieData = stats ? [\n    { name: 'Pending', value: stats.documents.pending },\n    { name: 'Approved', value: stats.documents.approved },\n    { name: 'Issued', value: stats.documents.issued },\n    { name: 'Declined', value: stats.documents.declined },\n  ].filter(d => d.value > 0) : [];\n\n  const pendingDocs = documentsData?.documents.filter(d => d.status === \"pending\") || [];\n  const approvedDocs = documentsData?.documents.filter(d => d.status === \"approved\") || [];\n  const issuedDocs = documentsData?.documents.filter(d => d.status === \"issued\") || [];\n  const declinedDocs = documentsData?.documents.filter(d => d.status === \"declined\") || [];\n\n  return (\n    <DashboardLayout\n      userRole=\"Administrator\"\n      userName=\"Admin User\"\n      userId={userId}\n      notificationCount={0}\n      onLogout={onLogout}\n    >\n      <motion.div \n        className=\"space-y-6\"\n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n      >\n        <motion.div variants={itemVariants} className=\"flex items-center justify-between flex-wrap gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-foreground\">Admin Dashboard</h2>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Complete system oversight with real-time analytics\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <Button onClick={handleExportLogs} data-testid=\"button-export-logs\">\n              <Download className=\"w-4 h-4 mr-2\" />\n              Export Report\n            </Button>\n          </div>\n        </motion.div>\n\n        <motion.div \n          className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\"\n          variants={containerVariants}\n        >\n          <StatCardAnimated\n            title=\"Total Documents\"\n            value={stats?.documents.total || 0}\n            icon={FileText}\n            trend={`${stats?.documents.recentCount || 0} this month`}\n            trendUp={true}\n            color=\"bg-primary\"\n            delay={0}\n          />\n          <StatCardAnimated\n            title=\"Pending Approval\"\n            value={stats?.documents.pending || 0}\n            icon={Clock}\n            trend=\"Awaiting review\"\n            color=\"bg-amber-500\"\n            delay={0.1}\n          />\n          <StatCardAnimated\n            title=\"Issued Documents\"\n            value={stats?.documents.issued || 0}\n            icon={CheckCircle}\n            trend=\"Active in system\"\n            trendUp={true}\n            color=\"bg-green-500\"\n            delay={0.2}\n          />\n          <StatCardAnimated\n            title=\"Total Users\"\n            value={stats?.users.total || 0}\n            icon={Users}\n            trend={`${stats?.departments.total || 0} departments`}\n            color=\"bg-purple-500\"\n            delay={0.3}\n          />\n        </motion.div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <motion.div variants={itemVariants}>\n            <TabsList className=\"grid w-full grid-cols-4\">\n              <TabsTrigger value=\"overview\" className=\"gap-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Overview\n              </TabsTrigger>\n              <TabsTrigger value=\"documents\" className=\"gap-2\">\n                <FileText className=\"w-4 h-4\" />\n                Documents\n              </TabsTrigger>\n              <TabsTrigger value=\"users\" className=\"gap-2\">\n                <Users className=\"w-4 h-4\" />\n                Users\n              </TabsTrigger>\n              <TabsTrigger value=\"departments\" className=\"gap-2\">\n                <Building2 className=\"w-4 h-4\" />\n                Departments\n              </TabsTrigger>\n            </TabsList>\n          </motion.div>\n\n          <AnimatePresence mode=\"wait\">\n            <TabsContent value=\"overview\" className=\"mt-6\">\n              <motion.div\n                key=\"overview\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                transition={{ duration: 0.3 }}\n                className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\"\n              >\n                <Card className=\"p-6 lg:col-span-2\">\n                  <div className=\"flex items-center justify-between mb-6\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold\">Weekly Activity</h3>\n                      <p className=\"text-sm text-muted-foreground\">Documents processed this week</p>\n                    </div>\n                    <Activity className=\"w-5 h-5 text-muted-foreground\" />\n                  </div>\n                  <div className=\"h-[300px]\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={stats?.weeklyActivity || []}>\n                        <CartesianGrid strokeDasharray=\"3 3\" className=\"opacity-30\" />\n                        <XAxis dataKey=\"day\" tick={{ fontSize: 12 }} />\n                        <YAxis tick={{ fontSize: 12 }} />\n                        <Tooltip \n                          contentStyle={{ \n                            backgroundColor: 'hsl(var(--card))',\n                            border: '1px solid hsl(var(--border))',\n                            borderRadius: '8px'\n                          }}\n                        />\n                        <Bar \n                          dataKey=\"documents\" \n                          fill=\"hsl(var(--primary))\" \n                          radius={[4, 4, 0, 0]}\n                          animationDuration={1000}\n                        />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                </Card>\n\n                <Card className=\"p-6\">\n                  <div className=\"flex items-center justify-between mb-6\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold\">Document Status</h3>\n                      <p className=\"text-sm text-muted-foreground\">Distribution overview</p>\n                    </div>\n                    <TrendingUp className=\"w-5 h-5 text-muted-foreground\" />\n                  </div>\n                  <div className=\"h-[200px]\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <PieChart>\n                        <Pie\n                          data={pieData}\n                          cx=\"50%\"\n                          cy=\"50%\"\n                          innerRadius={40}\n                          outerRadius={80}\n                          paddingAngle={5}\n                          dataKey=\"value\"\n                          animationDuration={1000}\n                        >\n                          {pieData.map((_, index) => (\n                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                          ))}\n                        </Pie>\n                        <Tooltip />\n                      </PieChart>\n                    </ResponsiveContainer>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-2 mt-4\">\n                    {pieData.map((entry, index) => (\n                      <div key={entry.name} className=\"flex items-center gap-2\">\n                        <div \n                          className=\"w-3 h-3 rounded-full\" \n                          style={{ backgroundColor: COLORS[index % COLORS.length] }}\n                        />\n                        <span className=\"text-sm text-muted-foreground\">\n                          {entry.name}: {entry.value}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </Card>\n\n                <Card className=\"p-6 lg:col-span-2\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold\">Recent Documents</h3>\n                      <p className=\"text-sm text-muted-foreground\">Latest activity in the system</p>\n                    </div>\n                    <Calendar className=\"w-5 h-5 text-muted-foreground\" />\n                  </div>\n                  <ScrollArea className=\"h-[300px]\">\n                    <div className=\"space-y-3\">\n                      {stats?.recentDocuments.map((doc, index) => (\n                        <motion.div\n                          key={`recent-${doc.id || index}`}\n                          initial={{ opacity: 0, x: -20 }}\n                          animate={{ opacity: 1, x: 0 }}\n                          transition={{ delay: index * 0.05 }}\n                          className=\"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover-elevate\"\n                          data-testid={`recent-doc-${doc.id}`}\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 rounded-lg bg-primary/10\">\n                              <FileText className=\"w-4 h-4 text-primary\" />\n                            </div>\n                            <div>\n                              <p className=\"font-medium text-sm\">{doc.docName}</p>\n                              <p className=\"text-xs text-muted-foreground\">{doc.docNumber}</p>\n                            </div>\n                          </div>\n                          <Badge \n                            variant=\"secondary\"\n                            className={\n                              doc.status === 'issued' ? 'bg-green-500/10 text-green-600 dark:text-green-400' :\n                              doc.status === 'approved' ? 'bg-blue-500/10 text-blue-600 dark:text-blue-400' :\n                              doc.status === 'pending' ? 'bg-amber-500/10 text-amber-600 dark:text-amber-400' :\n                              'bg-red-500/10 text-red-600 dark:text-red-400'\n                            }\n                          >\n                            {doc.status.charAt(0).toUpperCase() + doc.status.slice(1)}\n                          </Badge>\n                        </motion.div>\n                      ))}\n                      {(!stats?.recentDocuments || stats.recentDocuments.length === 0) && (\n                        <div className=\"text-center py-8 text-muted-foreground\">\n                          <FileText className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                          <p className=\"text-sm\">No recent documents</p>\n                        </div>\n                      )}\n                    </div>\n                  </ScrollArea>\n                </Card>\n\n                <Card className=\"p-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold\">User Breakdown</h3>\n                      <p className=\"text-sm text-muted-foreground\">By role type</p>\n                    </div>\n                    <Users className=\"w-5 h-5 text-muted-foreground\" />\n                  </div>\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <UserCog className=\"w-4 h-4 text-blue-500\" />\n                          <span className=\"text-sm\">Creators</span>\n                        </div>\n                        <span className=\"font-medium\">{stats?.users.creators || 0}</span>\n                      </div>\n                      <Progress value={(stats?.users.creators || 0) / (stats?.users.total || 1) * 100} className=\"h-2\" />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <UserCheck className=\"w-4 h-4 text-green-500\" />\n                          <span className=\"text-sm\">Approvers</span>\n                        </div>\n                        <span className=\"font-medium\">{stats?.users.approvers || 0}</span>\n                      </div>\n                      <Progress value={(stats?.users.approvers || 0) / (stats?.users.total || 1) * 100} className=\"h-2\" />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <Send className=\"w-4 h-4 text-purple-500\" />\n                          <span className=\"text-sm\">Issuers</span>\n                        </div>\n                        <span className=\"font-medium\">{stats?.users.issuers || 0}</span>\n                      </div>\n                      <Progress value={(stats?.users.issuers || 0) / (stats?.users.total || 1) * 100} className=\"h-2\" />\n                    </div>\n                  </div>\n                </Card>\n              </motion.div>\n            </TabsContent>\n\n            <TabsContent value=\"documents\" className=\"mt-6\">\n              <motion.div\n                key=\"documents\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                transition={{ duration: 0.3 }}\n              >\n                <Card className=\"p-6\">\n                  <div className=\"flex items-center justify-between mb-6 flex-wrap gap-4\">\n                    <h3 className=\"text-lg font-semibold\">All Documents</h3>\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <Badge variant=\"outline\">{documentsData?.stats.total || 0} Total</Badge>\n                      <Badge variant=\"secondary\" className=\"bg-amber-500/10 text-amber-600\">{documentsData?.stats.pending || 0} Pending</Badge>\n                      <Badge variant=\"secondary\" className=\"bg-green-500/10 text-green-600\">{documentsData?.stats.issued || 0} Issued</Badge>\n                    </div>\n                  </div>\n\n                  <Tabs defaultValue=\"all\" className=\"w-full\">\n                    <TabsList className=\"grid w-full grid-cols-5\">\n                      <TabsTrigger value=\"all\">All ({documentsData?.documents.length || 0})</TabsTrigger>\n                      <TabsTrigger value=\"pending\">Pending ({pendingDocs.length})</TabsTrigger>\n                      <TabsTrigger value=\"approved\">Approved ({approvedDocs.length})</TabsTrigger>\n                      <TabsTrigger value=\"issued\">Issued ({issuedDocs.length})</TabsTrigger>\n                      <TabsTrigger value=\"declined\">Declined ({declinedDocs.length})</TabsTrigger>\n                    </TabsList>\n\n                    <TabsContent value=\"all\" className=\"mt-6\">\n                      {documentsLoading ? (\n                        <div className=\"border rounded-lg p-12 text-center\">\n                          <motion.div\n                            animate={{ rotate: 360 }}\n                            transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                          >\n                            <Activity className=\"w-8 h-8 mx-auto text-muted-foreground\" />\n                          </motion.div>\n                          <p className=\"text-sm text-muted-foreground mt-4\">Loading documents...</p>\n                        </div>\n                      ) : documentsData?.documents && documentsData.documents.length > 0 ? (\n                        <div className=\"overflow-x-auto\">\n                          <table className=\"w-full border-collapse text-sm\" data-testid=\"table-admin-documents\">\n                            <thead>\n                              <tr className=\"border-b bg-muted/50\">\n                                <th className=\"text-left p-3 font-medium\">Doc Number</th>\n                                <th className=\"text-left p-3 font-medium\">Document Name</th>\n                                <th className=\"text-left p-3 font-medium\">Rev</th>\n                                <th className=\"text-left p-3 font-medium\">Status</th>\n                                <th className=\"text-left p-3 font-medium\">Preparer</th>\n                                <th className=\"text-left p-3 font-medium\">Date of Issue</th>\n                                <th className=\"text-left p-3 font-medium\">Departments</th>\n                                <th className=\"text-left p-3 font-medium\">Actions</th>\n                              </tr>\n                            </thead>\n                            <tbody>\n                              {documentsData.documents.map((doc, index) => (\n                                <tr \n                                  key={`doc-${doc.id || index}`} \n                                  className=\"border-b hover:bg-muted/30 transition-colors\"\n                                  data-testid={`row-document-${doc.id}`}\n                                >\n                                  <td className=\"p-3 font-mono text-xs\">{doc.docNumber}</td>\n                                  <td className=\"p-3\">{doc.docName}</td>\n                                  <td className=\"p-3 text-center\">{doc.revisionNo}</td>\n                                  <td className=\"p-3\">\n                                    <Badge \n                                      variant=\"outline\" \n                                      className={\n                                        doc.status.toLowerCase() === 'pending' ? 'bg-amber-500/10 text-amber-600' :\n                                        doc.status.toLowerCase() === 'approved' ? 'bg-blue-500/10 text-blue-600' :\n                                        doc.status.toLowerCase() === 'issued' ? 'bg-green-500/10 text-green-600' :\n                                        doc.status.toLowerCase() === 'declined' ? 'bg-red-500/10 text-red-600' :\n                                        'bg-gray-500/10 text-gray-600'\n                                      }\n                                    >\n                                      {doc.status.charAt(0).toUpperCase() + doc.status.slice(1)}\n                                    </Badge>\n                                  </td>\n                                  <td className=\"p-3\">{doc.preparerName || 'Unknown'}</td>\n                                  <td className=\"p-3\">{doc.dateOfIssue ? new Date(doc.dateOfIssue).toLocaleDateString() : '-'}</td>\n                                  <td className=\"p-3\">\n                                    {doc.departments && doc.departments.length > 0 ? (\n                                      <span className=\"text-xs text-muted-foreground\">\n                                        {doc.departments.slice(0, 2).map(d => d.name).join(', ')}\n                                        {doc.departments.length > 2 && ` +${doc.departments.length - 2}`}\n                                      </span>\n                                    ) : '-'}\n                                  </td>\n                                  <td className=\"p-3\">\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleView({\n                                        id: doc.id,\n                                        docName: doc.docName,\n                                        docNumber: doc.docNumber,\n                                        status: doc.status.charAt(0).toUpperCase() + doc.status.slice(1) as \"Pending\" | \"Approved\" | \"Declined\" | \"Issued\",\n                                        dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n                                        revisionNo: doc.revisionNo,\n                                        preparedBy: doc.preparerName || 'Unknown'\n                                      })}\n                                      data-testid={`button-view-${doc.id}`}\n                                    >\n                                      <Eye className=\"w-4 h-4\" />\n                                    </Button>\n                                  </td>\n                                </tr>\n                              ))}\n                            </tbody>\n                          </table>\n                        </div>\n                      ) : (\n                        <div className=\"border rounded-lg p-12 text-center\">\n                          <FileText className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                          <p className=\"text-sm text-muted-foreground\">No documents in the system</p>\n                        </div>\n                      )}\n                    </TabsContent>\n\n                    <TabsContent value=\"pending\" className=\"mt-6\">\n                      {pendingDocs.length > 0 ? (\n                        <div className=\"space-y-4\">\n                          <div className=\"p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <Clock className=\"w-4 h-4 text-amber-600\" />\n                              <h4 className=\"font-medium text-amber-800 dark:text-amber-200\">Pending Documents Workflow</h4>\n                            </div>\n                            <p className=\"text-sm text-amber-700 dark:text-amber-300\">Documents waiting for approval or issue.</p>\n                          </div>\n                          <div className=\"overflow-x-auto\">\n                            <table className=\"w-full border-collapse text-sm\">\n                              <thead>\n                                <tr className=\"border-b bg-muted/50\">\n                                  <th className=\"text-left p-3 font-medium\">Doc Number</th>\n                                  <th className=\"text-left p-3 font-medium\">Document Name</th>\n                                  <th className=\"text-left p-3 font-medium\">Rev</th>\n                                  <th className=\"text-left p-3 font-medium\">Preparer</th>\n                                  <th className=\"text-left p-3 font-medium\">Date of Issue</th>\n                                  <th className=\"text-left p-3 font-medium\">Departments</th>\n                                  <th className=\"text-left p-3 font-medium\">Actions</th>\n                                </tr>\n                              </thead>\n                              <tbody>\n                                {pendingDocs.map((doc, index) => (\n                                  <tr key={`pending-${doc.id || index}`} className=\"border-b hover:bg-muted/30 transition-colors\">\n                                    <td className=\"p-3 font-mono text-xs\">{doc.docNumber}</td>\n                                    <td className=\"p-3\">{doc.docName}</td>\n                                    <td className=\"p-3 text-center\">{doc.revisionNo}</td>\n                                    <td className=\"p-3\">{doc.preparerName || 'Unknown'}</td>\n                                    <td className=\"p-3\">{doc.dateOfIssue ? new Date(doc.dateOfIssue).toLocaleDateString() : '-'}</td>\n                                    <td className=\"p-3\">\n                                      {doc.departments && doc.departments.length > 0 ? (\n                                        <span className=\"text-xs text-muted-foreground\">\n                                          {doc.departments.slice(0, 2).map(d => d.name).join(', ')}\n                                          {doc.departments.length > 2 && ` +${doc.departments.length - 2}`}\n                                        </span>\n                                      ) : '-'}\n                                    </td>\n                                    <td className=\"p-3\">\n                                      <Button size=\"sm\" variant=\"ghost\" onClick={() => handleView({\n                                        id: doc.id, docName: doc.docName, docNumber: doc.docNumber,\n                                        status: \"Pending\", dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n                                        revisionNo: doc.revisionNo, preparedBy: doc.preparerName || 'Unknown'\n                                      })}><Eye className=\"w-4 h-4\" /></Button>\n                                    </td>\n                                  </tr>\n                                ))}\n                              </tbody>\n                            </table>\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"border rounded-lg p-12 text-center\">\n                          <Clock className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                          <p className=\"text-sm text-muted-foreground\">No pending documents</p>\n                        </div>\n                      )}\n                    </TabsContent>\n\n                    <TabsContent value=\"approved\" className=\"mt-6\">\n                      {approvedDocs.length > 0 ? (\n                        <div className=\"space-y-4\">\n                          <div className=\"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <CheckCircle className=\"w-4 h-4 text-blue-600\" />\n                              <h4 className=\"font-medium text-blue-800 dark:text-blue-200\">Approved Documents</h4>\n                            </div>\n                            <p className=\"text-sm text-blue-700 dark:text-blue-300\">Documents approved and waiting for issue.</p>\n                          </div>\n                          <div className=\"overflow-x-auto\">\n                            <table className=\"w-full border-collapse text-sm\">\n                              <thead>\n                                <tr className=\"border-b bg-muted/50\">\n                                  <th className=\"text-left p-3 font-medium\">Doc Number</th>\n                                  <th className=\"text-left p-3 font-medium\">Document Name</th>\n                                  <th className=\"text-left p-3 font-medium\">Rev</th>\n                                  <th className=\"text-left p-3 font-medium\">Preparer</th>\n                                  <th className=\"text-left p-3 font-medium\">Approver</th>\n                                  <th className=\"text-left p-3 font-medium\">Approved At</th>\n                                  <th className=\"text-left p-3 font-medium\">Actions</th>\n                                </tr>\n                              </thead>\n                              <tbody>\n                                {approvedDocs.map((doc, index) => (\n                                  <tr key={`approved-${doc.id || index}`} className=\"border-b hover:bg-muted/30 transition-colors\">\n                                    <td className=\"p-3 font-mono text-xs\">{doc.docNumber}</td>\n                                    <td className=\"p-3\">{doc.docName}</td>\n                                    <td className=\"p-3 text-center\">{doc.revisionNo}</td>\n                                    <td className=\"p-3\">{doc.preparerName || 'Unknown'}</td>\n                                    <td className=\"p-3\">{doc.approverName || '-'}</td>\n                                    <td className=\"p-3\">{doc.approvedAt ? new Date(doc.approvedAt).toLocaleDateString() : '-'}</td>\n                                    <td className=\"p-3\">\n                                      <Button size=\"sm\" variant=\"ghost\" onClick={() => handleView({\n                                        id: doc.id, docName: doc.docName, docNumber: doc.docNumber,\n                                        status: \"Approved\", dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n                                        revisionNo: doc.revisionNo, preparedBy: doc.preparerName || 'Unknown'\n                                      })}><Eye className=\"w-4 h-4\" /></Button>\n                                    </td>\n                                  </tr>\n                                ))}\n                              </tbody>\n                            </table>\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"border rounded-lg p-12 text-center\">\n                          <CheckCircle className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                          <p className=\"text-sm text-muted-foreground\">No approved documents</p>\n                        </div>\n                      )}\n                    </TabsContent>\n\n                    <TabsContent value=\"issued\" className=\"mt-6\">\n                      {issuedDocs.length > 0 ? (\n                        <div className=\"space-y-4\">\n                          <div className=\"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <Send className=\"w-4 h-4 text-green-600\" />\n                              <h4 className=\"font-medium text-green-800 dark:text-green-200\">Issued Documents</h4>\n                            </div>\n                            <p className=\"text-sm text-green-700 dark:text-green-300\">Documents that have been issued and are active.</p>\n                          </div>\n                          <div className=\"overflow-x-auto\">\n                            <table className=\"w-full border-collapse text-sm\">\n                              <thead>\n                                <tr className=\"border-b bg-muted/50\">\n                                  <th className=\"text-left p-3 font-medium\">Doc Number</th>\n                                  <th className=\"text-left p-3 font-medium\">Document Name</th>\n                                  <th className=\"text-left p-3 font-medium\">Rev</th>\n                                  <th className=\"text-left p-3 font-medium\">Preparer</th>\n                                  <th className=\"text-left p-3 font-medium\">Issuer</th>\n                                  <th className=\"text-left p-3 font-medium\">Issued At</th>\n                                  <th className=\"text-left p-3 font-medium\">Actions</th>\n                                </tr>\n                              </thead>\n                              <tbody>\n                                {issuedDocs.map((doc, index) => (\n                                  <tr key={`issued-${doc.id || index}`} className=\"border-b hover:bg-muted/30 transition-colors\">\n                                    <td className=\"p-3 font-mono text-xs\">{doc.docNumber}</td>\n                                    <td className=\"p-3\">{doc.docName}</td>\n                                    <td className=\"p-3 text-center\">{doc.revisionNo}</td>\n                                    <td className=\"p-3\">{doc.preparerName || 'Unknown'}</td>\n                                    <td className=\"p-3\">{doc.issuerName || '-'}</td>\n                                    <td className=\"p-3\">{doc.issuedAt ? new Date(doc.issuedAt).toLocaleDateString() : '-'}</td>\n                                    <td className=\"p-3\">\n                                      <Button size=\"sm\" variant=\"ghost\" onClick={() => handleView({\n                                        id: doc.id, docName: doc.docName, docNumber: doc.docNumber,\n                                        status: \"Issued\", dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n                                        revisionNo: doc.revisionNo, preparedBy: doc.preparerName || 'Unknown'\n                                      })}><Eye className=\"w-4 h-4\" /></Button>\n                                    </td>\n                                  </tr>\n                                ))}\n                              </tbody>\n                            </table>\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"border rounded-lg p-12 text-center\">\n                          <Send className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                          <p className=\"text-sm text-muted-foreground\">No issued documents</p>\n                        </div>\n                      )}\n                    </TabsContent>\n\n                    <TabsContent value=\"declined\" className=\"mt-6\">\n                      {declinedDocs.length > 0 ? (\n                        <div className=\"space-y-4\">\n                          <div className=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <XCircle className=\"w-4 h-4 text-red-600\" />\n                              <h4 className=\"font-medium text-red-800 dark:text-red-200\">Declined Documents</h4>\n                            </div>\n                            <p className=\"text-sm text-red-700 dark:text-red-300\">Documents that have been declined with comments.</p>\n                          </div>\n                          <div className=\"overflow-x-auto\">\n                            <table className=\"w-full border-collapse text-sm\">\n                              <thead>\n                                <tr className=\"border-b bg-muted/50\">\n                                  <th className=\"text-left p-3 font-medium\">Doc Number</th>\n                                  <th className=\"text-left p-3 font-medium\">Document Name</th>\n                                  <th className=\"text-left p-3 font-medium\">Rev</th>\n                                  <th className=\"text-left p-3 font-medium\">Preparer</th>\n                                  <th className=\"text-left p-3 font-medium\">Declined By</th>\n                                  <th className=\"text-left p-3 font-medium\">Remarks</th>\n                                  <th className=\"text-left p-3 font-medium\">Actions</th>\n                                </tr>\n                              </thead>\n                              <tbody>\n                                {declinedDocs.map((doc, index) => (\n                                  <tr key={`declined-${doc.id || index}`} className=\"border-b hover:bg-muted/30 transition-colors\">\n                                    <td className=\"p-3 font-mono text-xs\">{doc.docNumber}</td>\n                                    <td className=\"p-3\">{doc.docName}</td>\n                                    <td className=\"p-3 text-center\">{doc.revisionNo}</td>\n                                    <td className=\"p-3\">{doc.preparerName || 'Unknown'}</td>\n                                    <td className=\"p-3\">{doc.approverName || '-'}</td>\n                                    <td className=\"p-3 max-w-[200px] truncate\" title={doc.declineRemarks || ''}>\n                                      {doc.declineRemarks || '-'}\n                                    </td>\n                                    <td className=\"p-3\">\n                                      <Button size=\"sm\" variant=\"ghost\" onClick={() => handleView({\n                                        id: doc.id, docName: doc.docName, docNumber: doc.docNumber,\n                                        status: \"Declined\", dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split('T')[0] : '',\n                                        revisionNo: doc.revisionNo, preparedBy: doc.preparerName || 'Unknown'\n                                      })}><Eye className=\"w-4 h-4\" /></Button>\n                                    </td>\n                                  </tr>\n                                ))}\n                              </tbody>\n                            </table>\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"border rounded-lg p-12 text-center\">\n                          <XCircle className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                          <p className=\"text-sm text-muted-foreground\">No declined documents</p>\n                        </div>\n                      )}\n                    </TabsContent>\n                  </Tabs>\n                </Card>\n              </motion.div>\n            </TabsContent>\n\n            <TabsContent value=\"users\" className=\"mt-6\">\n              <motion.div\n                key=\"users\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                transition={{ duration: 0.3 }}\n              >\n                <div className=\"flex items-center justify-between mb-6 flex-wrap gap-4\">\n                  <div>\n                    <h3 className=\"text-lg font-semibold\">User Management</h3>\n                    <p className=\"text-sm text-muted-foreground\">Manage system users and their permissions</p>\n                  </div>\n                  <Button onClick={() => setUserDialogOpen(true)} data-testid=\"button-add-user-inline\">\n                    <UserPlus className=\"w-4 h-4 mr-2\" />\n                    Add New User\n                  </Button>\n                </div>\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                  <Card className=\"p-6\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <UserCog className=\"w-5 h-5 text-blue-500\" />\n                        <h3 className=\"text-lg font-semibold\">Creators</h3>\n                      </div>\n                      <Badge variant=\"secondary\">{usersData?.creators.length || 0}</Badge>\n                    </div>\n                    <ScrollArea className=\"h-[300px]\">\n                      <div className=\"space-y-2\">\n                        {usersData?.creators.map((user, index) => (\n                          <UserCard key={`creator-${user.id || index}`} user={user} role=\"creator\" index={index} onDelete={handleDeleteUser} />\n                        ))}\n                        {(!usersData?.creators || usersData.creators.length === 0) && (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            <Users className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                            <p className=\"text-sm\">No creators found</p>\n                          </div>\n                        )}\n                      </div>\n                    </ScrollArea>\n                  </Card>\n\n                  <Card className=\"p-6\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <UserCheck className=\"w-5 h-5 text-green-500\" />\n                        <h3 className=\"text-lg font-semibold\">Approvers</h3>\n                      </div>\n                      <Badge variant=\"secondary\">{usersData?.approvers.length || 0}</Badge>\n                    </div>\n                    <ScrollArea className=\"h-[300px]\">\n                      <div className=\"space-y-2\">\n                        {usersData?.approvers.map((user, index) => (\n                          <UserCard key={`approver-${user.id || index}`} user={user} role=\"approver\" index={index} onDelete={handleDeleteUser} />\n                        ))}\n                        {(!usersData?.approvers || usersData.approvers.length === 0) && (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            <Users className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                            <p className=\"text-sm\">No approvers found</p>\n                          </div>\n                        )}\n                      </div>\n                    </ScrollArea>\n                  </Card>\n\n                  <Card className=\"p-6\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Send className=\"w-5 h-5 text-purple-500\" />\n                        <h3 className=\"text-lg font-semibold\">Issuers</h3>\n                      </div>\n                      <Badge variant=\"secondary\">{usersData?.issuers.length || 0}</Badge>\n                    </div>\n                    <ScrollArea className=\"h-[300px]\">\n                      <div className=\"space-y-2\">\n                        {usersData?.issuers.map((user, index) => (\n                          <UserCard key={`issuer-${user.id || index}`} user={user} role=\"issuer\" index={index} onDelete={handleDeleteUser} />\n                        ))}\n                        {(!usersData?.issuers || usersData.issuers.length === 0) && (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            <Users className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                            <p className=\"text-sm\">No issuers found</p>\n                          </div>\n                        )}\n                      </div>\n                    </ScrollArea>\n                  </Card>\n\n                  <Card className=\"p-6\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Shield className=\"w-5 h-5 text-orange-500\" />\n                        <h3 className=\"text-lg font-semibold\">Administrators</h3>\n                      </div>\n                      <Badge variant=\"secondary\">{usersData?.admins.length || 0}</Badge>\n                    </div>\n                    <ScrollArea className=\"h-[300px]\">\n                      <div className=\"space-y-2\">\n                        {usersData?.admins.map((user, index) => (\n                          <UserCard key={`admin-${user.id || index}`} user={user} role=\"admin\" index={index} onDelete={handleDeleteUser} />\n                        ))}\n                        {(!usersData?.admins || usersData.admins.length === 0) && (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            <Shield className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                            <p className=\"text-sm\">No administrators found</p>\n                          </div>\n                        )}\n                      </div>\n                    </ScrollArea>\n                  </Card>\n                </div>\n              </motion.div>\n            </TabsContent>\n\n            <TabsContent value=\"departments\" className=\"mt-6\">\n              <motion.div\n                key=\"departments\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                transition={{ duration: 0.3 }}\n              >\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between mb-6 flex-wrap gap-4\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold\">Department Management</h3>\n                      <p className=\"text-sm text-muted-foreground\">Departments organized by categories</p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"outline\">\n                        {departmentData.categories.reduce((total, cat) => total + cat.departments.length, 0)} Total\n                      </Badge>\n                      <Button onClick={() => setDeptDialogOpen(true)} data-testid=\"button-add-dept-inline\">\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        Add Department\n                      </Button>\n                    </div>\n                  </div>\n                  \n                  {departmentData.categories.map((category, categoryIndex) => {\n                    const isExpanded = expandedCategories[category.id] ?? false;\n                    const displayedDepartments = isExpanded ? category.departments : category.departments.slice(0, 3);\n                    \n                    return (\n                      <Card key={category.id} className=\"p-6\">\n                        <div className=\"flex items-center justify-between mb-4\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 rounded-lg bg-primary/10\">\n                              <Building2 className=\"w-5 h-5 text-primary\" />\n                            </div>\n                            <div>\n                              <h4 className=\"text-lg font-semibold\">{category.name}</h4>\n                              <p className=\"text-sm text-muted-foreground\">\n                                {category.departments.length} departments\n                              </p>\n                            </div>\n                          </div>\n                          {category.departments.length > 3 && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => toggleCategory(category.id)}\n                              className=\"flex items-center gap-2\"\n                            >\n                              {isExpanded ? (\n                                <>\n                                  <ChevronDown className=\"w-4 h-4\" />\n                                  Show Less\n                                </>\n                              ) : (\n                                <>\n                                  <ChevronRight className=\"w-4 h-4\" />\n                                  Show All ({category.departments.length})\n                                </>\n                              )}\n                            </Button>\n                          )}\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                          {displayedDepartments.map((dept, index) => (\n                            <motion.div\n                              key={`${category.id}-${dept.id}`}\n                              initial={{ opacity: 0, scale: 0.9 }}\n                              animate={{ opacity: 1, scale: 1 }}\n                              transition={{ delay: (categoryIndex * 0.1) + (index * 0.05) }}\n                              whileHover={{ scale: 1.02 }}\n                              className=\"p-4 rounded-lg bg-muted/30 hover-elevate\"\n                              data-testid={`dept-card-${dept.id}`}\n                            >\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"p-2 rounded-lg bg-primary/10\">\n                                  <Building2 className=\"w-4 h-4 text-primary\" />\n                                </div>\n                                <div>\n                                  <p className=\"font-medium text-sm\">{dept.name}</p>\n                                  <p className=\"text-xs text-muted-foreground\">ID: {dept.id}</p>\n                                </div>\n                              </div>\n                            </motion.div>\n                          ))}\n                        </div>\n                        \n                        {!isExpanded && category.departments.length > 3 && (\n                          <div className=\"mt-4 text-center\">\n                            <p className=\"text-sm text-muted-foreground\">\n                              Showing 3 of {category.departments.length} departments\n                            </p>\n                          </div>\n                        )}\n                      </Card>\n                    );\n                  })}\n                </div>\n\n                {/* Custom Departments Section */}\n                <div className=\"mt-8\">\n                  <div className=\"mb-6\">\n                    <h3 className=\"text-xl font-semibold flex items-center gap-2\">\n                      <Building2 className=\"w-6 h-6 text-primary\" />\n                      Custom Departments\n                    </h3>\n                    <p className=\"text-sm text-muted-foreground\">Departments created by users (can be deleted)</p>\n                    <div className=\"text-sm font-medium text-primary mt-1\">\n                      {departmentsLoading ? \"Loading...\" : `${dynamicDepartments?.length || 0} Total`}\n                    </div>\n                  </div>\n\n                  {departmentsLoading ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n                      <span className=\"ml-2\">Loading departments...</span>\n                    </div>\n                  ) : dynamicDepartments && dynamicDepartments.length > 0 ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      {dynamicDepartments.map((dept, index) => (\n                        <motion.div\n                          key={`custom-${dept.id}`}\n                          initial={{ opacity: 0, scale: 0.9 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          transition={{ delay: index * 0.05 }}\n                          whileHover={{ scale: 1.02 }}\n                          className=\"p-4 rounded-lg bg-orange-50 border border-orange-200 hover-elevate\"\n                          data-testid={`custom-dept-card-${dept.id}`}\n                        >\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-3\">\n                              <div className=\"p-2 rounded-lg bg-orange-100\">\n                                <Building2 className=\"w-4 h-4 text-orange-600\" />\n                              </div>\n                              <div>\n                                <p className=\"font-medium text-sm\">{dept.name}</p>\n                                <p className=\"text-xs text-muted-foreground\">Code: {dept.code}</p>\n                                <p className=\"text-xs text-muted-foreground\">ID: {dept.id}</p>\n                              </div>\n                            </div>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleDeleteDept(dept.id)}\n                              className=\"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10\"\n                              title={`Delete ${dept.name}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </motion.div>\n                      ))}\n                    </div>\n                  ) : (\n                    <Card className=\"p-8 text-center\">\n                      <Building2 className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                      <p className=\"text-muted-foreground mb-4\">No custom departments created yet</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Use the \"Add Department\" button above to create custom departments that can be managed and deleted.\n                      </p>\n                    </Card>\n                  )}\n                </div>\n              </motion.div>\n            </TabsContent>\n          </AnimatePresence>\n        </Tabs>\n      </motion.div>\n\n      <DocumentViewDialog\n        document={selectedDoc}\n        open={viewDialogOpen}\n        onClose={() => setViewDialogOpen(false)}\n        onDownload={() => {}}\n      />\n\n      {/* Add User Dialog */}\n      <Dialog open={userDialogOpen} onOpenChange={setUserDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Add New User</DialogTitle>\n            <DialogDescription>\n              Create a new user account with specific role and access permissions.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...userForm}>\n            <form onSubmit={userForm.handleSubmit(onUserSubmit)} className=\"space-y-4\">\n              <FormField\n                control={userForm.control}\n                name=\"fullName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Full Name</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter full name\" {...field} data-testid=\"input-user-fullname\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={userForm.control}\n                name=\"username\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"Enter email address\" {...field} data-testid=\"input-user-email\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={userForm.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Password</FormLabel>\n                    <FormControl>\n                      <Input type=\"password\" placeholder=\"Enter password\" {...field} data-testid=\"input-user-password\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={userForm.control}\n                name=\"role\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Role</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-user-role\">\n                          <SelectValue placeholder=\"Select a role\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"creator\">Creator</SelectItem>\n                        <SelectItem value=\"approver\">Approver</SelectItem>\n                        <SelectItem value=\"issuer\">Issuer</SelectItem>\n                        <SelectItem value=\"admin\">Administrator</SelectItem>\n                        <SelectItem value=\"recipient\">Recipient</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormDescription>\n                      Choose the role that defines user permissions\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={userForm.control}\n                name=\"masterCopyAccess\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel className=\"text-base\">Master Copy Access</FormLabel>\n                      <FormDescription>\n                        Allow access to all document versions\n                      </FormDescription>\n                    </div>\n                    <FormControl>\n                      <Switch\n                        checked={field.value}\n                        onCheckedChange={field.onChange}\n                        data-testid=\"switch-master-copy\"\n                      />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setUserDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createUserMutation.isPending} data-testid=\"button-submit-user\">\n                  {createUserMutation.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                  Create User\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add Department Dialog */}\n      <Dialog open={deptDialogOpen} onOpenChange={setDeptDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Add New Department</DialogTitle>\n            <DialogDescription>\n              Create a new department for document distribution.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...deptForm}>\n            <form onSubmit={deptForm.handleSubmit(onDeptSubmit)} className=\"space-y-4\">\n              <FormField\n                control={deptForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Department Name</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"e.g., Engineering\" {...field} data-testid=\"input-dept-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={deptForm.control}\n                name=\"code\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Department Code</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"e.g., ENG\" {...field} data-testid=\"input-dept-code\" />\n                    </FormControl>\n                    <FormDescription>\n                      Short code for the department (max 10 characters)\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setDeptDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createDeptMutation.isPending} data-testid=\"button-submit-dept\">\n                  {createDeptMutation.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                  Create Department\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":81144,"size_tokens":null},"client/src/pages/RecipientDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/DashboardLayout\";\nimport StatCard from \"@/components/StatCard\";\nimport DocumentTable, { Document } from \"@/components/DocumentTable\";\nimport PDFViewer from \"@/components/PDFViewer\";\nimport { Card } from \"@/components/ui/card\";\nimport { FileText, Eye, Printer } from \"lucide-react\";\n\ninterface RecipientDashboardProps {\n  onLogout?: () => void;\n  userId?: string;\n}\n\ninterface ApiDocument {\n  id: string;\n  docName: string;\n  docNumber: string;\n  status: string;\n  dateOfIssue: string;\n  revisionNo: number;\n  preparedBy: string;\n  preparerName?: string;\n}\n\ninterface Notification {\n  id: string;\n  message: string;\n  type: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\nexport default function RecipientDashboard({ onLogout, userId = \"recipient-1\" }: RecipientDashboardProps) {\n  const [pdfViewerOpen, setPdfViewerOpen] = useState(false);\n  const [pdfDocId, setPdfDocId] = useState<string>(\"\");\n  const [pdfDocName, setPdfDocName] = useState<string>(\"\");\n\n  const { data: issuedDocuments = [], isLoading } = useQuery<ApiDocument[]>({\n    queryKey: [\"/api/documents\", \"issued\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/documents?status=issued\");\n      if (!response.ok) throw new Error(\"Failed to fetch issued documents\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\", userId],\n    queryFn: async () => {\n      const response = await fetch(`/api/notifications/${userId}`);\n      if (!response.ok) throw new Error(\"Failed to fetch notifications\");\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const handleViewPDF = (doc: Document) => {\n    setPdfDocId(doc.id);\n    setPdfDocName(doc.docName);\n    setPdfViewerOpen(true);\n  };\n\n  const transformedDocs = (docs: ApiDocument[]): Document[] => {\n    return docs.map((doc) => ({\n      id: doc.id,\n      docName: doc.docName,\n      docNumber: doc.docNumber,\n      status: \"Issued\" as const,\n      dateOfIssue: doc.dateOfIssue ? new Date(doc.dateOfIssue).toISOString().split(\"T\")[0] : \"\",\n      revisionNo: doc.revisionNo,\n      preparedBy: doc.preparerName || \"Unknown\",\n    }));\n  };\n\n  const unreadNotifications = notifications.filter((n) => !n.isRead).length;\n  const recentDocs = issuedDocuments.filter((doc) => {\n    const issuedDate = doc.dateOfIssue ? new Date(doc.dateOfIssue) : new Date();\n    const daysDiff = Math.floor((new Date().getTime() - issuedDate.getTime()) / (1000 * 60 * 60 * 24));\n    return daysDiff <= 7;\n  }).length;\n\n  return (\n    <DashboardLayout\n      userRole=\"Document Recipient\"\n      userName=\"Recipient User\"\n      userId={userId}\n      notificationCount={unreadNotifications}\n      onLogout={onLogout}\n    >\n      <div className=\"space-y-6\">\n        <div>\n          <h2 className=\"text-3xl font-semibold text-foreground\">Document Library</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            View and print issued documents in PDF format\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <StatCard\n            title=\"Total Documents\"\n            value={issuedDocuments.length}\n            icon={FileText}\n            trend=\"Available documents\"\n          />\n          <StatCard \n            title=\"New This Week\" \n            value={recentDocs} \n            icon={Eye} \n            trend=\"Recently issued\" \n          />\n          <StatCard\n            title=\"Control Copies\"\n            value={issuedDocuments.length}\n            icon={Printer}\n            trend=\"With tracking\"\n          />\n        </div>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-lg font-semibold\">Issued Documents</h3>\n            <div className=\"text-sm text-muted-foreground\">\n              Click \"View\" to open PDF with control copy watermark\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"border rounded-lg p-12 text-center\">\n              <p className=\"text-sm text-muted-foreground\">Loading documents...</p>\n            </div>\n          ) : issuedDocuments.length > 0 ? (\n            <DocumentTable\n              documents={transformedDocs(issuedDocuments)}\n              onView={handleViewPDF}\n              showActions={true}\n            />\n          ) : (\n            <div className=\"border rounded-lg p-12 text-center\">\n              <FileText className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-sm text-muted-foreground\">No issued documents available</p>\n            </div>\n          )}\n        </Card>\n\n        <Card className=\"p-6 bg-blue-50/30 dark:bg-blue-950/20 border-blue-200 dark:border-blue-900\">\n          <h3 className=\"text-lg font-semibold mb-3 flex items-center gap-2\">\n            <FileText className=\"w-5 h-5 text-blue-600\" />\n            Document Access Information\n          </h3>\n          <div className=\"space-y-2 text-sm text-muted-foreground\">\n            <p>\n              <strong className=\"text-foreground\">View Only:</strong> Documents are available in PDF format and cannot be downloaded. This ensures document integrity and version control.\n            </p>\n            <p>\n              <strong className=\"text-foreground\">Print Tracking:</strong> When you print a document, a unique control copy number is assigned and logged for audit purposes.\n            </p>\n            <p>\n              <strong className=\"text-foreground\">Control Copy Footer:</strong> Each printed document includes your User ID, Control Copy Number, and Print Date in the footer.\n            </p>\n            <p>\n              <strong className=\"text-foreground\">Version Access:</strong> You automatically see the latest version of each document. Previous versions are maintained but restricted to master copy users.\n            </p>\n          </div>\n        </Card>\n      </div>\n\n      <PDFViewer\n        documentId={pdfDocId}\n        userId={userId}\n        open={pdfViewerOpen}\n        onClose={() => setPdfViewerOpen(false)}\n        documentName={pdfDocName}\n      />\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":6332,"size_tokens":null},".local/state/replit/agent/progress_tracker.md":{"content":"# Document Management System - Progress Tracker\n\n## Project Goal\nBuild a Document Management System with complete workflow (Creator → Approver → Issuer → Recipients). The system manages document lifecycle including creation, approval, issuance, and distribution with features for notifications, version control, header/footer management, and controlled PDF distribution with tracking.\n\n## Completed Features\n\n### Core Infrastructure ✅\n- [x] JSON file-based storage system with race condition protection\n- [x] Pre-seeded users (creator, approver, issuer accounts)\n- [x] Pre-seeded departments (ENG, QA, OPS, FIN, HR)\n- [x] Complete data model with documents, users, departments, and notifications\n- [x] Import migration from Replit Agent to Replit environment with tsx runtime fix\n\n### Creator Module ✅\n- [x] Login page with role selection (Creator, Approver, Issuer, Recipient, Admin)\n- [x] Creator dashboard showing pending/approved/declined documents\n- [x] Document creation form with all required fields\n- [x] Department assignment for documents\n- [x] Fixed critical bug where document submissions weren't persisting to backend API\n- [x] Document view dialog with full metadata display\n- [x] Notification system for document status changes\n\n### Approver Module ✅\n- [x] Approver dashboard showing pending approvals\n- [x] Document review interface\n- [x] Approve/Decline functionality with remarks\n- [x] Notification system for creators on approval/decline\n- [x] Approval dialog component for streamlined workflow\n\n### Issuer Module ✅\n- [x] Issuer dashboard connected to real API (no mock data)\n- [x] Fetch approved documents awaiting issuance\n- [x] Fetch issued documents for tracking\n- [x] Real-time notifications from backend API\n- [x] Issue functionality with issuer remarks and name capture\n- [x] Decline functionality to send documents back to creator with remarks\n- [x] Document view dialog showing:\n  - Header/footer information\n  - Previous version comparison\n  - Issue remarks\n  - Approval/decline remarks\n  - All document metadata\n- [x] Notification system targeting only creator and approver (no spam)\n- [x] Complete API integration with mutations and cache invalidation\n\n### Document Management ✅\n- [x] Document numbering system\n- [x] Revision tracking with previous version references\n- [x] Header and footer information storage\n- [x] Multi-department assignment\n- [x] Status workflow (pending → approved/declined → issued)\n- [x] Timestamp tracking for all workflow stages\n\n### Notification System ✅\n- [x] Real-time notifications for all workflow events\n- [x] Targeted notifications (creator, approver, issuer)\n- [x] Notification count badges\n- [x] Toast messages for user actions\n- [x] Fixed duplicate notification issue for document issuance\n\n## Technical Architecture\n\n### Frontend\n- React 18+ with TypeScript and Vite\n- TanStack Query for server state and API integration\n- React Hook Form with Zod validation\n- Wouter for routing\n- shadcn/ui components with Radix UI primitives\n- Tailwind CSS for styling\n\n### Backend\n- Node.js with Express.js\n- TypeScript with ES modules\n- RESTful API design\n- JSON file-based storage with write serialization\n- Complete CRUD operations for all entities\n\n### API Endpoints\n- `GET /api/documents` - Retrieve documents by status/user\n- `GET /api/documents/:id` - Retrieve single document with full details\n- `POST /api/documents` - Create new document\n- `PATCH /api/documents/:id` - Update document\n- `POST /api/documents/:id/approve` - Approve document\n- `POST /api/documents/:id/decline` - Decline document\n- `POST /api/documents/:id/issue` - Issue document\n- `GET /api/notifications` - Retrieve user notifications\n- `PATCH /api/notifications/:id/read` - Mark notification as read\n\n## Migration to Replit Environment (November 5, 2025)\n\n### Migration Tasks ✅\n- [x] Install npm dependencies (tsx and all required packages including cross-env)\n- [x] Restart workflow to verify project runs correctly\n- [x] Verify application loads and displays login page\n- [x] Mark import as completed\n\n### Latest Migration Session (November 5, 2025) ✅\n- [x] Fixed missing cross-env dependency\n- [x] Restarted workflow successfully\n- [x] Verified application is running on port 5000\n- [x] Confirmed login page loads correctly\n- [x] All migration tasks completed\n\n### Final Migration Session (November 5, 2025 - 8:21 AM) ✅\n- [x] Installed cross-env package via npm\n- [x] Restarted workflow and confirmed it's running successfully\n- [x] Verified application loads at port 5000 with modern login page\n- [x] Confirmed all systems operational (Express server, Vite, browser console)\n- [x] All migration items marked as complete\n\n### Current Migration Session (November 5, 2025) ✅\n- [x] Installing cross-env dependency\n- [x] Restart workflow to verify project runs\n- [x] Verify application loads correctly\n- [x] Mark import as completed\n\n### Latest Migration Session (November 5, 2025 - 11:10 AM) ✅\n- [x] Installed cross-env package via packager tool\n- [x] Restarted workflow successfully - application running on port 5000\n- [x] Verified Express server is serving on port 5000\n- [x] Confirmed Vite connected and browser console shows no errors\n- [x] All migration tasks completed successfully\n\n### Final Migration Session (November 5, 2025 - 11:34 AM) ✅\n- [x] Installed cross-env package via packager tool\n- [x] Restarted workflow successfully - application running on port 5000\n- [x] Verified Express server is serving on port 5000\n- [x] Confirmed Vite connected and browser console shows no errors\n- [x] All migration tasks completed successfully\n- [x] Import marked as completed\n\n### Chromium Installation for PDF Generation (November 5, 2025 - 11:46 AM) ✅\n**Issue**: PDF viewing failed for issued documents with \"Chromium not found in PATH\" error preventing Puppeteer from generating PDFs.\n\n**Root Cause**: Chromium browser binary was not installed in the Replit environment. Puppeteer requires Chromium to convert Word documents to PDF format, but the system dependency was missing.\n\n**Solution Implemented**:\n- [x] Installed Chromium system dependency via packager tool (Nix package)\n- [x] Located Chromium executable at `/nix/store/.../bin/chromium`\n- [x] Updated PDFService to configure Puppeteer with executablePath\n- [x] Added environment variable support: PUPPETEER_EXECUTABLE_PATH with fallback to 'chromium'\n- [x] Architect reviewed and approved changes - no security or performance issues\n- [x] Restarted workflow successfully - server running without errors\n- [x] All migration items marked as complete\n\n**Technical Details**:\n- Modified `server/services/pdf-service.ts` to add `executablePath: process.env.PUPPETEER_EXECUTABLE_PATH || 'chromium'`\n- Chromium is now available in system PATH via Nix package manager\n- Existing Puppeteer sandbox-disabling flags remain appropriate for Replit environment\n- No changes to HTML-to-PDF pipeline (Mammoth conversion, header/footer composition)\n\n**Result**: PDF generation now works correctly. Documents can be created → approved → issued → viewed as PDFs with full functionality including control copy tracking, header/footer rendering, and print capabilities.\n\n### PDF Viewing Bug Fix (November 5, 2025 - 11:15 AM) ✅\n**Issue**: Approver could not view issued documents in PDF format after issuer issues them.\n\n**Root Cause**: ApproverDashboard lacked functionality to view issued documents. Only pending and approved documents were shown, with no way to access the final PDF versions of issued documents.\n\n**Solution Implemented**:\n- [x] Added PDF viewer capability to ApproverDashboard\n- [x] Imported PDFViewer component and Send icon\n- [x] Added state management for PDF viewer (pdfViewerOpen, pdfDocId, pdfDocName)\n- [x] Created query to fetch issued documents with 5-second refresh interval\n- [x] Implemented handleViewPDF function to open PDF viewer\n- [x] Added transformedIssuedDocs function to map API documents to Document type\n- [x] Created \"Issued Documents (View as PDF)\" card section in UI\n- [x] Integrated PDFViewer component with all required props\n- [x] Architect reviewed and approved - no issues found\n- [x] Changes hot-reloaded successfully via Vite HMR\n\n**Result**: Approvers can now view the final PDF versions of all issued documents they approved, with full PDF viewing and print capabilities including control copy tracking.\n\n### PDF Generation Failure Fix (November 5, 2025 - 11:22 AM) ✅\n**Issue**: \"issued pdf load failed\" - PDFs could not be generated, showing load failed error.\n\n**Root Cause**: The `uploads` and `pdfs` directories were not being created before file operations. The PDFService constructor called `ensureDirectories()` asynchronously without awaiting it, creating a race condition where file uploads and PDF generation would fail if directories didn't exist yet.\n\n**Solution Implemented**:\n- [x] Identified missing uploads and pdfs directories\n- [x] Created public `initialize()` method in PDFService class\n- [x] Modified server startup (server/index.ts) to await `pdfService.initialize()` before accepting requests\n- [x] Ensured directories are created with recursive flag to prevent errors\n- [x] Eliminated race conditions by guaranteeing directory creation before route registration\n- [x] Architect reviewed and approved - no issues found\n- [x] Server successfully restarted with proper initialization\n\n**Technical Details**:\n- Added `async initialize(): Promise<void>` method to PDFService\n- Server startup now calls `await pdfService.initialize()` before `registerRoutes(app)`\n- Directory creation uses `fs.mkdir(path, { recursive: true })` for both uploads/ and pdfs/\n- Removed async call from constructor to prevent timing issues\n\n**Result**: PDF generation now works correctly. Documents can be uploaded, approved, issued, and viewed as PDFs without errors. The initialization sequence ensures all required directories exist before any PDF operations begin.\n\n### Word Document Viewer Implementation (November 5, 2025) ✅\n- [x] Created API endpoint `/api/documents/:id/view-word` to convert Word to HTML using mammoth\n- [x] Created WordDocumentViewer component with proper queryFn, loading states, and error handling\n- [x] Integrated Word viewer into Approver dashboard (replaced download with view)\n- [x] Integrated Word viewer into Issuer dashboard (replaced download with view)\n- [x] Updated DocumentTable to display \"View Word\" instead of \"Download\" with FileText icon\n- [x] Verified view-only functionality (no download capability)\n- [x] All changes architect-reviewed and approved\n\n### UI/UX Improvements & System Enhancements Session (November 5, 2025 - 8:40 AM) ✅\n\n#### Login Page Redesign ✅\n- [x] Updated login page UI to match provided design\n  - [x] Added header with dark mode toggle\n  - [x] Removed role dropdown field from login form\n  - [x] Updated App.tsx to auto-detect role from email (creator/approver/issuer/admin)\n  - [x] Added \"Modern Document Control\" badge\n  - [x] Improved demo credentials display with color-coded roles\n  - [x] Added footer with copyright information\n  - [x] Responsive design with improved visual hierarchy\n\n#### Document Creation Form Improvements ✅\n- [x] Removed manual header/footer input fields from DocumentUploadForm\n- [x] Added informative message about automatic header/footer extraction\n- [x] Updated backend POST /api/documents to call extractHeaderFooterFromWord()\n- [x] Header and footer now automatically extracted from first/last 2 lines of uploaded Word document\n\n#### PDF System Verification ✅\n- [x] Verified PDF viewing functionality with control copy tracking\n- [x] Verified print functionality with print logging\n- [x] Confirmed control copy footer displays: User ID, Control Copy No., Date\n- [x] Confirmed no download option (view and print only)\n- [x] Verified RecipientDashboard properly integrates PDFViewer component\n\n### Document Upload and Issuance Enhancement (November 5, 2025) ✅\n- [x] Enhanced document creation form with required header/footer fields\n- [x] Implemented Word document download functionality for issuers at /api/documents/:id/download\n- [x] Integrated PDF viewer into Issuer dashboard for viewing issued documents\n- [x] Created Recipient Dashboard for viewing issued documents in PDF format\n- [x] Added Recipient role to user types and routing\n- [x] Verified all features work correctly: PDF view-only, print logging, header/footer display\n\nAll migration and enhancement tasks have been successfully completed. The Document Management System is now fully functional in the Replit environment with complete document upload, review, issuance, and distribution workflow. Application is running on port 5000 and all dashboards are operational.\n\n## Recent Changes (November 5, 2025)\n\n### PDF Generation Infrastructure (November 5, 2025) ✅\n1. **Issuer Dashboard Improvements:**\n   - Fixed action menu to show Issue/Decline actions for Approved documents\n   - Added Download option for Word documents (placeholder for future implementation)\n   - Document view with header/footer already functional via DocumentViewDialog\n\n2. **Schema Extensions:**\n   - Added `controlCopies` table for tracking control copy numbers per user\n   - Added `printLogs` table for tracking all print actions\n   - Added `documentRecipients` table for document distribution management\n   - Added `pdfFilePath` and `wordFilePath` fields to documents table\n   - All insert schemas and TypeScript types properly defined\n\n3. **PDF Libraries Installed:**\n   - mammoth (DOCX→HTML conversion)\n   - puppeteer (PDF generation with headless Chrome)\n   - pdfjs-dist (frontend PDF viewing)\n   - pdf-lib (PDF manipulation)\n\n4. **Storage Layer Implementation:**\n   - Extended IStorage interface with 9 new methods\n   - Implemented atomic control copy numbering with mutex serialization\n   - Added validation for document recipients (requires userId OR departmentId)\n   - All methods tested and architect-approved\n   - Thread-safe concurrent access for control copy generation\n\n**Architect Review:** ✅ Passed - Storage layer ready for PDF generation pipeline\n\n### Issuer Workflow Implementation (Previous)\n1. **API Integration**: Connected Issuer Dashboard to real backend API\n   - Removed all mock data\n   - Added TanStack Query hooks for approved/issued documents\n   - Implemented real-time notification fetching\n\n2. **Issue Functionality**: Complete issuance flow with remarks\n   - Capture issuer name from user input\n   - Add optional issue remarks\n   - Update document status to \"issued\"\n   - Notify creator and approver\n\n3. **Decline Functionality**: Send documents back to creator\n   - Reset document status to \"pending\"\n   - Capture decline remarks\n   - Notify original creator with feedback\n\n4. **Document View Enhancements**:\n   - Added issue remarks display with blue highlight\n   - Display header/footer information in separate card\n   - Show previous version comparison for revisions\n   - All workflow metadata visible (preparer, approver, issuer)\n\n5. **Notification System Fix**:\n   - Removed buggy per-department notification loop\n   - Target only creator and approver on issuance\n   - Prevent duplicate notifications\n\n6. **Schema Updates**:\n   - Added `issueRemarks` field to documents\n   - Added `issuerName` field to documents\n   - Proper type definitions in shared schema\n\n## Known Issues\nNone currently identified.\n\n## PDF System Implementation (November 5, 2025) ✅\n\n### Completed Components\n- [x] PDF service for DOCX→PDF conversion with header/footer templating\n- [x] File upload handling for Word documents\n- [x] API routes:\n  - [x] POST /api/documents/:id/upload - Upload Word file\n  - [x] GET /api/documents/:id/pdf - View PDF with control copy generation and version access control\n  - [x] POST /api/documents/:id/print - Print PDF with logging\n  - [x] GET /api/reports/print-logs - Print log reports\n  - [x] GET /api/documents/:docNumber/versions - Version listing with access control\n- [x] Frontend PDF viewer component using pdfjs-dist\n- [x] Control copy footer watermarking to PDFs\n- [x] Version access control (master copy users see all, others see latest only)\n- [x] Enhanced DocumentViewDialog with prominent header/footer display\n- [x] Reports page with CSV export for print logs and issued documents\n- [x] PDF viewer integration into dashboards\n- [x] Document upload UI integration\n\n## Login & Document Upload Enhancements (November 5, 2025) ✅\n\n### Login Page Redesign\n- [x] Modern split-screen design with blue gradient left panel\n- [x] Email field instead of username\n- [x] Social login buttons (Google, Facebook, Phone)\n- [x] Demo credentials prominently displayed at bottom\n- [x] Feature highlights showcasing system capabilities\n- [x] Responsive design with clean, professional layout\n\n### Document Creation Workflow Improvements\n- [x] **Automatic Header/Footer Extraction**: Documents now require Word file upload upfront\n  - Header and footer information automatically extracted from uploaded Word files using mammoth library\n  - Removed manual header/footer entry fields from form\n  - Streamlined document creation process\n- [x] **File Upload Security**:\n  - MIME type validation (only .doc and .docx files allowed)\n  - File size limit enforced (10MB maximum)\n  - Proper error handling for invalid uploads\n- [x] **Type Safety Fixes**:\n  - Fixed type coercion for FormData fields (revisionNo, duePeriodYears, dates)\n  - Ensures version comparison logic works correctly for all revision numbers\n  - Prevents issues with double-digit revision numbers\n- [x] **Word File Download**: \n  - Download buttons added to Approver and Issuer dashboards\n  - API endpoint `/api/documents/:id/download` serves original Word files\n  - Error handling for missing files\n\n### Technical Implementation Details\n- MultiPart form data handling with multer\n- Automatic file storage with unique IDs\n- Mammoth library integration for header/footer extraction\n- Security validation before file processing\n- Proper TypeScript typing throughout workflow\n\n### Future Enhancements\n- [ ] Recipient dashboard for viewing issued documents\n- [ ] Admin dashboard for system management\n- [ ] Advanced search and filtering\n- [ ] Email notifications\n- [ ] Audit trail and comprehensive reporting\n- [ ] User management interface\n- [ ] Department-user mapping for targeted notifications\n- [ ] Document templates\n- [ ] Bulk operations\n\n## Testing Notes\n- All workflows (Creator → Approver → Issuer) verified with real API integration\n- Notification system tested and working correctly\n- Document view dialog displays all required information\n- No console errors or runtime issues detected\n","path":null,"size_bytes":18643,"size_tokens":null},"client/src/components/WordDocumentViewer.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Loader2, FileText, AlertCircle } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ninterface WordDocumentViewerProps {\n  documentId: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function WordDocumentViewer({ documentId, open, onOpenChange }: WordDocumentViewerProps) {\n  const { data, isLoading, error } = useQuery<{\n    html: string;\n    docName: string;\n    docNumber: string;\n    revisionNo: number;\n  }>({\n    queryKey: [\"/api/documents\", documentId, \"view-word\"],\n    queryFn: async () => {\n      const response = await fetch(`/api/documents/${documentId}/view-word`);\n      if (!response.ok) {\n        throw new Error(\"Failed to load Word document\");\n      }\n      return response.json();\n    },\n    enabled: open && !!documentId,\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-hidden flex flex-col\" data-testid=\"dialog-word-viewer\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <FileText className=\"w-5 h-5\" />\n            {data ? (\n              <span>\n                {data.docName} - {data.docNumber} (Rev {data.revisionNo})\n              </span>\n            ) : (\n              <span>Document Viewer</span>\n            )}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-auto\">\n          {isLoading && (\n            <div className=\"flex items-center justify-center py-12\" data-testid=\"loading-word-viewer\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-blue-500\" />\n              <span className=\"ml-3 text-gray-600\">Loading document...</span>\n            </div>\n          )}\n\n          {error && (\n            <Alert variant=\"destructive\" data-testid=\"error-word-viewer\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                Failed to load document. The file may not be available.\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {data && (\n            <div className=\"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg\">\n              <div className=\"p-8 prose prose-sm max-w-none dark:prose-invert\">\n                <div \n                  dangerouslySetInnerHTML={{ __html: data.html }}\n                  data-testid=\"content-word-viewer\"\n                  className=\"word-document-content\"\n                />\n              </div>\n            </div>\n          )}\n        </div>\n\n        <div className=\"text-xs text-gray-500 text-center pt-2 border-t\">\n          View-only mode • No download available\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":2895,"size_tokens":null},"client/src/components/ReviewReminders.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Bell, Calendar, AlertCircle } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface DueDocument {\n  id: string;\n  docName: string;\n  docNumber: string;\n  revisionNo: number;\n  reviewDueDate: string;\n  daysUntilDue: number;\n  preparerName: string;\n}\n\ninterface ReviewRemindersProps {\n  daysAhead?: number;\n}\n\nexport default function ReviewReminders({ daysAhead = 30 }: ReviewRemindersProps) {\n  const { data: dueDocuments = [], isLoading } = useQuery<DueDocument[]>({\n    queryKey: [\"/api/documents/due-for-review\", daysAhead],\n    queryFn: async () => {\n      const response = await fetch(`/api/documents/due-for-review?daysAhead=${daysAhead}`);\n      if (!response.ok) throw new Error(\"Failed to fetch due documents\");\n      return response.json();\n    },\n    refetchInterval: 60000,\n  });\n\n  if (isLoading) {\n    return null;\n  }\n\n  if (dueDocuments.length === 0) {\n    return null;\n  }\n\n  const urgentDocs = dueDocuments.filter(doc => doc.daysUntilDue <= 7);\n\n  return (\n    <Card className=\"p-6 mb-6 bg-amber-50 dark:bg-amber-950/20 border-amber-200 dark:border-amber-800\" data-testid=\"card-review-reminders\">\n      <div className=\"flex items-start gap-3\">\n        <div className=\"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg\">\n          <Bell className=\"w-5 h-5 text-amber-600 dark:text-amber-400\" />\n        </div>\n        <div className=\"flex-1\">\n          <h3 className=\"font-semibold text-amber-900 dark:text-amber-100 mb-2\">\n            Document Review Reminders\n          </h3>\n          <p className=\"text-sm text-amber-800 dark:text-amber-200 mb-4\">\n            {dueDocuments.length} document{dueDocuments.length !== 1 ? 's' : ''} due for review in the next {daysAhead} days\n          </p>\n          \n          <div className=\"space-y-3\">\n            {dueDocuments.slice(0, 5).map((doc) => {\n              const isUrgent = doc.daysUntilDue <= 7;\n              const isOverdue = doc.daysUntilDue < 0;\n              \n              return (\n                <Alert \n                  key={doc.id} \n                  className={`${isOverdue ? 'bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800' : isUrgent ? 'bg-orange-50 dark:bg-orange-950/20 border-orange-200 dark:border-orange-800' : 'bg-white dark:bg-gray-800'}`}\n                  data-testid={`alert-due-doc-${doc.id}`}\n                >\n                  <AlertCircle className={`h-4 w-4 ${isOverdue ? 'text-red-600' : isUrgent ? 'text-orange-600' : 'text-amber-600'}`} />\n                  <AlertTitle className=\"text-sm font-medium\">\n                    {doc.docName} ({doc.docNumber})\n                    <Badge \n                      variant={isOverdue ? \"destructive\" : isUrgent ? \"default\" : \"secondary\"}\n                      className=\"ml-2\"\n                    >\n                      Rev {doc.revisionNo}\n                    </Badge>\n                  </AlertTitle>\n                  <AlertDescription className=\"text-xs mt-1\">\n                    <div className=\"flex items-center gap-4\">\n                      <span className=\"flex items-center gap-1\">\n                        <Calendar className=\"w-3 h-3\" />\n                        {isOverdue \n                          ? `Overdue by ${Math.abs(doc.daysUntilDue)} day${Math.abs(doc.daysUntilDue) !== 1 ? 's' : ''}`\n                          : `Due in ${doc.daysUntilDue} day${doc.daysUntilDue !== 1 ? 's' : ''}`\n                        }\n                      </span>\n                      <span>Review Due: {new Date(doc.reviewDueDate).toLocaleDateString()}</span>\n                    </div>\n                  </AlertDescription>\n                </Alert>\n              );\n            })}\n            \n            {dueDocuments.length > 5 && (\n              <p className=\"text-xs text-amber-700 dark:text-amber-300 text-center\">\n                + {dueDocuments.length - 5} more document{dueDocuments.length - 5 !== 1 ? 's' : ''} due for review\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4196,"size_tokens":null}},"version":2}